<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.72">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="I CAN MAKE THIS WORK Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="I CAN MAKE THIS WORK Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-51754530-2","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><title data-react-helmet="true">Integration Tests with SQL Server Database Snapshots | I CAN MAKE THIS WORK</title><meta data-react-helmet="true" property="og:title" content="Integration Tests with SQL Server Database Snapshots | I CAN MAKE THIS WORK"><meta data-react-helmet="true" name="description" content="Once More With Feeling"><meta data-react-helmet="true" property="og:description" content="Once More With Feeling"><meta data-react-helmet="true" property="og:image" content="https://blog.johnnyreilly.com/img/profile.png"><meta data-react-helmet="true" name="twitter:image" content="https://blog.johnnyreilly.com/img/profile.png"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://blog.johnnyreilly.com/2016/09/12/integration-tests-with-sql-server"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://blog.johnnyreilly.com/2016/09/12/integration-tests-with-sql-server"><link data-react-helmet="true" rel="alternate" href="https://blog.johnnyreilly.com/2016/09/12/integration-tests-with-sql-server" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://blog.johnnyreilly.com/2016/09/12/integration-tests-with-sql-server" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.3ed665c6.css">
<link rel="preload" href="/assets/js/styles.f7659eed.js" as="script">
<link rel="preload" href="/assets/js/runtime~main.74f1dcf9.js" as="script">
<link rel="preload" href="/assets/js/main.77bdfe03.js" as="script">
<link rel="preload" href="/assets/js/1.194e3740.js" as="script">
<link rel="preload" href="/assets/js/2.85d4c801.js" as="script">
<link rel="preload" href="/assets/js/ccc49370.9f01aebe.js" as="script">
<link rel="preload" href="/assets/js/c3b5bd8c.a1a5ba6a.js" as="script">
<link rel="preload" href="/assets/js/8890ac7a.256bc76a.js" as="script">
<link rel="preload" href="/assets/js/fe3d2add.7a8be31b.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">I CAN MAKE THIS WORK</strong></a><a class="navbar__item navbar__link" href="/about">About</a><a class="navbar__item navbar__link" href="/blog-archive">Blog Archive</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/johnnyreilly" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><a href="https://twitter.com/johnny_reilly" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Twitter</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_GrZ2"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">I CAN MAKE THIS WORK</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/about">About</a></li><li class="menu__list-item"><a class="menu__link" href="/blog-archive">Blog Archive</a></li><li class="menu__list-item"><a href="https://github.com/johnnyreilly" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li><li class="menu__list-item"><a href="https://twitter.com/johnny_reilly" target="_blank" rel="noopener noreferrer" class="menu__link">Twitter</a></li></ul></div></div></div></nav><div class="main-wrapper blog-wrapper"><div class="container margin-vert--lg"><div class="row"><div class="col col--3"><div class="sidebar_2ahu thin-scrollbar"><h3 class="sidebarItemTitle_2hhb">Recent posts</h3><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/2021/03/20/bicep-meet-azure-pipelines">Bicep in Azure Pipelines</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/2021/03/17/rss-update-we-moved-to-docusaurus">RSS update; we moved to Docusaurus</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/2021/03/15/from-blogger-to-docusaurus">From Blogger to Docusaurus</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/2021/03/10/managed-identity-azure-sql-entity-framework">Managed Identity, Azure SQL and Entity Framework</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/2021/03/06/generate-typescript-and-csharp-clients-with-nswag">Generate TypeScript and CSharp clients with NSwag based on an API</a></li></ul></div></div><main class="col col--7"><article><header><h1 class="margin-bottom--sm blogPostTitle_GeHD">Integration Tests with SQL Server Database Snapshots</h1><div class="margin-vert--md"><time datetime="2016-09-12T00:00:00.000Z" class="blogPostDate_fNvV">September 12, 2016 Â· 6 min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/johnnyreilly" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://blog.johnnyreilly.com/img/profile.jpg" alt="John Reilly"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/johnnyreilly" target="_blank" rel="noopener noreferrer">John Reilly</a></h4><small class="avatar__subtitle"></small></div></div></header><div class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="once-more-with-feeling"></a>Once More With Feeling<a class="hash-link" href="#once-more-with-feeling" title="Direct link to heading">#</a></h2><p> This is a topic that I have written about <a href="https://blog.johnnyreilly.com/2014/01/integration-testing-with-entity.html" target="_blank" rel="noopener noreferrer">before</a>.... But not well. I recently had cause to dust down my notes on how to use snapshotting in your integration tests. To my dismay, referring back to my original blog post was less helpful than I&#x27;d hoped. Now I&#x27;ve cracked the enigma code that my original scribings turned out to be, it&#x27;s time to turn my relearnings back into something genuinely useful.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="whats-the-scenario"></a>What&#x27;s the Scenario?<a class="hash-link" href="#whats-the-scenario" title="Direct link to heading">#</a></h2><p>You have a test database. You want to write integration tests. So what&#x27;s the problem? Well, these tests will add records, delete records, update records within the tables of the database. They will mutate the data. And that&#x27;s exactly what they ought to do; they&#x27;re testing that our code uses the database in the way we would hope and expect.</p><p>So how do we handle this? Well, we could handle this by writing code at the end of each test that is responsible for reverting the database back to the state that it was in at the start of the test. So if we had a test that added a record and tested it, we&#x27;d need the test to be responsible for removing that record before any subsequent tests run. Now that&#x27;s a totally legitimate approach but it adds tax. Each test becomes more complicated and requires more code.</p><p>So what&#x27;s another approach? Perhaps we could take a backup of our database before our first test runs. Then, at the end of each test, we could restore our backup to roll the database back to its initial state. Perfect, right? Less code to write, less scope for errors. So what&#x27;s the downside? Backups are slowwwww. Restores likewise. We could be waiting minutes between each test that runs. That&#x27;s not acceptable.</p><p>There is another way though: <a href="https://msdn.microsoft.com/en-us/library/ms175158.aspx" target="_blank" rel="noopener noreferrer">database snapshots</a> - a feature that&#x27;s been nestling inside SQL Server for a goodly number of years. For our use case, to all intents and purposes, database snapshots offers the same functionality as backups and restores. You can backup a database (take a snapshot of a database at a point in time), you can restore a database (roll back the database to the point of the snapshot). More importantly, you can do either operation in *<em>under a second</em>*. As it happens, Microsoft advocate using this approach themselves:</p><blockquote><p>In a testing environment, it can be useful when repeatedly running a test protocol for the database to contain identical data at the start of each round of testing. Before running the first round, an application developer or tester can create a database snapshot on the test database. After each test run, the database can be quickly returned to its prior state by reverting the database snapshot.</p></blockquote><p>Sold!</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="talk-is-cheap-show-me-the-code"></a>Talk is cheap, show me the code<a class="hash-link" href="#talk-is-cheap-show-me-the-code" title="Direct link to heading">#</a></h2><p>In the end it comes down to 3 classes; <code>DatabaseSnapshot.cs</code> which does the actual snapshotting work and 2 classes that make use of it.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="databasesnapshotcs"></a>DatabaseSnapshot.cs<a class="hash-link" href="#databasesnapshotcs" title="Direct link to heading">#</a></h3><p>This is our <code>DatabaseSnapshot</code> class. Isn&#x27;t it pretty?</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><div tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">using System.Data;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">using System.Data.SqlClient;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">namespace Testing.Shared</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public class DatabaseSnapshot</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        private readonly string _dbName;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        private readonly string _dbSnapShotPath;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        private readonly string _dbSnapShotName;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        private readonly string _dbConnectionString;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        public DatabaseSnapshot(string dbName, string dbSnapshotPath, string dbSnapshotName, string dbConnectionString)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            _dbName = dbName;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            _dbSnapshotPath = dbSnapshotPath;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            _dbSnapshotName = dbSnapshotName;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            _dbConnectionString = dbConnectionString;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        public void CreateSnapshot()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            if (!System.IO.Directory.Exists(_dbSnapshotPath))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                System.IO.Directory.CreateDirectory(_dbSnapshotPath);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            var sql = $&quot;CREATE DATABASE { _dbSnapshotName } ON (NAME=[{ _dbName }], FILENAME=&#x27;{ _dbSnapshotPath }{ _dbSnapshotName }&#x27;) AS SNAPSHOT OF [{_dbName }]&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            ExecuteSqlAgainstMaster(sql);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        public void DeleteSnapshot()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            var sql = $&quot;DROP DATABASE { _dbSnapshotName }&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            ExecuteSqlAgainstMaster(sql);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        public void RestoreSnapshot()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            var sql = &quot;USE master;\r\n&quot; +</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                $&quot;ALTER DATABASE {_dbName} SET SINGLE_USER WITH ROLLBACK IMMEDIATE;\r\n&quot; +</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                $&quot;RESTORE DATABASE {_dbName}\r\n&quot; +</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                $&quot;FROM DATABASE_SNAPSHOT = &#x27;{ _dbSnapshotName }&#x27;;\r\n&quot; +</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                $&quot;ALTER DATABASE {_dbName} SET MULTI_USER;\r\n&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            ExecuteSqlAgainstMaster(sql);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        private void ExecuteSqlAgainstMaster(string sql, params SqlParameter[] parameters)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            using (var conn = new SqlConnection(_dbConnectionString))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                conn.Open();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                var cmd = new SqlCommand(sql, conn) { CommandType = CommandType.Text };</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                cmd.Parameters.AddRange(parameters);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                cmd.ExecuteNonQuery();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                conn.Close();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>It exposes 3 methods:</p><dl><dt>CreateSnapshot</dt><dd>This method creates the snapshot of the database. We will run this right at the start, before any of our tests run.</dd><dt>DeleteSnapshot</dt><dd>Deletes the snapshot we created. We will run this at the end, after all our tests have finished running.</dd><dt>RestoreSnapshot</dt><dd>Restores the database back to the snapshot we took earlier. We run this after each test has completed. This method relies on a connection to the database (perhaps unsurprisingly). It switches the database in use away from the database that is being restored prior to actually running the restore. It happens to shift to the master database (I believe that&#x27;s entirely incidental; although I haven&#x27;t tested).</dd></dl><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="setupandteardowncs"></a>SetupAndTeardown.cs<a class="hash-link" href="#setupandteardowncs" title="Direct link to heading">#</a></h3><p>This class is responsible for setting up the snapshot we&#x27;re going to use in our tests right before any of the tests have run (in the <code>FixtureSetup</code> method). It&#x27;s also responsible for deleting the snapshot once all the tests have finished running (in the <code>FixtureTearDown</code> method). It should be noted that in this example I&#x27;m using NUnit and this class is written to depend on the hooks NUnit exposes for running code at the very beginning and end of the test cycle. All test frameworks have these hooks; if you&#x27;re using something other than NUnit then it&#x27;s just a case of swapping in the relevant attribute (everything tends to attribute driven in the test framework world).</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><div tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">using NUnit.Framework;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">namespace Testing.Shared</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   [SetUpFixture]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   public class SetupAndTeardown</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      public static DatabaseSnapshot DatabaseSnapshot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      [SetUp]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      public void FixtureSetup()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         DatabaseSnapshot = new DatabaseSnapshot(&quot;MyDbName&quot;, &quot;C:\\&quot;, &quot;MySnapshot&quot;, &quot;Data Source=.;initial catalog=MyDbName;integrated security=True;&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         try</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            // Try to delete the snapshot in case it was left over from aborted test runs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            DatabaseSnapshot.DeleteSnapShot();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         catch { /* this should fail with snapshot does not exist */ }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         DatabaseSnapshot.CreateSnapShot();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      [TearDown]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      public void FixtureTearDown()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         DatabaseSnapshot.DeleteSnapShot();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="testbasecs"></a>TestBase.cs<a class="hash-link" href="#testbasecs" title="Direct link to heading">#</a></h3><p>All of our test classes are made to inherit from this class:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><div tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">using NUnit.Framework;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">namespace Testing.Shared</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   public class TestBase</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      [TearDown]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      public void TearDown()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">         SetupAndTeardown.DatabaseSnapshot.RestoreSnapShot();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">   }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Which restores the database back to the snapshot position at the end of each test. And that... Is that!</p></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/tags/database-snapshots">Database Snapshots</a><a class="margin-horiz--sm" href="/tags/integration-testing">Integration Testing</a><a class="margin-horiz--sm" href="/tags/sql-server">SQL Server</a></div></footer></article><div><a href="https://github.com/johnnyreilly/blog.johnnyreilly.com/edit/main/blog-website/blog/blog/2016-09-12-integration-tests-with-sql-server.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="margin-vert--xl"><nav class="pagination-nav" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/2016/09/22/typescript-20-es2016-and-babel"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Â« TypeScript 2.0, ES2016 and Babel</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/2016/08/19/the-ternary-operator-meets-destructuring"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">The Ternary Operator &lt;3 Destructuring Â»</div></a></div></nav></div></main><div class="col col--2"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#once-more-with-feeling" class="table-of-contents__link">Once More With Feeling</a></li><li><a href="#whats-the-scenario" class="table-of-contents__link">What&#39;s the Scenario?</a></li><li><a href="#talk-is-cheap-show-me-the-code" class="table-of-contents__link">Talk is cheap, show me the code</a><ul><li><a href="#databasesnapshotcs" class="table-of-contents__link">DatabaseSnapshot.cs</a></li><li><a href="#setupandteardowncs" class="table-of-contents__link">SetupAndTeardown.cs</a></li><li><a href="#testbasecs" class="table-of-contents__link">TestBase.cs</a></li></ul></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><ul class="footer__items"><li class="footer__item"><a href="https://www.buymeacoffee.com/qUBm0Wh" target="_blank"><img src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png" alt="Buy Me A Coffee" style="height: 60px !important;width: 217px !important;"></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 John Reilly. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/styles.f7659eed.js"></script>
<script src="/assets/js/runtime~main.74f1dcf9.js"></script>
<script src="/assets/js/main.77bdfe03.js"></script>
<script src="/assets/js/1.194e3740.js"></script>
<script src="/assets/js/2.85d4c801.js"></script>
<script src="/assets/js/ccc49370.9f01aebe.js"></script>
<script src="/assets/js/c3b5bd8c.a1a5ba6a.js"></script>
<script src="/assets/js/8890ac7a.256bc76a.js"></script>
<script src="/assets/js/fe3d2add.7a8be31b.js"></script>
</body>
</html>