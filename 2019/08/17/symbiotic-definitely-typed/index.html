<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.73">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="I CAN MAKE THIS WORK Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="I CAN MAKE THIS WORK Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-51754530-2","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="icon" href="/img/favicon/profile.jpg">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="rgb(37, 194, 160)">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#000">
<link rel="apple-touch-icon" href="/img/favicon/apple-touch-icon.png"><title data-react-helmet="true">I CAN MAKE THIS WORK</title><meta data-react-helmet="true" name="description" content="I did ponder calling this post &quot;how to enable a good TypeScript developer experience for npm modules that aren&#x27;t written in TypeScript&quot;... Not exactly pithy though."><meta data-react-helmet="true" property="og:description" content="I did ponder calling this post &quot;how to enable a good TypeScript developer experience for npm modules that aren&#x27;t written in TypeScript&quot;... Not exactly pithy though."><meta data-react-helmet="true" property="og:url" content="https://blog.johnnyreilly.com/2019/08/17/symbiotic-definitely-typed"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><meta data-react-helmet="true" property="og:title" content="I CAN MAKE THIS WORK"><meta data-react-helmet="true" property="og:image" content="https://blog.johnnyreilly.com/img/profile.png"><meta data-react-helmet="true" name="twitter:image" content="https://blog.johnnyreilly.com/img/profile.png"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://blog.johnnyreilly.com/2019/08/17/symbiotic-definitely-typed"><link data-react-helmet="true" rel="alternate" href="https://blog.johnnyreilly.com/2019/08/17/symbiotic-definitely-typed" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://blog.johnnyreilly.com/2019/08/17/symbiotic-definitely-typed" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.105de97d.css">
<link rel="preload" href="/assets/js/styles.a4ce88d2.js" as="script">
<link rel="preload" href="/assets/js/runtime~main.b634e2bd.js" as="script">
<link rel="preload" href="/assets/js/main.b119f4b6.js" as="script">
<link rel="preload" href="/assets/js/1.8b668980.js" as="script">
<link rel="preload" href="/assets/js/2.544547e0.js" as="script">
<link rel="preload" href="/assets/js/ccc49370.ee3792fd.js" as="script">
<link rel="preload" href="/assets/js/c3b5bd8c.4d1bf496.js" as="script">
<link rel="preload" href="/assets/js/ab14cf50.cbb76fd6.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">I CAN MAKE THIS WORK</strong></a><a class="navbar__item navbar__link" href="/about">About</a><a class="navbar__item navbar__link" href="/blog-archive">Blog Archive</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/johnnyreilly" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><a href="https://twitter.com/johnny_reilly" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Twitter</a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">I CAN MAKE THIS WORK</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/about">About</a></li><li class="menu__list-item"><a class="menu__link" href="/blog-archive">Blog Archive</a></li><li class="menu__list-item"><a href="https://github.com/johnnyreilly" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li><li class="menu__list-item"><a href="https://twitter.com/johnny_reilly" target="_blank" rel="noopener noreferrer" class="menu__link">Twitter</a></li></ul></div></div></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><div class="col col--3"><div class="sidebar_2ahu thin-scrollbar"><h3 class="sidebarItemTitle_2hhb">Recent posts</h3><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/2021/04/20/ts-loader-goes-webpack-5">ts-loader goes webpack 5</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/2021/04/10/hello-world-bicep">Hello World Bicep</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/2021/03/23/bicep-meet-azure-pipelines-2">Bicep meet Azure Pipelines 2</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/2021/03/20/bicep-meet-azure-pipelines">Bicep meet Azure Pipelines</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/2021/03/17/rss-update-we-moved-to-docusaurus">RSS update; we moved to Docusaurus</a></li></ul></div></div><main class="col col--7"><article><header><h1 class="margin-bottom--sm blogPostTitle_GeHD">Symbiotic Definitely Typed</h1><div class="margin-vert--md"><time datetime="2019-08-17T00:00:00.000Z" class="blogPostDate_fNvV">August 17, 2019 Â· 6 min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/johnnyreilly" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://blog.johnnyreilly.com/img/profile.jpg" alt="John Reilly"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/johnnyreilly" target="_blank" rel="noopener noreferrer">John Reilly</a></h4><small class="avatar__subtitle"></small></div></div></header><div class="markdown"><p>I did ponder calling this post &quot;how to enable a good TypeScript developer experience for npm modules that aren&#x27;t written in TypeScript&quot;... Not exactly pithy though.</p><p>Definitely Typed is the resource which allows developers to use TypeScript with existing JavaScript libraries that ship without their own type definitions.</p><p>DT began as a way to enable interop between JS and TS. When DT started, everything on npm was JavaScript. Over time it has become more common for libraries (eg <a href="https://github.com/mobxjs/mobx" target="_blank" rel="noopener noreferrer">Mobx</a> / <a href="https://github.com/angular/angular" target="_blank" rel="noopener noreferrer">Angular</a>) to be written (or rewritten) in TypeScript. For publishing, they are compiled down to JS with perfect type definitions generated from the TypeScript alongside the compiled JavaScript. These libraries do not need to exist in Definitely Typed anymore.</p><p>Another pattern that has emerged over time is that of type definitions being removed from Definitely Typed to live and be maintained alongside the libraries they support. An example of this is <a href="https://github.com/moment/moment" target="_blank" rel="noopener noreferrer">MomentJS</a>.</p><p>This week, I think for the first time, there emerged another approach. <a href="https://kentcdodds.com/" target="_blank" rel="noopener noreferrer">Kent C Dodds</a>&#x27; <code>react-testing-library</code> had started out with the MomentJS approach of hosting type definitions alongside the JavaScript source code. <a href="https://github.com/testing-library/react-testing-library/pull/437" target="_blank" rel="noopener noreferrer">Alex Krolic raised a PR which proposed removing the type definitions from the RTL repo in favor of having the community maintain them at DefinitelyTyped.</a></p><p>I&#x27;ll directly quote Kent&#x27;s explanation of the motivation for this:</p><blockquote><p>We were getting a lot of drive-by contributions to the TypeScript typings and many pull requests would either sit without being reviewed by someone who knows TypeScript well enough, or be merged by a maintainer who just hoped the contributor knew what they were doing. This resulted in a poor experience for TypeScript users who could experience type definition churn and delays, and it became a burden on project maintainers as well (most of us don&#x27;t know TypeScript very well). Moving the type definitions to DefinitelyTyped puts the maintenance in much more capable hands.</p></blockquote><p>I have to admit I was reticent about this idea in the first place. I like the idea that types ship with the package they support. It&#x27;s a good developer experience; users install your package and it works with TypeScript straight out of the box. However Alex&#x27;s PR addressed a real issue: what do you do when the authors of a package aren&#x27;t interested / equipped / don&#x27;t have the time to support TypeScript? Or don&#x27;t want to deal with the noise of TypeScript related PRs which aren&#x27;t relevant to them. What then?</p><p>Alex was saying, let&#x27;s not force it. Let the types and the library be maintained separately. This can and is done well already; React is a case in point. The React team does not work on the type definitions for React, that&#x27;s done (excellently) by a crew of dedicated React lovers in Definitely Typed.</p><p>It&#x27;s a fair point. The thing that was sad about this move was that the developer experience was going to have more friction. Users would have to <code>yarn add -D @testing-library/react</code> and then subsequently <code>yarn add -D @types/testing-library__react</code> to get the types.</p><p>This two step process isn&#x27;t the end of the world, but it does make it marginally harder for TypeScript users to get up and running. It reduces the developer joy. As a side note, this is made more unlovely by <code>@testing-library/react</code> being a scoped package. <a href="https://stackoverflow.com/questions/47296731/how-can-i-install-typescript-declarations-for-scoped-namespaced-packages-via-ty" target="_blank" rel="noopener noreferrer">Types for a scoped package have a quirky convention for publishing.</a> A fictional scoped package of <code>@foo/bar</code> would be published to npm as: <code>@types/foo__bar</code>. This is functional but non-obvious; it&#x27;s tricky to discover. A two step process instead of a one step process is a non-useful friction that it would be great to eliminate.</p><p>Fortunately, Kent and <a href="https://github.com/FredyC" target="_blank" rel="noopener noreferrer">Daniel K</a> had one of these moments:</p><p> <img src="https://4.bp.blogspot.com/-tmH5nbo_kGY/XG-8jmokKdI/AAAAAAAAN_U/umq24uPgdKAZgAlePU5teNs57i8RWOg7gCPcBGAYYCw/s640/hang-on-lads-ive-got-a-great-idea.jpg"></p><p>Kent suggested that at the same time as dropping the type definitions that were shipped with the library, we try making <code>@types/testing-library__react</code> a dependency of <code>@testing-library/react</code>. This would mean that people installing <code>@testing-library/react</code> would get <code>@types/testing-library__react</code> installed <em>automatically</em>. So from the developers point of view, it&#x27;s as though the type definitions shipped with the package directly.</p><p>To cut a long story short reader, that&#x27;s what happened. If you&#x27;re using <code>@testing-library/react</code> from 9.1.2 you&#x27;re getting Definitely Typed under the covers. This was <a href="https://github.com/testing-library/react-testing-library/pull/437#issuecomment-521763117" target="_blank" rel="noopener noreferrer">nicely illustrated by Kent</a> showing what the TypeScript consumption experience looked like before the Definitely Typed switch:</p><p><img src="https://1.bp.blogspot.com/-wJCLzg0uPuU/XVhqss-lXwI/AAAAAAAAQ48/SGCl9aEHGjUh1qE7OpyyY8MhqPkd2Rw4wCPcBGAYYCw/s640/RTL-9.1.1.png"></p><p>And here&#x27;s what it looked like after:</p><p><img src="https://4.bp.blogspot.com/-jeTQeQnKpVY/XVhrvq8D-0I/AAAAAAAAQ5E/tOieujozFZQ_pttgStAAj_zQwtpGl1AsgCLcBGAs/s640/RTL-9.1.2.png"></p><p>Identical! i.e it worked. I grant you this is one of the more boring before / after comparisons there isâ€¦ But hopefully you can see it demonstrates that this is giving us exactly what we need.</p><p>To quote Kent once more:</p><blockquote><p>By adding the type definitions to the dependencies of React Testing Library, the experience for users is completely unchanged. So it&#x27;s a huge improvement for the maintenance of the type definitions without any breaking changes for the users of those definitions.</p></blockquote><p>This is clearly an approach that&#x27;s useful; it adds value. It would be tremendous to see other libraries that aren&#x27;t written in TypeScript but would like to enable a good TypeScript experience for those people that do use TS also adopting this approach.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="update-use-a-loose-version-range-in-packagejson"></a>Update: Use a Loose Version Range in <code>package.json</code><a class="hash-link" href="#update-use-a-loose-version-range-in-packagejson" title="Direct link to heading">#</a></h2><p>When I <a href="https://twitter.com/johnny_reilly/status/1162843916661592064" target="_blank" rel="noopener noreferrer">tweeted this article</a> it prompted this helpful response from <a href="https://twitter.com/atcb" target="_blank" rel="noopener noreferrer">Andrew Branch</a> of the TypeScript team:</p><blockquote><p>&gt; use a loose version range This is my advice as well and should probably be mentioned in the article TBH.</p><p>â€” Kent C. Dodds (@kentcdodds) <a href="https://twitter.com/kentcdodds/status/1162876792287293440?ref_src=twsrc%5Etfw" target="_blank" rel="noopener noreferrer">August 18, 2019</a></p></blockquote><script src="https://platform.twitter.com/widgets.js" charset="utf-8"></script><p>Andrew makes the useful point that if you are adding support for TypeScript via an <code>@types/...</code> dependency then it&#x27;s wise to do so with a loose version range. <a href="https://github.com/testing-library/react-testing-library/blob/c4ba755e42938018ec67dbc716037cfafca15e03/package.json#L46" target="_blank" rel="noopener noreferrer">In the case of RTL we did it like this:</a></p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><div tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token property">&quot;@types/testing-library__react&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;^9.1.0&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>i.e. Any type definition with a version of <code>9.1</code> or greater (whilst still lower than <code>10.0.0</code>) is considered valid. You could go even looser than that. If you really don&#x27;t want to think about TypeScript beyond adding the dependency then a completely loose version range would do:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><div tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token property">&quot;@types/testing-library__react&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;*&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>This will always install the latest version of the <code>@types/testing-library__react</code> dependency and (importantly) allow users to override if there&#x27;s a problematic <code>@types/testing-library__react</code> out there. This level of looseness is not really advised though. As in the scenario when a library (and associated type definitions) do a major release, users of the old major would get the wrong definitions by default when installing or upgrading (in range).</p><p>Probably the most helpful approach is the approach followed by RTL; fixing the major version but allowing all minor and patch releases <em>inside</em> a major version.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="update-2-further-discussions"></a>Update 2: Further Discussions!<a class="hash-link" href="#update-2-further-discussions" title="Direct link to heading">#</a></h2><p>The technique used in this blog post sparked an interesting conversation with members of the TypeScript team when it was applied to <code>&lt;a href=&quot;https://github.com/testing-library/jest-dom&quot;&gt;https://github.com/testing-library/jest-dom&lt;/a&gt;</code>. <a href="https://github.com/testing-library/jest-dom/issues/123#issuecomment-523586977" target="_blank" rel="noopener noreferrer">The conversation can be read here</a>.</p></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/tags/type-script">TypeScript</a><a class="margin-horiz--sm" href="/tags/react-testing-library">react-testing-library</a><a class="margin-horiz--sm" href="/tags/definitely-typed">Definitely Typed</a></div></footer></article><div><a href="https://github.com/johnnyreilly/blog.johnnyreilly.com/edit/main/blog-website/blog/blog/2019-08-17-symbiotic-definitely-typed.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="margin-vert--xl"><nav class="pagination-nav" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/2019/09/14/coming-soon-definitely-typed"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Â« Coming Soon: Definitely Typed</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/2019/08/02/hard-coding-claim-in-development-mode"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Hard-coding a Claim in Development Mode in ASP.Net Core Â»</div></a></div></nav></div></main><div class="col col--2"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#update-use-a-loose-version-range-in-packagejson" class="table-of-contents__link">Update: Use a Loose Version Range in <code>package.json</code></a></li><li><a href="#update-2-further-discussions" class="table-of-contents__link">Update 2: Further Discussions!</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><ul class="footer__items"><li class="footer__item"><a href="https://www.buymeacoffee.com/qUBm0Wh" target="_blank"><img src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png" alt="Buy Me A Coffee" style="height: 60px !important;width: 217px !important;"></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 John Reilly. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/styles.a4ce88d2.js"></script>
<script src="/assets/js/runtime~main.b634e2bd.js"></script>
<script src="/assets/js/main.b119f4b6.js"></script>
<script src="/assets/js/1.8b668980.js"></script>
<script src="/assets/js/2.544547e0.js"></script>
<script src="/assets/js/ccc49370.ee3792fd.js"></script>
<script src="/assets/js/c3b5bd8c.4d1bf496.js"></script>
<script src="/assets/js/ab14cf50.cbb76fd6.js"></script>
</body>
</html>