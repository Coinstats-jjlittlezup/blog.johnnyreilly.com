<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.71">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="I CAN MAKE THIS WORK Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="I CAN MAKE THIS WORK Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-51754530-2","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><title data-react-helmet="true">Blog | I CAN MAKE THIS WORK</title><meta data-react-helmet="true" property="og:title" content="Blog | I CAN MAKE THIS WORK"><meta data-react-helmet="true" name="description" content="Blog"><meta data-react-helmet="true" property="og:description" content="Blog"><meta data-react-helmet="true" property="og:url" content="https://johnnyreilly.github.io//page/117"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="blog_posts_list"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://johnnyreilly.github.io//page/117"><link data-react-helmet="true" rel="alternate" href="https://johnnyreilly.github.io//page/117" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://johnnyreilly.github.io//page/117" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.537a28a4.css">
<link rel="preload" href="/assets/js/styles.15bc6e2d.js" as="script">
<link rel="preload" href="/assets/js/runtime~main.d656672b.js" as="script">
<link rel="preload" href="/assets/js/main.f8627f17.js" as="script">
<link rel="preload" href="/assets/js/1.40d4c38d.js" as="script">
<link rel="preload" href="/assets/js/2.efe45cdf.js" as="script">
<link rel="preload" href="/assets/js/a6aa9e1f.6b1591ee.js" as="script">
<link rel="preload" href="/assets/js/c3b5bd8c.e43a454c.js" as="script">
<link rel="preload" href="/assets/js/d1e4f970.aebeabb9.js" as="script">
<link rel="preload" href="/assets/js/d0caa3ed.4aad9200.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/"><img src="/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">I CAN MAKE THIS WORK</strong></a></div><div class="navbar__items navbar__items--right"><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_GrZ2"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">I CAN MAKE THIS WORK</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"></ul></div></div></div></nav><div class="main-wrapper blog-wrapper"><div class="container margin-vert--lg"><div class="row"><div class="col col--3"><div class="sidebar_2ahu thin-scrollbar"><h3 class="sidebarItemTitle_2hhb">Recent posts</h3><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/2021/03/10/managed-identity-azure-sql-entity-framework">Managed Identity, Azure SQL and Entity Framework</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/2021/03/06/generate-typescript-and-csharp-clients-with-nswag">Generate TypeScript and CSharp clients with NSwag based on an API</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/2021/02/27/goodbye-client-affinity-hello-data-protection-with-azure">Goodbye Client Affinity, Hello Data Protection with Azure</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/2021/02/16/easy-auth-tokens-survive-releases-on-linux-azure-app-service">Making Easy Auth tokens survive releases on Linux Azure App Service</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/2021/02/11/azure-app-service-health-checks-and-zero-downtime-deployments">Azure App Service, Health checks and zero downtime deployments</a></li></ul></div></div><main class="col col--7"><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/2015/11/30/iqueryable-ienumerable-hmmm">IQueryable... IEnumerable... Hmmm...</a></h2><div class="margin-vert--md"><time datetime="2015-11-30T00:00:00.000Z" class="blogPostDate_fNvV">November 30, 2015 Â· 5 min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/johnnyreilly" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/1010525?s=400&amp;u=294033082cfecf8ad1645b4290e362583b33094a&amp;v=4" alt="John Reilly"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/johnnyreilly" target="_blank" rel="noopener noreferrer">John Reilly</a></h4><small class="avatar__subtitle"></small></div></div></header><div class="markdown"><p>So there I was, tip-tapping away at my keyboard when I became aware of the slowly loudening noise of a debate. It wasn&#x27;t about poverty, war, civil rights or anything like that. No; this was far more contentious. It was about the behaviour of <code>&lt;a href=&quot;https://msdn.microsoft.com/en-gb/library/bb351562(v=vs.100).aspx&quot;&gt;IQueryable&amp;lt;T&amp;gt;&lt;/a&gt;</code> when mixed with <code>&lt;a href=&quot;https://msdn.microsoft.com/en-gb/library/9eekhta0(v=vs.100).aspx&quot;&gt;IEnumerable&amp;lt;T&amp;gt;&lt;/a&gt;</code>. I know, right, how could I not get involved?</p><p> The code that was being debated was a database query that was being facilitated by Entity Framework. Now let me ask you a question: what is the problem with the methods below?</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><div tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">private IEnumerable&lt;Sage&gt; GetSagesWithSayings()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    IQueryable&lt;Sage&gt; sageWithSayings = </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        from s in DbContext.Sages.Include(x =&gt; x.Sayings)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        select s;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    return sageWithSayings;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">public IEnumerable&lt;Sage&gt; GetSagesWithSayingsBornWithinTheLast100Years()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    var aHundredYearsAgo = DateTime.Now.AddYears(-100);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    var sageWithSayings = GetSagesWithSayings().Where(x =&gt; x.DateOfBirth &gt; aHundredYearsAgo);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    return sageWithSayings;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>I&#x27;ve rather emphasised the problem by expressly declaring types in the <code>GetSagesWithSayings</code> method. More typically the <code>IQueryable&amp;lt;Sage&amp;gt;</code> would be hiding itself beneath a <code>var</code> making the problem less obvious. But you get the point; it&#x27;s something to do with an <code>IQueryable&amp;lt;Sage&amp;gt;</code> being passed back as an <code>IEnumerable&amp;lt;Sage&amp;gt;</code>.</p><p>The debate was raging around what this piece of code (or one much like it) actually did. One side positing &quot;it&#x27;ll get every record from the database and then throw away what it doesn&#x27;t need in C#-land...&quot; The opposing view being &quot;are you sure about that? Doesn&#x27;t it just get the records from the last hundred years from the database?&quot;</p><p>So it comes down the SQL that ends up being generated. On the one hand it&#x27;s going to get everything from the Sages table...</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"> </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> Sages </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>Or does it include a filter clause as well?</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly sql"><div tabindex="0" class="prism-code language-sql codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">select</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"> </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">from</span><span class="token plain"> Sages </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">where</span><span class="token plain"> DateOfBirth </span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;1915-11-30&#x27;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>You probably know the answer... It gets everything. Every record is brought back from the database and those that are older than 100 years are then casually thrown away. So kinda wasteful. That&#x27;s the problem. But why? And what does that tell us?</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="linq-to-objects-vs-linq-to--"></a>LINQ to Objects vs LINQ to ... ?<a class="hash-link" href="#linq-to-objects-vs-linq-to--" title="Direct link to heading">#</a></h2><blockquote><p>The term &quot;LINQ to Objects&quot; refers to the use of LINQ queries with any <code>IEnumerable</code> or <code>IEnumerable&amp;lt;T&amp;gt;</code> collection directly, without the use of an intermediate LINQ provider or API such as LINQ to SQL or LINQ to XML.</p></blockquote><blockquote><p>The <code>&lt;a href=&quot;https://msdn.microsoft.com/en-gb/library/bb351562(v=vs.100).aspx&quot;&gt;IQueryable&amp;lt;T&amp;gt;&lt;/a&gt;</code> interface is intended for implementation by query providers.</p><p>This interface inherits the <code>&lt;a href=&quot;https://msdn.microsoft.com/en-gb/library/9eekhta0(v=vs.100).aspx&quot;&gt;IEnumerable&amp;lt;T&amp;gt;&lt;/a&gt;</code> interface so that if it represents a query, the results of that query can be enumerated. Enumeration forces the expression tree associated with an <code>&lt;a href=&quot;https://msdn.microsoft.com/en-gb/library/bb351562(v=vs.100).aspx&quot;&gt;IQueryable&amp;lt;T&amp;gt;&lt;/a&gt;</code> object to be executed. Queries that do not return enumerable results are executed when the <code>&lt;a href=&quot;https://msdn.microsoft.com/en-gb/library/bb549414(v=vs.100).aspx&quot;&gt;Execute&amp;lt;TResult&amp;gt;(Expression)&lt;/a&gt;</code> method is called.</p><p>The definition of &quot;executing an expression tree&quot; is specific to a query provider. For example, it may involve translating the expression tree to a query language appropriate for an underlying data source.</p></blockquote><p>I know - check me out with my &quot;quotes&quot;.</p><p>Now, <code>IEnumerable</code> and <code>IQueryable</code> are similar; for instance they are both considered &quot;lazy&quot; as they offer deferred execution. But there is an important difference between <code>IEnumerable</code> and <code>IQueryable</code>; namely that <code>IQueryable</code> hands off information about a query to another provider in order that they may decide how to do the necessary work. <code>IEnumerable</code> does not; its work is done in memory by operating on the data it has.</p><p>So let&#x27;s apply this to our issue. We have an <code>IQueryable&amp;lt;Sage&amp;gt;</code> and we return it as an <code>IEnumerable&amp;lt;Sage&amp;gt;</code>. By doing this we haven&#x27;t changed the underlying type; it&#x27;s still an <code>IQueryable&amp;lt;Sage&amp;gt;</code>. But by upcasting to <code>IEnumerable&amp;lt;Sage&amp;gt;</code> we have told the compiler that we don&#x27;t have an <code>IQueryable&amp;lt;Sage&amp;gt;</code>. We&#x27;ve lied. I trust you&#x27;re feeling guilty.</p><p>No doubt whoever raised you told you not to tell lies. This was probably the very situation they had in mind. The implications of our dirty little fib come back to haunt us when we start to chain on subsequent filters. So when we perform our filter of <code>.Where(x =&amp;gt; x.DateOfBirth &amp;gt; aHundredYearsAgo)</code> the compiler isn&#x27;t going to get LINQ to Entities&#x27;s extension methods in on this. No, it&#x27;s going to get the LINQ to object extension methods instead.</p><p>This is the cause of our problem. When it comes to execution we&#x27;re not getting the database to do the heavy lifting because we&#x27;ve moved away from using <code>IQueryable</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="fixing-the-problem"></a>Fixing the Problem<a class="hash-link" href="#fixing-the-problem" title="Direct link to heading">#</a></h2><p>There are 2 courses of action open to you. The obvious course of action (and 99% of the time what you&#x27;d look to do) is change the signature of the `` method to return an IQueryable like so:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><div tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">private IQueryable&lt;Sage&gt; GetSagesWithSayings()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    var sageWithSayings = // I prefer &#x27;var&#x27;, don&#x27;t you?</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        from s in DbContext.Sages.Include(x =&gt; x.Sayings)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        select s;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    return sageWithSayings;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>The other alternative is what I like to think of as &quot;the escape hatch&quot;: <code>&lt;a href=&quot;https://msdn.microsoft.com/en-gb/library/bb353734(v=vs.100).aspx&quot;&gt;AsQueryable&lt;/a&gt;</code>. This takes an <code>IEnumerable</code>, checks if it&#x27;s actually an <code>IQueryable</code> slumming it and casts back to that if it is. You might use this in a situation where you didn&#x27;t have control over the data access code. Using it looks like this: (and would work whether <code>GetSagesWithSayings</code> was returning <code>IEnumerable</code><em>or</em><code>IQueryable</code>)</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><div tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">public IEnumerable&lt;Sage&gt; GetSagesWithSayingsBornWithinTheLast100Years()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    var aHundredYearsAgo = DateTime.Now.AddYears(-100);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    var sageWithSayings =GetSagesWithSayings().AsQueryable().Where(x =&gt; x.DateOfBirth &gt; aHundredYearsAgo);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    return sageWithSayings;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/tags/linq">LINQ</a><a class="margin-horiz--sm" href="/tags/i-enumerable-vs-i-queryable">IEnumerable vs IQueryable</a></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/page/116"><div class="pagination-nav__label">Â« Newer Entries</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/page/118"><div class="pagination-nav__label">Older Entries Â»</div></a></div></nav></main></div></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 John Reilly. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/styles.15bc6e2d.js"></script>
<script src="/assets/js/runtime~main.d656672b.js"></script>
<script src="/assets/js/main.f8627f17.js"></script>
<script src="/assets/js/1.40d4c38d.js"></script>
<script src="/assets/js/2.efe45cdf.js"></script>
<script src="/assets/js/a6aa9e1f.6b1591ee.js"></script>
<script src="/assets/js/c3b5bd8c.e43a454c.js"></script>
<script src="/assets/js/d1e4f970.aebeabb9.js"></script>
<script src="/assets/js/d0caa3ed.4aad9200.js"></script>
</body>
</html>