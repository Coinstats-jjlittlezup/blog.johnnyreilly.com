<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog.johnnyreilly.com/rss.xml" title="I CAN MAKE THIS WORK Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog.johnnyreilly.com/atom.xml" title="I CAN MAKE THIS WORK Blog Atom Feed"><title data-react-helmet="true">Blog | I CAN MAKE THIS WORK</title><meta data-react-helmet="true" property="og:title" content="Blog | I CAN MAKE THIS WORK"><meta data-react-helmet="true" name="description" content="Blog"><meta data-react-helmet="true" property="og:description" content="Blog"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><link data-react-helmet="true" rel="shortcut icon" href="/blog.johnnyreilly.com/img/favicon.ico"><link rel="stylesheet" href="/blog.johnnyreilly.com/styles.a755cef0.css">
<link rel="preload" href="/blog.johnnyreilly.com/styles.acafb066.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/runtime~main.ff161662.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/main.c1c76de5.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/1.08786e85.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/2.4fd9db96.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/a6aa9e1f.917b34ca.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/c3b5bd8c.4fdda474.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/3abeff07.16a82c7f.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/1c98e0b7.e0c88c91.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/02f5845d.7850f7d6.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/55f58b04.d7a7da13.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/94812da0.72b93b1e.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/4ab01ef3.e64fb5eb.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/0c9c4eef.099ce6a9.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/08a01f7a.9080d68b.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/9e16dc16.d36b23bb.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/3fde0b39.9418817b.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/673f6aae.55653e33.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/blog.johnnyreilly.com/"><img src="/blog.johnnyreilly.com/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/blog.johnnyreilly.com/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">I CAN MAKE THIS WORK</strong></a></div><div class="navbar__items navbar__items--right"><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/blog.johnnyreilly.com/"><img src="/blog.johnnyreilly.com/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/blog.johnnyreilly.com/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">I CAN MAKE THIS WORK</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"></ul></div></div></div></nav><div class="main-wrapper blog-wrapper"><div class="container margin-vert--lg"><div class="row"><div class="col col--2"><div class="sidebar_SWld thin-scrollbar"><h3 class="sidebarItemTitle_Km2m">Recent posts</h3><ul class="sidebarItemList_3UpA"><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog.johnnyreilly.com/2021/02/27/goodbye-client-affinity-hello-data-protection-with-azure">Goodbye Client Affinity, Hello Data Protection with Azure</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog.johnnyreilly.com/2021/02/16/easy-auth-tokens-survive-releases-on-linux-azure-app-service">Making Easy Auth tokens survive releases on Linux Azure App Service</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog.johnnyreilly.com/2021/02/11/azure-app-service-health-checks-and-zero-downtime-deployments">Azure App Service, Health checks and zero downtime deployments</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog.johnnyreilly.com/2021/02/08/arm-templates-security-role-assignments">ARM templates, security, role assignments and magic GUIDs</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog.johnnyreilly.com/2021/01/30/aspnet-serilog-and-application-insights">ASP.NET, Serilog and Application Insights</a></li></ul></div></div><main class="col col--8"><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_3-lP"><a href="/blog.johnnyreilly.com/2013/06/06/how-im-using-cassette-part-2">How I&#x27;m Using Cassette part 2:Get Cassette to Serve Scripts in Dependency Order</a></h2><div class="margin-vert--md"><time datetime="2013-06-06T00:00:00.000Z" class="blogPostDate_Ta7i">June 6, 2013  Â· 8 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener"><img src="https://avatars.githubusercontent.com/u/1010525?s=400&amp;u=294033082cfecf8ad1645b4290e362583b33094a&amp;v=4" alt="John Reilly"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener">John Reilly</a></h4><small class="avatar__subtitle"></small></div></div></header><section class="markdown"><p><a href="http://icanmakethiswork.blogspot.co.uk/2013/05/how-im-using-cassette.html" target="_blank" rel="noopener noreferrer">Last time</a> I wrote about Cassette I was talking about how to generally get up and running. How to use Cassette within an ASP.Net MVC project. What I want to write about now is (in my eyes) the most useful feature of Cassette by a country mile. This is Cassettes ability to ensure scripts are served in dependency order.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="why-does-this-matter"></a>Why does this matter?<a class="hash-link" href="#why-does-this-matter" title="Direct link to heading">#</a></h2><p>You might well ask. If we go back 10 years or so then really this wasn&#x27;t a problem. No-one was doing a great deal with JavaScript. And if they did anything it tended to be code snippets in amongst the HTML; nothing adventurous. But unless you&#x27;ve had your head in the sand for the last 3 years then you will have clearly noticed that JavaScript is in rude health and being used for all kinds of things you&#x27;d never have imagined. In fact some would have it that it&#x27;s the <a href="http://www.hanselman.com/blog/JavaScriptisAssemblyLanguagefortheWebPart2MadnessorjustInsanity.aspx" target="_blank" rel="noopener noreferrer">assembly language of the web</a>.</p><p>For my part, I&#x27;ve been doing more and more with JavaScript. And as I do more and more with it I seek to modularise my code; (<a href="http://en.wikipedia.org/wiki/Separation_of_concerns" target="_blank" rel="noopener noreferrer">like any good developer would</a>) breaking it up into discrete areas of functionality. I aim to only serve up the JavaScript that I need on a given page. And that would be all well and good but for one of the languages shortcomings. Modules. JavaScript doesn&#x27;t yet have a good module loading story to tell. (Apparently one&#x27;s coming in <a href="http://wiki.ecmascript.org/doku.php?id=harmony:modules" target="_blank" rel="noopener noreferrer">EcmaScript 6</a>). (I don&#x27;t want to get diverted into this topic as it&#x27;s a big area. But if you&#x27;re interested then you can read up a little on different approaches being used <a href="http://requirejs.org/docs/whyamd.html#today" target="_blank" rel="noopener noreferrer">here</a>. The ongoing contest between RequireJS and CommonJS frankly makes me want to keep my distance for now.)</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="it-depends"></a>It Depends<a class="hash-link" href="#it-depends" title="Direct link to heading">#</a></h2><p>Back to my point, JavaScripts native handling of script dependencies is non-existent. It&#x27;s real &quot;here be dragons&quot; territory. If you serve up, for example, Slave.js that depends on things set up in Master.js before you&#x27;ve actually served up Master.js, well it&#x27;s not a delightful debugging experience. The errors tend be obscure and it&#x27;s not always obvious what the correct ordering should be.</p><p>Naturally this creates something of a headache around my own JavaScript modules. A certain amount of jiggery-pokery is required to ensure that scripts are served in the correct order so that they run as expected. And as your application becomes more complicated / modular, the number of problems around this area increase exponentially. It&#x27;s <strong>really</strong> tedious. I don&#x27;t want to be thinking about managing that as I&#x27;m developing - I want to be focused on solving the problem at hand.</p><p>In short, what I want to do is reference a script file somewhere in my server-side pipeline. I could be in a view, a layout, a controller, a partial view, a HTML helper... - I just want to know that that script is going to turn up at the client in the right place in the HTML so it works. Always. And I don&#x27;t want to have to think about it any further than that.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="enter-cassette-riding-a-white-horse"></a>Enter Cassette, riding a white horse<a class="hash-link" href="#enter-cassette-riding-a-white-horse" title="Direct link to heading">#</a></h2><p>And this is where Cassette takes the pain away. To quote the documentation:</p><blockquote><p>&quot;<em>Some assets must be included in a page before others. For example, your code may use jQuery, so the jQuery script must be included first. Cassette will sort all assets based on references they declare.</em>&quot;</p></blockquote><p>Just the ticket!</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="declaring-references-server-side"></a>Declaring References Server-Side<a class="hash-link" href="#declaring-references-server-side" title="Direct link to heading">#</a></h2><p>What does this look like in reality? Let&#x27;s build on what I did last time to demonstrate how I make use of Asset References to ensure my scripts turn up in the order I require.</p><p>In my <code>_Layout.cshtml</code> file I&#x27;m going to remove the following reference from the head of the file:</p><p><code>Bundles.Reference(&quot;~/bundles/core&quot;);</code></p><p>I&#x27;m pulling this out of my layout page because it&#x27;s presence means that <strong>every</strong> page MVC serves up is also serving up jQuery and jQuery UI (which is what <code>~/bundles/core</code> is). If a page doesn&#x27;t actually make use of jQuery and / or jQuery UI then there&#x27;s no point in doing this.</p><p>&quot;<em>But wait!</em>&quot;, I hear you cry, &quot;<em>Haven&#x27;t you just caused a bug with your reckless action? I distinctly recall that the <code>Login.cshtml</code> page has the following code in place:</em>&quot;</p><p><code>Bundles.Reference(&quot;~/bundles/validate&quot;);</code></p><p>&quot;<em>And now with your foolhardy, nay, reckless attitude to the <code>~/bundles/core</code> bundle you&#x27;ve broken your Login screen. How can jQuery Validation be expected to work if there&#x27;s no jQuery there to extend?</em>&quot;</p><p>Well, I understand your concerns but really you needn&#x27;t worry - Cassette&#x27;s got my back. Look closely at the code below:</p><script src="https://gist.github.com/johnnyreilly/5693071.js?file=ReferencesValidateDependesOnCoreCassetteConfiguration.cs"></script><p>See it? The <code>~/bundles/validate</code> bundle declares a reference to the <code>~/bundles/core</code> bundle. The upshot of this is, that if you tell Cassette to reference <code>~/bundles/validate</code> it will ensure that before it renders that bundle it first renders any bundles that bundle depends on (in this case the <code>~/bundles/core</code> bundle).</p><p>This is a very simple demonstration of the feature but I can&#x27;t underplay just how useful I find this.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="declaring-references-in-your-javascript-itself"></a>Declaring References in your JavaScript itself<a class="hash-link" href="#declaring-references-in-your-javascript-itself" title="Direct link to heading">#</a></h2><p>And the good news doesn&#x27;t stop there. Let&#x27;s say you <strong>don&#x27;t</strong> want to maintain your references in a separate file. You&#x27;d rather declare references inside your JavaScript files themselves. Well - you can. Cassette caters for this through the usage of <a href="http://getcassette.net/documentation/v1/AssetReferences" target="_blank" rel="noopener noreferrer">Asset References</a>.</p><p>Let&#x27;s demo this. First of all add the following file at this location in the project: <code>~/Scripts/Views/Home/Index.js</code></p><script src="https://gist.github.com/johnnyreilly/5693071.js?file=Index.js"></script><p>The eagle-eyed amongst you will have noticed</p><ol><li>I&#x27;m mirroring the MVC folder structure inside the Scripts directory. (There&#x27;s nothing special about that by the way - it&#x27;s just a file structure I&#x27;ve come to find useful. It&#x27;s very easy to find the script associated with a View if the scripts share the same organisational approach as the Views.).</li><li>The purpose of the script is very simple, it fades out the main body of the screen, re-writes the HTML in that tag and then fades back in. It&#x27;s purpose is just to do something that is obvious to the user - so they can see the evidence of JavaScript executing.</li><li>Lastly and most importantly, do you notice that <code>// @reference ~/bundles/core</code> is the first line of the file? This is our script reference. It&#x27;s this that Cassette will be reading to pick up references.</li></ol><p>To make sure Cassette is picking up our brand new file let&#x27;s take a look at <code>CassetteConfiguration.cs</code> and uncomment the line of code below:</p><p><code>bundles.AddPerIndividualFile&lt;scriptbundle&gt;(&quot;~/Scripts/Views&quot;);&lt;/scriptbundle&gt;</code></p><p>With this in place Cassette will render out a bundle for each script in the Views subdirectory. Let&#x27;s see if it works. Add the following reference to our new JavaScript file in <code>~/Views/Home/Index.cshtml</code>:</p><p><code>Bundles.Reference(&quot;~/Scripts/Views/Home/Index.js&quot;);</code></p><p>If you browse to the home page of the application this is what you should now see:</p><p><a href="http://2.bp.blogspot.com/-tGZTEhhkGz8/Ua7xlgl3n5I/AAAAAAAAAcs/miNZsysrJeY/s1600/Index.js.png" target="_blank" rel="noopener noreferrer"><img src="http://2.bp.blogspot.com/-tGZTEhhkGz8/Ua7xlgl3n5I/AAAAAAAAAcs/miNZsysrJeY/s320/Index.js.png" alt="null"></a>What this means is, <code>Index.js</code> was served up by Cassette. And more importantly before <code>Index.js</code> was served the referenced <code>~/bundles/core</code> was served too.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="avoiding-the-gotcha"></a>Avoiding the Gotcha<a class="hash-link" href="#avoiding-the-gotcha" title="Direct link to heading">#</a></h2><p>There is a gotcha which I&#x27;ve discovered whilst using Cassette&#x27;s Asset References. Strictly speaking it&#x27;s a Visual Studio gotcha rather than a Cassette gotcha. It concerns Cassette&#x27;s support for Visual Studio XML style reference comments. In the example above I could have written this:</p><p><code>/// &amp;lt;reference path=&quot;~/bundles/core&quot; /&amp;gt;</code></p><p>Instead of this:</p><p><code>// @reference ~/bundles/core</code></p><p>It would fulfil exactly the same purpose and would work identically. But there&#x27;s a problem. Using Visual Studio XML style reference comments to refer to Cassette bundles appears to trash the Visual Studios JavaScript Intellisense. You&#x27;ll lose the Intellisense that&#x27;s driven by <code>~/Scripts/_references.js</code> in VS 2012. So if you value your Intellisense (and I do) my advice is to stick to using the standard Cassette references style instead.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="go-forth-and-reference"></a>Go Forth and Reference<a class="hash-link" href="#go-forth-and-reference" title="Direct link to heading">#</a></h2><p>There is also support in Cassette for CSS referencing (as well as other types of referencing relating to LESS and even CoffeeScript). I haven&#x27;t made use of CSS referencing myself as, in stark contrast to my JS, my CSS is generally one bundle of styles which I&#x27;m happy to be rendered on each page. But it&#x27;s nice to know the option is there if I wanted it.</p><p>Finally, as last time you can see what I&#x27;ve done in this post by just looking at the repository on <a href="https://github.com/johnnyreilly/CassetteDemo/tree/References" target="_blank" rel="noopener noreferrer">GitHub</a>. The changes I made are on the References branch of that particular repository.</p></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/script-references">script references</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/require-js">RequireJS</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/cassette">cassette</a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_3-lP"><a href="/blog.johnnyreilly.com/2013/05/04/how-im-using-cassette">How I&#x27;m Using Cassette part 1:Getting Up and Running</a></h2><div class="margin-vert--md"><time datetime="2013-05-04T00:00:00.000Z" class="blogPostDate_Ta7i">May 4, 2013  Â· 6 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener"><img src="https://avatars.githubusercontent.com/u/1010525?s=400&amp;u=294033082cfecf8ad1645b4290e362583b33094a&amp;v=4" alt="John Reilly"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener">John Reilly</a></h4><small class="avatar__subtitle"></small></div></div></header><section class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="backing-into-the-light"></a>Backing into the light<a class="hash-link" href="#backing-into-the-light" title="Direct link to heading">#</a></h2><p> For a while now, I&#x27;ve been seeking a bulletproof way to handle the following scenarios... all at the same time in the context of an ASP.Net MVC application:</p><ol><li>How to serve full-fat JavaScript in debug mode and minified in release mode</li><li>When debugging, ensure that the full-fat JS being served is definitely the latest version; and *<strong>not</strong>* from the cache. (The time I&#x27;ve wasted due to <a href="http://en.wikipedia.org/wiki/List_of_HTTP_status_codes#304" target="_blank" rel="noopener noreferrer">304&#x27;s</a>...)</li><li>How to add Javascript assets that need to be served up from any point in an ASP.Net MVC application (including views, layouts, partial views... even controllers if so desired) whilst preventing duplicate scripts from being served.</li><li>How to ensure that Javascript files are served up last to any web page to ensure a speedy feel to users (don&#x27;t want JS blocking rendering).</li><li>And last but certainly not least the need to load Javascript files in dependency order. If <code>myView.js</code> depends on jQuery then clearly <code>jQuery-latest.js</code> needs to be served before <code>myView.js</code>.</li></ol><p>Now the best, most comprehensive and solid looking solution to this problem has for some time seemed to me to be <a href="http://aboutcode.net/" target="_blank" rel="noopener noreferrer">Andrew Davey&#x27;s</a><a href="http://getcassette.net/" target="_blank" rel="noopener noreferrer">Cassette</a>. This addresses all my issues in one way or another, as well as bringing in a raft of other features (support for Coffeescript etc).</p><p>However, up until now I&#x27;ve slightly shied away from using Cassette as I was under the impression it had a large number of dependencies. That doesn&#x27;t appear to be the case at all. I also had some vague notion that I could quite simply build my own solution to these problems making use of Microsoft&#x27;s <a href="http://nuget.org/packages/Microsoft.AspNet.Web.Optimization/1.0.0" target="_blank" rel="noopener noreferrer">Web Optimization</a> which nicely handles my #1 problem above. However, looking again at the documentation Cassette was promising to handle scenarios #1 - #5 without breaking sweat. How could I ignore that? I figured I should do the sensible thing and take another look at it. And, lo and behold, when I started evaluating it again it seemed to be just what I needed.</p><p>With the minumum of fuss I was able to get an ASP.Net MVC 4 solution up and running, integrated with Cassette, which dealt with all my scenarios very nicely indeed. I thought it might be good to write this up over a short series of posts and share what my finished code looks like. If you follow the steps I go through below it&#x27;ll get you started using Cassette. Or you could skip to the end of this post and look at the repo on GitHub. Here we go...</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="adding-cassette-to-a-raw-mvc-4-project"></a>Adding Cassette to a raw MVC 4 project<a class="hash-link" href="#adding-cassette-to-a-raw-mvc-4-project" title="Direct link to heading">#</a></h2><p>Fire up Visual Studio and create a new MVC 4 project (I used the internet template to have some content in place).</p><p>Go to the Package Manager Console and key in &quot;<code>Install-Package Cassette.Aspnet</code>&quot;. Cassette will install itself.</p><p>Now you&#x27;ve got Cassette in place you may as well pull out usage of Web Optimization as you&#x27;re not going to need it any more.Be ruthless, delete App_Start/BundleConfig.cs and delete the line of code that references it in Global.asax.cs. If you take the time to run the app now you&#x27;ll see you&#x27;ve miraculously lost your CSS and your JavaScript. The code referencing it is still in place but there&#x27;s nothing for it to serve up. Don&#x27;t worry about that - we&#x27;re going to come back and Cassette-ify things later on...</p><p>You&#x27;ll also notice you now have a CassetteConfiguration.cs file in your project. Open it. Replace the contents with this (I&#x27;ve just commented out the default code and implemented my own CSS and Script bundles based on what is available in the default template of an MVC 4 app):</p><script src="https://gist.github.com/johnnyreilly/5393608.js?file=CassetteConfiguration.cs"></script><p>In the script above I&#x27;ve created 4 bundles, 1 stylesheet bundle and 3 JavaScript bundles - each of these is roughly equivalent to Web Optimization bundles that are part of the MVC 4 template:</p><dl><dt>~/bundles/css</dt><dd>Our site CSS - this includes both our own CSS and the jQuery UI CSS as well. This is the rough equivalent of the Web Optimization bundles <em>~/Content/css</em> and <em>~/Content/themes/base/css</em> brought together.</dd><dt>~/bundles/head</dt><dd>What scripts we want served in the head tag - Modernizr basically. Do note the setting of the <em>PageLocation</em> property - the purpose of this will become apparent later. This is the direct equivalent of the Web Optimization bundle: <em>~/bundles/modernizr</em>.</dd><dt>~/bundles/core</dt><dd>The scripts we want served on every page. For this example project I&#x27;ve picked jQuery and jQuery UI. This is the rough equivalent of the Web Optimization bundles <em>~/bundles/jquery</em> and <em>~/bundles/jqueryui</em> brought together.</dd><dt>~/bundles/validate</dt><dd>The validation scripts (that are dependent on the core scripts). This is the rough equivalent of the Web Optimization bundle: <em>~/bundles/jqueryval</em>.</dd></dl><p>At this point we&#x27;ve set up Cassette in our project - although we&#x27;re not making use of it yet. If you want to double check that everything is working properly then you can fire up your project and browse to &quot;Cassette.axd&quot; in the root. You should see something a bit like this:</p><p><a href="http://1.bp.blogspot.com/-xM9iU6HjB7o/UWzjAN5EieI/AAAAAAAAAaA/EAXTTnD6vdY/s1600/CassetteScripts.png" target="_blank" rel="noopener noreferrer"><img src="http://1.bp.blogspot.com/-xM9iU6HjB7o/UWzjAN5EieI/AAAAAAAAAaA/EAXTTnD6vdY/s320/CassetteScripts.png" alt="null"></a>## How Web Optimization and Cassette Differ</p><p>If you&#x27;re more familiar with the workings of Web Optimization than Cassette then it&#x27;s probably worth taking a moment to appreciate an important distinction between the slightly different ways each works.</p><p><strong>Web Optimization</strong></p><ol><li>Create bundles as desired.</li><li>Serve up bundles and / or straight JavaScript files as you like within your MVC views / partial views / layouts. </li></ol><p><strong>Cassette</strong></p><ol><li>Create bundles for *<strong>all</strong>* JavaScript files you wish to serve up. You may wish to create some bundles which consist of a number of a number of JavaScript files pushed together. But for each individual file you wish to serve you also need to create an individual bundle. (Failure to do so may mean you fall prey to the &quot;<em>Cannot find an asset bundle containing the path &quot;~/Scripts/somePath.js&quot;.</em>&quot;)</li><li>Reference bundles and / or individual JavaScript files in their individual bundles as you like within your MVC views / partial views / layouts / controllers / HTML helpers... the list goes on!</li><li>Render the referenced scripts to the page (typically just before the closing <code>body</code> tag)</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="making-use-of-our-bundles"></a>Making use of our Bundles<a class="hash-link" href="#making-use-of-our-bundles" title="Direct link to heading">#</a></h2><p>Now we&#x27;ve created our bundles let&#x27;s get the project serving up CSS and JavaScript using Cassette. First the layout file. Take the <code>_Layout.cshtml</code> file from this:</p><script src="https://gist.github.com/johnnyreilly/5393608.js?file=_LayoutBefore.cshtml"></script><p>To this:</p><script src="https://gist.github.com/johnnyreilly/5393608.js?file=_LayoutAfter.cshtml"></script><p>And now let&#x27;s take one of the views, <code>Login.cshtml</code> and take it from this:</p><script src="https://gist.github.com/johnnyreilly/5393608.js?file=LoginBefore.cshtml"></script><p>To this:</p><script src="https://gist.github.com/johnnyreilly/5393608.js?file=LoginAfter.cshtml"></script><p>So now you should be up and running with Cassette. If you want the code behind this then take I&#x27;ve put it on GitHub <a href="https://github.com/johnnyreilly/CassetteDemo" target="_blank" rel="noopener noreferrer">here</a>.</p></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/asp-net-mvc">asp.net mvc</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/andrew-davey">Andrew Davey</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/cassette">cassette</a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_3-lP"><a href="/blog.johnnyreilly.com/2013/04/26/a-navigation-animation-for-your-users">A navigation animation (for your users delectation)</a></h2><div class="margin-vert--md"><time datetime="2013-04-26T00:00:00.000Z" class="blogPostDate_Ta7i">April 26, 2013  Â· 6 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener"><img src="https://avatars.githubusercontent.com/u/1010525?s=400&amp;u=294033082cfecf8ad1645b4290e362583b33094a&amp;v=4" alt="John Reilly"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener">John Reilly</a></h4><small class="avatar__subtitle"></small></div></div></header><section class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="the-vexation"></a>The Vexation<a class="hash-link" href="#the-vexation" title="Direct link to heading">#</a></h2><p> The current application I&#x27;m working on lives within an <code>iframe</code>. A side effect of that is that my users no longer get the visual feedback that they&#x27;re used to as they navigate around the site. By &quot;visual feedback&quot; what I mean are the little visual tics that are displayed in the browser when you&#x27;re in the process of navigating from one screen to the next. Basically, these:</p><p><img src="http://1.bp.blogspot.com/-x_8VXvW0w1M/UXpam8TtPQI/AAAAAAAAAbI/uVFFkL8uBAc/s320/TheSpinCycleOfProgress.png"></p><p>When an application is nested in an <code>iframe</code> it seems that these visual tics aren&#x27;t propogated up to the top frame of the browser as the user navigates around. Clicking on links results in a short lag whilst nothing appears to be happening and then, BANG!, a new page is rendered. This is not a great user experience. There&#x27;s nothing to indicate that the link has been clicked on and the browser is doing something. Well, not in Internet Explorer at least - Chrome (my browser of choice) appears to do just that. But that&#x27;s really by the by, the people using my app will be using the corporate browser, IE; so I need to think about them.</p><p>Now I&#x27;m fully aware that this is more in the region of nice-to-have rather than absolute necessity. That said, my experience is that when users think an application isn&#x27;t responding fast enough their action point is usually &quot;click it again, and maybe once more for luck&quot;. To prevent this from happening, I wanted to give the users back some kind of steer when they were in the process of navigation, <code>iframe</code> or no <code>iframe</code>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="the-agreeable-resolution"></a>The Agreeable Resolution<a class="hash-link" href="#the-agreeable-resolution" title="Direct link to heading">#</a></h2><p>To that end, I&#x27;ve come up with something that I feel does the job, and does it well. I&#x27;ve taken a CSS animation courtesy of the good folk at <a href="http://cssload.net/" target="_blank" rel="noopener noreferrer">CSS Load</a> and embedded it in the layout of my application. This animation is hidden from view until the user navigates to another page. At that point, the CSS animation appears in the header of the screen and remains in place until the new screen is rendered. This is what it looks like:</p><p><img src="http://2.bp.blogspot.com/-RaGwl1llrDM/UX4pEiUfGWI/AAAAAAAAAbo/jSZC0skiLfQ/s320/NavigationAnimationAtWork.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="hows-that-work-then-guv"></a>How&#x27;s that work then guv?<a class="hash-link" href="#hows-that-work-then-guv" title="Direct link to heading">#</a></h2><p>You&#x27;re no doubt dazzled by the glory of it all. How was it accomplished? Well, it was actually a great deal easier than you might think. First of all we have the html:</p><script src="https://gist.github.com/johnnyreilly/5466370.js?file=navigationAnimation.html"></script><p>Apart from the outer <code>div</code> tag (#navigationAnimation) all of this is the HTML taken from <a href="http://cssload.net/" target="_blank" rel="noopener noreferrer">CSS Load</a>. If you wanted to use a different navigation animation you could easily replace the inner HTML with something else instead. Next up is the CSS, again courtesy of CSS Load (and it&#x27;s this that turns this simple HTML into sumptuous animated goodness):</p><script src="https://gist.github.com/johnnyreilly/5466370.js?file=navigationAnimation.css"></script><p>And finally we have the JavaScript which is responsible for showing animation when the user starts navigating:</p><script src="https://gist.github.com/johnnyreilly/5466370.js?file=navigationAnimation.js"></script><p>It&#x27;s helped along with a little jQuery here but this could easily be accomplished with vanilla JS if you fancied. The approach works by hooking into the <a href="https://developer.mozilla.org/en-US/docs/DOM/Mozilla_event_reference/beforeunload" target="_blank" rel="noopener noreferrer">beforeunload</a> event that fires when &quot;<em>the window, the document and its resources are about to be unloaded</em>&quot;. There&#x27;s a little bit more to the functionality in the JavaScript abover which I go into in the PPS below. Essentially that covers backwards compatibility with earlier versions of IE.</p><p>I&#x27;ve coded this up in a manner that lends itself to re-use. I can imagine that you might also want to make use of the navigation animation if, for example, you had an expensive AJAX operation on a page and you didn&#x27;t want the users to despair. So the navigation animation could become a kind of a generic &quot;I am doing something&quot; animation instead - I leave it to your disgression.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="oh-and-a-final-ps"></a>Oh, and a final PS<a class="hash-link" href="#oh-and-a-final-ps" title="Direct link to heading">#</a></h2><p>I had initially planned to use an old school animated GIF instead of a CSS animation. The thing that stopped me taking this course of action is that, to quote an <a href="http://stackoverflow.com/a/780617/761388" target="_blank" rel="noopener noreferrer">answer on Stack Overflow</a> &quot;<em>IE assumes that the clicking of a link heralds a new navigation where the current page contents will be replaced. As part of the process for perparing for that it halts the code that animates the GIFs.</em>&quot;. So I needed animation that stayed animated. And lo, there were CSS animations...</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="better-make-that-a-pps---catering-for-ie-9-and-earlier"></a>Better make that a PPS - catering for IE 9 and earlier<a class="hash-link" href="#better-make-that-a-pps---catering-for-ie-9-and-earlier" title="Direct link to heading">#</a></h2><p>I spoke a touch too soon when I expounded on how CSS animations were going to get me out of a hole. Unfortunately, and to my lasting regret, they aren&#x27;t supported in IE 9. And yes, at least for now that is what the users have. To get round this I&#x27;ve delved a little bit further and discovered a frankly hacky way to make animated gifs stay animated after beforeunload has fired. It works by rendering an animated gif to the screen when beforeunload is fired. Why this works I couldn&#x27;t say - but if you&#x27;re interested to research more then take a look at <a href="http://stackoverflow.com/a/1904931/761388" target="_blank" rel="noopener noreferrer">this answer on Stack Overflow</a>. In my case I&#x27;ve found an animated gif on <a href="http://www.ajaxload.info/" target="_blank" rel="noopener noreferrer">AjaxLoad</a> which looks pretty similar to the CSS animation:</p><p><img src="http://4.bp.blogspot.com/-_9OgkLfflAg/UYEXn7dgByI/AAAAAAAAAb8/3Q33pAs6WeM/s320/navigationAnimation.gif" alt="null">This is now saved away as <code>navigationAnimation.gif</code> in the application. The JavaScript uses Modernizr to detect if CSS animations are in play. If they&#x27;re not then the animated gif is rendered to the screen in place of the CSS animation HTML. Ugly, but it seems to work well; I think this will work on IE 6 - 9. The CSS animations will work on IE 10+.</p></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/navigation-animation">navigation animation</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/css-load">css load</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/ux">UX</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/css-animation">CSS animation</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/modernizr">Modernizr</a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_3-lP"><a href="/blog.johnnyreilly.com/2013/04/17/ie-10-install-torches-javascript">IE 10 Install Torches JavaScript Debugging in Visual Studio 2012 Through Auto Update (Probably)</a></h2><div class="margin-vert--md"><time datetime="2013-04-17T00:00:00.000Z" class="blogPostDate_Ta7i">April 17, 2013  Â· 2 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener"><img src="https://avatars.githubusercontent.com/u/1010525?s=400&amp;u=294033082cfecf8ad1645b4290e362583b33094a&amp;v=4" alt="John Reilly"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener">John Reilly</a></h4><small class="avatar__subtitle"></small></div></div></header><section class="markdown"><p>OK the title of this post is a little verbose. I&#x27;ve just wasted a morning of my life trying to discover what happened to my ability to debug JavaScript in Visual Studio 2012. If you don&#x27;t want to experience the same pain then read on...</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="the-symptoms"></a>The Symptoms<a class="hash-link" href="#the-symptoms" title="Direct link to heading">#</a></h2><ol><li>I&#x27;m not hitting my JavaScript breakpoints when I hit F5 in Visual Studio.</li><li><a href="http://msdn.microsoft.com/en-us/library/bb385621.aspx" target="_blank" rel="noopener noreferrer">Script Documents</a> is missing from the Solution Explorer when I&#x27;m debugging in Visual Studio.</li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="the-cure"></a>The Cure<a class="hash-link" href="#the-cure" title="Direct link to heading">#</a></h2><p>In the end, after a great deal of frustration, I happened upon <a href="http://stackoverflow.com/a/15908391/761388" target="_blank" rel="noopener noreferrer">this answer</a> on Stack Overflow. It set me in the right direction.</p><p>In my &quot;Browse With...&quot; drop down in Visual Studio I was *<strong>not</strong>* seeing this:</p><p><a href="http://3.bp.blogspot.com/-iRgBxdxUrkU/UW6csypEd3I/AAAAAAAAAaY/rNK6N79GT6k/s1600/BrowseWith.png" target="_blank" rel="noopener noreferrer"><img src="http://3.bp.blogspot.com/-iRgBxdxUrkU/UW6csypEd3I/AAAAAAAAAaY/rNK6N79GT6k/s320/BrowseWith.png" alt="null"></a>I was seeing exactly the same as this list but with <strong>TWO</strong> instances of Internet Explorer in the list instead of one. Odd, I know.</p><p>I fixed this up by selecting Google Chrome as my target instead of IE, running it and then setting it back to IE. And interestingly, when I went to set it back to IE there was only one instance of Internet Explorer in the list again.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="the-probable-cause"></a>The Probable Cause<a class="hash-link" href="#the-probable-cause" title="Direct link to heading">#</a></h2><p>My machine was auto updated from IE 9 to IE 10 just the other day. I *<strong>think</strong>* my JavaScript debugging issue appeared at the same time. This would explain to me why I had two instances of &quot;Internet Explorer&quot; in my list. Not certain but I&#x27;d say the evidence is fairly compelling.</p><p>Painful Microsoft. Painful</p></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/visual-studio-2012">Visual Studio 2012</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/java-script-debugging">JavaScript debugging</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/ie-10">IE 10</a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_3-lP"><a href="/blog.johnnyreilly.com/2013/04/09/making-ie-10s-clear-field-x-button-and">Making IE 10&#x27;s clear field (X) button and jQuery UI autocomplete play nice</a></h2><div class="margin-vert--md"><time datetime="2013-04-09T00:00:00.000Z" class="blogPostDate_Ta7i">April 9, 2013  Â· 2 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener"><img src="https://avatars.githubusercontent.com/u/1010525?s=400&amp;u=294033082cfecf8ad1645b4290e362583b33094a&amp;v=4" alt="John Reilly"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener">John Reilly</a></h4><small class="avatar__subtitle"></small></div></div></header><section class="markdown"><p>This morning when I logged on I was surprised to discover IE 10 had been installed onto my machine. I hadn&#x27;t taken any action to trigger this myself and so Iâ€™m assuming that this was part of the general Windows Update mechanism. I know <a href="http://technet.microsoft.com/en-us/ie/jj898508.aspx" target="_blank" rel="noopener noreferrer">Microsoft had planned to push IE 10 out through this mechanism</a>.</p><p> I was a little surprised that my work desktop had been upgraded without any notice. And I was initially rather concerned given that most of my users have IE 9 and now I didn&#x27;t have a test harness on my development machine any more. (I&#x27;ve generally found that having the majority users browser on your own machine is a good idea.) However, I wasn&#x27;t too concerned as I didnâ€™t think it would makes much of a difference to my development experience. I say that because IE10, as far as I understand, is basically IE 9 + more advanced CSS 3 and extra HTML 5 features. The rendering of my existing content developed for the IE 9 target should look pixel for pixel identical in IE 10. Thatâ€™s the theory anyway.</p><p>However, I have found one exception to this rule already. IE 10 provides clear field buttons in text boxes that look like this:</p><p><a href="http://3.bp.blogspot.com/-HRxuGdc6PhE/UWQMq15gKHI/AAAAAAAAAZg/XmFfFZBMHYk/s1600/ClearField.png" target="_blank" rel="noopener noreferrer"><img src="http://3.bp.blogspot.com/-HRxuGdc6PhE/UWQMq15gKHI/AAAAAAAAAZg/XmFfFZBMHYk/s320/ClearField.png" alt="null"></a>Unhappily I found these were clashing with our jQuery UI auto complete loading gif â€“ looking like this:</p><p><a href="http://3.bp.blogspot.com/-RPXGJkm1Lyk/UWQNCcFlmpI/AAAAAAAAAZo/pGP3IubeBiQ/s1600/ClearFieldMeetAutoComplete.png" target="_blank" rel="noopener noreferrer"><img src="http://3.bp.blogspot.com/-RPXGJkm1Lyk/UWQNCcFlmpI/AAAAAAAAAZo/pGP3IubeBiQ/s320/ClearFieldMeetAutoComplete.png" alt="null"></a>I know; ugly isn&#x27;t it? Happily I was able to resolve this with a CSS <strike>hack</strike></p><p> fix which looks like this:</p><script src="https://gist.github.com/johnnyreilly/5345373.js?file=ie10jQueryUI.css"></script><p>And now the jQuery UI autocomplete looks like we expect during the loading phase:</p><p><a href="http://3.bp.blogspot.com/-mzBwe7BGwjk/UWQNdEKiucI/AAAAAAAAAZw/OmUFi6zMY7g/s1600/AutoComplete.png" target="_blank" rel="noopener noreferrer"><img src="http://3.bp.blogspot.com/-mzBwe7BGwjk/UWQNdEKiucI/AAAAAAAAAZw/OmUFi6zMY7g/s320/AutoComplete.png" alt="null"></a>But happily when the autocomplete is not in the loading phase we still have access to the IE 10 clear field button. This works because the CSS selector above only applies to the <em>ui-autocomplete-loading</em> class (which is only applied to the textbox when the loading is taking place). So we still get to use this:</p><p><a href="http://3.bp.blogspot.com/-HRxuGdc6PhE/UWQMq15gKHI/AAAAAAAAAZg/XmFfFZBMHYk/s1600/ClearField.png" target="_blank" rel="noopener noreferrer"><img src="http://3.bp.blogspot.com/-HRxuGdc6PhE/UWQMq15gKHI/AAAAAAAAAZg/XmFfFZBMHYk/s320/ClearField.png" alt="null"></a>Which is nice.</p></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/autocomplete">autocomplete</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/j-query-ui">jQuery UI</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/clear-field-button">clear field button</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/ie-10">IE 10</a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_3-lP"><a href="/blog.johnnyreilly.com/2013/04/01/death-to-compatibility-mode">Death to compatibility mode</a></h2><div class="margin-vert--md"><time datetime="2013-04-01T00:00:00.000Z" class="blogPostDate_Ta7i">April 1, 2013  Â· 7 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener"><img src="https://avatars.githubusercontent.com/u/1010525?s=400&amp;u=294033082cfecf8ad1645b4290e362583b33094a&amp;v=4" alt="John Reilly"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener">John Reilly</a></h4><small class="avatar__subtitle"></small></div></div></header><section class="markdown"><p>For just over 10 years my bread and butter has been the development and maintenance of line of business apps. More particularly, web apps built on the Microsoft stack of love (<a href="https://channel9.msdn.com/Events/MIX/MIX11/FRM02" target="_blank" rel="noopener noreferrer">Â© Scott Hanselman</a>). These sort of apps are typically accessed via the company intranet and since &quot;bring your own device&quot; is still a relatively new innovation these apps are invariably built for everyones favourite browser: Internet Explorer. As we all know, enterprises are generally not that speedy when it comes to upgrades. So we&#x27;re basically talking IE 9 at best, but more often than not, IE 8.</p><p> Now, unlike many people, I don&#x27;t regard IE as a work of evil. I spent a fair number of years working for an organization which had IE 6 as the only installed browser on company desktops. (In fact, this was still the case as late as 2012!) Now, because JavaScript is so marvellously flexible I was still able to do a great deal with the help of a number of <a href="http://paulirish.com/2011/the-history-of-the-html5-shiv/" target="_blank" rel="noopener noreferrer">shivs / shims</a>.</p><p>But rendering and CSS - well that&#x27;s another matter. Because here we&#x27;re at the mercy of &quot;compatibility mode&quot;. Perhaps a quick history lesson is in order. What is this &quot;compatibility mode&quot; of which you speak?</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="a-brief-history"></a>A Brief History<a class="hash-link" href="#a-brief-history" title="Direct link to heading">#</a></h2><p>Well it all started when Microsoft released IE 8. To quote them:</p><blockquote><p><em>A fundamental problem discussed during each and every Internet Explorer release is balancing new features and functionality with site compatibility for the existing Web. On the one hand, new features and functionality push the Web forward. On the other hand, the Web is a large expanse; requiring every legacy page to support the &quot;latest and greatest&quot; browser version immediately at product launch just isn&#x27;t feasible. Internet Explorer 8 addresses this challenge by introducing compatibility modes which gives a way to introduce new features and stricter compliance to standards while enabling it to be backward compliant.</em> - excerpted from <a href="http://blogs.msdn.com/b/askie/archive/2009/03/23/understanding-compatibility-modes-in-internet-explorer-8.aspx" target="_blank" rel="noopener noreferrer">understanding compatibility modes in Internet Explorer 8</a>.</p></blockquote><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="theres-the-rub"></a>There&#x27;s the rub<a class="hash-link" href="#theres-the-rub" title="Direct link to heading">#</a></h2><p>Sounds fair enough? Of course it does. Microsoft have generally bent over backwards to facilitate backwards compatibility. Quite right too - good business sense and all that. However, one of the choices made around backwards compatibility I&#x27;ve come to regard as somewhat irksome. Later down in the article you&#x27;ll find this doozy: (emphasis mine)</p><blockquote><p><em>&quot;<strong>for Intranet pages, 7 (IE 7 Standards) rendering mode is used by default</strong> and can be changed.&quot;</em></p></blockquote><p>For whatever reason, this decision was not particularly well promoted. As a result, a fair number of devs I&#x27;ve encountered have little or no knowledge of compatibility mode. Certainly it came as a surprise to me. Here was I, developing away on my desktop. I&#x27;d fire up the app hosted on my machine and test on my local install of IE 8. All would look new and shiny (well non-anchor tags would have <code>:hover</code> support). Happy and content, I&#x27;d push to our test system and browse to it. Wait, what&#x27;s happened? Where&#x27;s the new style rendering? What&#x27;s up with my CSS? This is a bug right?</p><p>Obviously I know now it&#x27;s not a bug it&#x27;s a &quot;feature&quot;. And I have learned how to get round the intranet default of compatibility mode through cunning deployment of meta tags and custom http headers. Recently compatibility mode has come to bite me for the second time (in this case I was building for IE 9 and was left wondering where all my rounded corners had vanished to when I deployed...).</p><p>For my own sanity I thought it might be good to document the various ways that exist to solve this particular problem. Just to clarify terms, &quot;solve&quot; in this context means &quot;force IE to render in the most standards compliant / like other browsers fashion it can muster&quot;. You can use compatibility mode to do more than just that and if you&#x27;re interested in more about this then I recommend <a href="http://stackoverflow.com/a/6771584/761388" target="_blank" rel="noopener noreferrer">this Stack Overflow answer</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="solution-1-custom-http-header-through-webconfig"></a>Solution 1: Custom HTTP Header through web.config<a class="hash-link" href="#solution-1-custom-http-header-through-webconfig" title="Direct link to heading">#</a></h2><p>If you&#x27;re running IIS7 or greater then, for my money, this is the simplest and most pain free solution. All you need do is include the following snippet in your web config file:</p><script src="https://gist.github.com/johnnyreilly/5283462.js?file=web.config"></script><p>This will make IIS serve up the above custom response HTTP header with each page.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="solution-2-custom-http-header-the-hard-way"></a>Solution 2: Custom HTTP Header the hard way<a class="hash-link" href="#solution-2-custom-http-header-the-hard-way" title="Direct link to heading">#</a></h2><p>Maybe you&#x27;re running II6 and so you making a change to the web.config won&#x27;t make a difference. That&#x27;s fine, you can still get the same behaviour by going to the HTTP headers tab in IIS (see below) and adding the <code>X-UA-Compatible: IE=edge</code> header by hand.</p><p><a href="http://4.bp.blogspot.com/-78CYavaCiUk/UVlGNv87U_I/AAAAAAAAAZQ/qtchMc14JsY/s1600/CustomHeadersIIS6.gif" target="_blank" rel="noopener noreferrer"><img src="http://4.bp.blogspot.com/-78CYavaCiUk/UVlGNv87U_I/AAAAAAAAAZQ/qtchMc14JsY/s320/CustomHeadersIIS6.gif" alt="null"></a>Or, if you don&#x27;t have access to IIS (don&#x27;t laugh - it happens) you can fall back to doing this in code like this:</p><script src="https://gist.github.com/johnnyreilly/5283462.js?file=servingUpTheHardWay.cs"></script><p>Obviously there&#x27;s a whole raft of ways you could get this in, using <code>Application_BeginRequest</code> in <code>Global.asax.cs</code> would probably as good an approach as any.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="solution-3-meta-tags-are-go"></a>Solution 3: Meta Tags are go!<a class="hash-link" href="#solution-3-meta-tags-are-go" title="Direct link to heading">#</a></h2><p>The final approach uses meta tags. And, in my experience it is the most quirky approach - it doesn&#x27;t always seem to work. First up, what do we do? Well, in each page served we include the following meta tag like this:</p><script src="https://gist.github.com/johnnyreilly/5283462.js?file=any.html"></script><p>Having crawled over the WWW equivalent of broken glass I now know why this *<strong>sometimes</strong>* doesn&#x27;t work. (And credit where it&#x27;s due the answer came from <a href="http://stackoverflow.com/a/3960197/761388" target="_blank" rel="noopener noreferrer">here</a>.) It&#x27;s all down to the positioning of the meta tag:</p><blockquote><p><em>The X-UA-compatible header is not case sensitive; however, it must appear in the Web page&#x27;s header (the HEAD section) before all other elements, except for the title element and other meta elements.</em> - excerpted from <a href="http://msdn.microsoft.com/en-gb/library/jj676915(v=vs.85).aspx" target="_blank" rel="noopener noreferrer">specifying legacy document modes</a></p></blockquote><p>That&#x27;s right, get your meta tag in the wrong place and things won&#x27;t work. And you won&#x27;t know why. Lovely. But get it right and it&#x27;s all gravy. This remains the most unsatisfactory approach in my book though.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="and-for-bonus-points-iframes"></a>And for bonus points: <code>IFRAME</code>s!<a class="hash-link" href="#and-for-bonus-points-iframes" title="Direct link to heading">#</a></h2><p>Before I finish off I thought it worth sharing a little known feature of <code>IFRAME</code>s. If page is running in compatibility mode and it contains an <code>IFRAME</code> then the page loaded in that <code>IFRAME</code> will <strong>also run in compatibility mode</strong>. No ifs, no buts.</p><p>In the case that I encountered this behaviour, the application was being hosted in an <code>IFRAME</code> inside Sharepoint. Because of the way our Sharepoint was configured it ended up that the only real game in town for us was the meta tags approach - which happily worked once we&#x27;d correctly placed our meta tag.</p><p>Again, it&#x27;s lamentable that this behaviour isn&#x27;t better documented - hopefully the act of writing this here will mean that it becomes a little better known. There&#x27;s probably a good reason for this behaviour, though I&#x27;m frankly, I don&#x27;t know what it is. If anyone does, I&#x27;d be interested.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="thats-it"></a>That&#x27;s it<a class="hash-link" href="#thats-it" title="Direct link to heading">#</a></h2><p>Armed with the above I hope you have less compatibility mode pain than I have. The following blog entry is worth a read by the way:</p><p><a href="http://blogs.msdn.com/b/ie/archive/2009/02/16/just-the-facts-recap-of-compatibility-view.aspx" target="_blank" rel="noopener noreferrer">http://blogs.msdn.com/b/ie/archive/2009/02/16/just-the-facts-recap-of-compatibility-view.aspx</a></p><p>Finally, I have an open question about compatibility mode. I <em>think</em> (but I don&#x27;t know) that even in compatibility mode IE runs using the same JavaScript engine. However I suspect it has a different DOM to play with. If anyone knows a little more about this and wants to let me know that&#x27;d be fantastic.</p></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/css">css</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/intranet">intranet</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/meta">meta</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/internet-explorer">internet explorer</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/compatibility-mode">compatibility mode</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/header">header</a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_3-lP"><a href="/blog.johnnyreilly.com/2013/03/11/decimalmodelbinder-for-nullable-decimals">DecimalModelBinder for nullable Decimals</a></h2><div class="margin-vert--md"><time datetime="2013-03-11T00:00:00.000Z" class="blogPostDate_Ta7i">March 11, 2013  Â· 2 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener"><img src="https://avatars.githubusercontent.com/u/1010525?s=400&amp;u=294033082cfecf8ad1645b4290e362583b33094a&amp;v=4" alt="John Reilly"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener">John Reilly</a></h4><small class="avatar__subtitle"></small></div></div></header><section class="markdown"><p>My memory appears to be a sieve. Twice in the last year I&#x27;ve forgotten that MVCs ModelBinding doesn&#x27;t handle regionalised numbers terribly well. Each time I&#x27;ve thought &quot;hmmmm.... best Google that&quot; and lo and behold come upon this post on the issue by the fantastic Phil Haack:</p><p> <a href="http://haacked.com/archive/2011/03/19/fixing-binding-to-decimals.aspx" target="_blank" rel="noopener noreferrer">http://haacked.com/archive/2011/03/19/fixing-binding-to-decimals.aspx </a></p><p>This post has got me 90% of the way there, the last 10% being me tweaking it so the model binder can handle nullable decimals as well.</p><p>In the expectation I that I may forget this again I thought I&#x27;d note down my tweaks now and hopefully save myself sometime when I&#x27;m next looking at this next...</p><script src="https://gist.github.com/johnnyreilly/5135647.js?file=DecimalModelBinder.cs"></script><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="and-now-a-question"></a>And now a question...<a class="hash-link" href="#and-now-a-question" title="Direct link to heading">#</a></h2><p>Why hasn&#x27;t MVC got an out-of-the-box model binder that does this anyway? In Phil Haack&#x27;s original post it looks like they were considering putting this into MVC itself at some point:</p><p>&quot;<em>... In that case, the DefaultModelBinder chokes on the value. This is unfortunate because jQuery Validate allows that value just fine. Iâ€™ll talk to the rest of my team about whether we should fix this in the next version of ASP.NET MVC, but for now itâ€™s good to know thereâ€™s a workaround...</em>&quot;</p><p>If anyone knows the reason this never made it into core I&#x27;d love to know. Maybe there&#x27;s a good reason?</p></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/phil-haack">Phil Haack</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/globalization">Globalization</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/model-binder">ModelBinder</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/nullable">nullable</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/decimal">decimal</a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_3-lP"><a href="/blog.johnnyreilly.com/2013/03/03/unit-testing-modelstate">Unit testing ModelState</a></h2><div class="margin-vert--md"><time datetime="2013-03-03T00:00:00.000Z" class="blogPostDate_Ta7i">March 3, 2013  Â· 5 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener"><img src="https://avatars.githubusercontent.com/u/1010525?s=400&amp;u=294033082cfecf8ad1645b4290e362583b33094a&amp;v=4" alt="John Reilly"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener">John Reilly</a></h4><small class="avatar__subtitle"></small></div></div></header><section class="markdown"><ul><li>Me: &quot;It can&#x27;t be done&quot;</li><li>Him: &quot;Yes it can&quot;</li><li>Me: &quot;No it can&#x27;t&quot;</li><li>Him: &quot;Yes it can, I&#x27;ve just done it&quot;</li><li>Me: &quot;Ooooh! Show me ...&quot;</li></ul><p> The above conversation (or one much like it) took place between my colleague Marc Talary and myself a couple of weeks ago. It was one of those faintly embarrassing situations where you state your case with absolute certainty only to subsequently discover that you were *<strong>completely</strong>* wrong. Ah arrogance, thy name is Reilly...</p><p>The disputed situation in this case was ModelState validation in ASP.Net MVC. How can you unit test a models validation driven by <code>DataAnnotations</code>? If at all. Well it can be done, and here&#x27;s how.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="simple-scenario"></a>Simple scenario<a class="hash-link" href="#simple-scenario" title="Direct link to heading">#</a></h2><p>Let&#x27;s start with a simple model:</p><script src="https://gist.github.com/johnnyreilly/5069901.js?file=CarModel.cs"></script><p>And let&#x27;s have a controller which makes use of that model:</p><script src="https://gist.github.com/johnnyreilly/5069901.js?file=CarController.cs"></script><p>When I was first looking at unit testing this I was slightly baffled by the behaviour I witnessed. I took an invalid model (where the properties set on the model were violating the model&#x27;s validation <code>DataAnnotations</code>):</p><script src="https://gist.github.com/johnnyreilly/5069901.js?file=NaomiCampbell.cs"></script><p>I passed the invalid model to the <code>Edit</code> controller action inside a unit test. My expectation was that the <code>ModelState.IsValid</code> code path would *<strong>not</strong>* be followed as this was *<strong>not</strong>* a valid model. So <code>ModelState.IsValid</code> should evaluate to <code>false</code>, right? Wrong!</p><p>Contrary to my expectation the validity of <code>ModelState</code> is not evaluated on the fly inside the controller. Rather it is determined during the model binding that takes place *<strong>before</strong>* the actual controller action method is called. And that completely explains why during my unit test with an invalid model we find we&#x27;re following the <code>ModelState.IsValid</code> code path.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="back-to-the-dispute"></a>Back to the dispute<a class="hash-link" href="#back-to-the-dispute" title="Direct link to heading">#</a></h2><p>As this blog post started off I was slightly missing Marc&#x27;s point. I thought he was saying we should be testing the <code>ModelState.IsValid == false</code> code path. And given that <code>ModelState</code> is determined before we reach the controller my view was that the only way to achieve this was through making use of <code>ModelState.AddModelError</code> in our unit test (you can read a good explanation of that <a href="http://stackoverflow.com/a/3816143/761388" target="_blank" rel="noopener noreferrer">here</a>). And indeed we were already testing for this; we were surfacing errors via a <code>JsonResult</code> and so had a test in place to ensure that <code>ModelState</code> errors were transformed in the manner we would expect.</p><p>However, Marc&#x27;s point was actually that we should have unit tests that enforced our design. That is to say, if we&#x27;d decided a certain property on a model was mandatory we should have a test that checked that this was indeed the case. If someone came along later and removed the <code>Required</code> data annotation then we wanted that test to fail.</p><p>It&#x27;s worth saying, we didn&#x27;t want a unit test to ensure that ASP.Net MVC worked as expected. Rather, where we had used DataAnnotations against our models to drive validation, we wanted to ensure the validation didn&#x27;t disappear further down the track. Just to be clear: we wanted to test our code, not Microsoft&#x27;s.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="now-i-get-to-learn-something"></a>Now I get to learn something<a class="hash-link" href="#now-i-get-to-learn-something" title="Direct link to heading">#</a></h2><p>When I grasped Marc&#x27;s point I thought that the the only way to write these tests would be to make use of reflection. And whilst we could certainly do that I wasn&#x27;t entirely happy with that as a solution. To my mind it was kind of testing &quot;at one remove&quot;, if you see what I mean. What I really wanted was to see that MVC was surfacing validations in the manner I might have hoped. And you can!</p><p>.... Drum roll... Ladies and gents may I present Marc&#x27;s <code>ModelStateTestController</code>:</p><script src="https://gist.github.com/johnnyreilly/5069901.js?file=ModelStateTestController.cs"></script><p>This class is, as you can see, incredibly simple. It is a controller, it inherits from <code>System.Web.Mvc.Controller</code> and establishes a mock context in the constructor using MOQ. This controller exposes a single method: <code>TestTryValidateModel</code>. This method internally determines the controller&#x27;s <code>ModelState</code> given the supplied object by calling off to Mvc&#x27;s (protected) <code>TryValidateModel</code> method (<code>TryValidateModel</code> evaluates <code>ModelState</code>).</p><p>This simple class allows us to test the validations on a model in a simple fashion that stays close to the way our models will actually be used in the wild. It&#x27;s pragmatic and it&#x27;s useful.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="an-example"></a>An example<a class="hash-link" href="#an-example" title="Direct link to heading">#</a></h2><p>Let me wrap up with an example unit test. The test below makes use of the <code>ModelStateTestController</code> to check the application of the DataAnnotations on our model:</p><script src="https://gist.github.com/johnnyreilly/5069901.js?file=ModelStateUnitTests.cs"></script><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="wrapping-up"></a>Wrapping up<a class="hash-link" href="#wrapping-up" title="Direct link to heading">#</a></h2><p>In a way I think it&#x27;s a shame that <code>TryValidateModel</code> is a protected method. If it weren&#x27;t it would be simplicity to write a unit test which tested the ModelState directly in context of the action method. It would be possible to get round this by establishing a base controller class which all our controllers would inherit from which implemented the <code>TestTryValidateModel</code> method from above. On the other hand maybe it&#x27;s good to have clarity of the difference between testing model validations and testing controller actions. Something to ponder...</p></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/asp-net-mvc">asp.net mvc</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/marc-talary">Marc Talary</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/data-annotations">DataAnnotations</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/controller">Controller</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/model-state">ModelState</a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_3-lP"><a href="/blog.johnnyreilly.com/2013/02/18/unit-testing-mvc-controllers-mocking">Unit testing MVC controllers / Mocking UrlHelper</a></h2><div class="margin-vert--md"><time datetime="2013-02-18T00:00:00.000Z" class="blogPostDate_Ta7i">February 18, 2013  Â· 3 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener"><img src="https://avatars.githubusercontent.com/u/1010525?s=400&amp;u=294033082cfecf8ad1645b4290e362583b33094a&amp;v=4" alt="John Reilly"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener">John Reilly</a></h4><small class="avatar__subtitle"></small></div></div></header><section class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="i-have-put-a-name-to-my-pain"></a>I have put a name to my pain...<a class="hash-link" href="#i-have-put-a-name-to-my-pain" title="Direct link to heading">#</a></h2><p> And it is unit testing ASP.Net MVC controllers.</p><p>Well perhaps that&#x27;s unfair. I have no problem unit testing MVC controllers.... <strong>until</strong> it comes to making use of the &quot;innards&quot; of MVC. Let me be more specific. This week I had a controller action that I needed to test. It looked a little like this:</p><script src="https://gist.github.com/johnnyreilly/4959924.js?file=DemoController.cs"></script><p>Looks fine right? It&#x27;s an action that takes a simple object as an argument. That&#x27;s ok. It returns a JsonResult. No worries. The JsonResult consists of an anonymous class. De nada. The anonymous class has one property that is driven by the controllers <code>UrlHelper</code>. Yeah that shouldn&#x27;t be an issue... <strong>Hold your horses sunshine - you&#x27;re going nowhere!</strong></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="getting-disillusioned"></a>Getting disillusioned<a class="hash-link" href="#getting-disillusioned" title="Direct link to heading">#</a></h2><p>Yup, the minute you start pumping in asserts around that <code>UrlHelper</code> driven property you&#x27;re going to be mighty disappointed. What, you didn&#x27;t expect the result to be <code>null</code>? Damn shame.</p><p>Despite <a href="http://msdn.microsoft.com/en-us/magazine/dd942838.aspx" target="_blank" rel="noopener noreferrer">articles</a> on MSDN about how the intention is for MVC to be deliberately testable the sad fact of the matter is that there is a yawning hole around the testing support for controllers in ASP.Net MVC. Whenever you try to test something that makes use of controller &quot;gubbins&quot; you have <strong>serious</strong> problems. And unfortunately I didn&#x27;t find anyone out there who could offer the whole solution.</p><p>After what I can best describe as a day of pain I found a way to scratch my particular itch. I found a way to write unit tests for controllers that made use of UrlHelper. As a bonus I managed to include the unit testing of Routes and Areas (well kind of) too.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="mvcmockcontrollers-updated"></a>MvcMockControllers updated<a class="hash-link" href="#mvcmockcontrollers-updated" title="Direct link to heading">#</a></h2><p>This solution is heavily based on the work of Scott Hanselman who <a href="http://www.hanselman.com/blog/ASPNETMVCSessionAtMix08TDDAndMvcMockHelpers.aspx" target="_blank" rel="noopener noreferrer">wrote and blogged about <code>MvcMockHelpers</code></a> back in 2008. Essentially I&#x27;ve taken this and tweaked it so I could achieve my ends. My version of <code>MvcMockHelpers</code> looks a little like this:</p><script src="https://gist.github.com/johnnyreilly/4959924.js?file=MvcMockHelpers.cs"></script><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="what-i-want-to-test"></a>What I want to test<a class="hash-link" href="#what-i-want-to-test" title="Direct link to heading">#</a></h2><p>I want to be able to unit test the controller <code>Edit</code> method I mentioned earlier. This method calls the <code>Action</code> method on the controllers <code>Url</code> member (which is, in turn, a <code>UrlHelper</code>) to generate a URL for passing pack to the client. The URL generated should fit with the routing mechanism I have set up. In this case the route we expect a URL for was mapped by the following area registration:</p><script src="https://gist.github.com/johnnyreilly/4959924.js?file=DemoAreaRegistration.cs"></script><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="enough-of-the-waffle---show-me-a-unit-test"></a>Enough of the waffle - show me a unit test<a class="hash-link" href="#enough-of-the-waffle---show-me-a-unit-test" title="Direct link to heading">#</a></h2><p>Now to the meat; here&#x27;s a unit test which demonstrates how this is used:</p><script src="https://gist.github.com/johnnyreilly/4959924.js?file=UnitTestingAnAreaUsingUrlHelper.cs"></script><p>Let&#x27;s go through this unit test and breakdown what&#x27;s happening:</p><ol><li>Arrange</li><li>Act</li><li>Assert</li></ol><p>The most interesting thing you&#x27;ll note is the controller&#x27;s UrlHelper is now generating a URL as we might have hoped. The URL is generated making use of our routing, yay! Finally we&#x27;re also managing to unit test a route registered by our area.</p></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/mvc">MVC</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/unit-testing">unit testing</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/area-registration-register-all-areas">AreaRegistration.RegisterAllAreas()</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/moq">MOQ</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/url-helper">UrlHelper</a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_3-lP"><a href="/blog.johnnyreilly.com/2013/02/13/using-expressions-with-constructors">Using Expressions with Constructors</a></h2><div class="margin-vert--md"><time datetime="2013-02-13T00:00:00.000Z" class="blogPostDate_Ta7i">February 13, 2013  Â· 2 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener"><img src="https://avatars.githubusercontent.com/u/1010525?s=400&amp;u=294033082cfecf8ad1645b4290e362583b33094a&amp;v=4" alt="John Reilly"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener">John Reilly</a></h4><small class="avatar__subtitle"></small></div></div></header><section class="markdown"><p>Every now and then you think &quot;x should be easy&quot; - and it isn&#x27;t. I had one of those situations this morning. Something I thought would take 5 minutes had me still pondering 30 minutes later. I finally cracked it (with the help of a colleague - thanks Marc!) and I wanted to note down what I did since I&#x27;m sure to forget this.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="so-whats-the-problem"></a>So what&#x27;s the problem?<a class="hash-link" href="#so-whats-the-problem" title="Direct link to heading">#</a></h2><p>In our project we had a very simple validation class. It looked a bit like this:</p><script src="https://gist.github.com/johnnyreilly/4944545.js?file=FieldValidationBefore.cs"></script><p>I wanted to take this class and extend it to have a constructor which allowed me to specify a Type and subsequently an Expression of that Type that allowed me to specify a property. 10 points if you read the last sentence and understood it without reading it a second time.</p><p>Code is a better illustration; take a look below. I wanted to go from #1 to #2:</p><script src="https://gist.github.com/johnnyreilly/4944545.js?file=HowItIsUsed.cs"></script><p>&quot;Why?&quot; I hear you ask. Well we had a swathe of statements in the code which test each property for a problem and would create a <code>FieldValidation</code> with the very same property name if one was found. There&#x27;s no real problem with that but I&#x27;m a man that likes to refactor. Property names change and I didn&#x27;t want to have to remember to manually go through each <code>FieldValidation</code> keeping these in line. If I was using the actual property name to drive the creation of my <code>FieldValidations</code> then that problem disappears. And I like that.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="so-whats-the-solution"></a>So what&#x27;s the solution?<a class="hash-link" href="#so-whats-the-solution" title="Direct link to heading">#</a></h2><p>Well it&#x27;s this:</p><script src="https://gist.github.com/johnnyreilly/4944545.js?file=FieldValidationAfter.cs"></script><p>As you can see we have taken the original FieldValidation class and added in a generic constructor which instead of taking <code>string fieldName</code> as a first argument it takes <code>Expression&amp;lt;Func&amp;lt;T, object&amp;gt;&amp;gt; expression</code>. LINQ&#x27;s Expression magic is used to determine the supplied property name which is smashing. If you were wondering, the first <code>MemberExpression</code> code is used for <em>reference</em> types. The <code>UnaryExpression</code> wrapping a <code>MemberExpression</code> code is used for <em>value</em> types. A good explanation of this can be found <a href="http://stackoverflow.com/a/12975480/761388" target="_blank" rel="noopener noreferrer">here</a>.</p><p>My colleague directed me to <a href="http://stackoverflow.com/a/2916344" target="_blank" rel="noopener noreferrer">this crucial StackOverflow answer</a> which provided some much needed direction when I was thrashing. And that&#x27;s it; we&#x27;re done, home free.</p></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/expression">Expression</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/constructors">Constructors</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/generic">Generic</a></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog.johnnyreilly.com/page/17"><div class="pagination-nav__label">Â« Newer Entries</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog.johnnyreilly.com/page/19"><div class="pagination-nav__label">Older Entries Â»</div></a></div></nav></main></div></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 John Reilly. Built with Docusaurus.</div></div></div></footer></div>
<script src="/blog.johnnyreilly.com/styles.acafb066.js"></script>
<script src="/blog.johnnyreilly.com/runtime~main.ff161662.js"></script>
<script src="/blog.johnnyreilly.com/main.c1c76de5.js"></script>
<script src="/blog.johnnyreilly.com/1.08786e85.js"></script>
<script src="/blog.johnnyreilly.com/2.4fd9db96.js"></script>
<script src="/blog.johnnyreilly.com/a6aa9e1f.917b34ca.js"></script>
<script src="/blog.johnnyreilly.com/c3b5bd8c.4fdda474.js"></script>
<script src="/blog.johnnyreilly.com/3abeff07.16a82c7f.js"></script>
<script src="/blog.johnnyreilly.com/1c98e0b7.e0c88c91.js"></script>
<script src="/blog.johnnyreilly.com/02f5845d.7850f7d6.js"></script>
<script src="/blog.johnnyreilly.com/55f58b04.d7a7da13.js"></script>
<script src="/blog.johnnyreilly.com/94812da0.72b93b1e.js"></script>
<script src="/blog.johnnyreilly.com/4ab01ef3.e64fb5eb.js"></script>
<script src="/blog.johnnyreilly.com/0c9c4eef.099ce6a9.js"></script>
<script src="/blog.johnnyreilly.com/08a01f7a.9080d68b.js"></script>
<script src="/blog.johnnyreilly.com/9e16dc16.d36b23bb.js"></script>
<script src="/blog.johnnyreilly.com/3fde0b39.9418817b.js"></script>
<script src="/blog.johnnyreilly.com/673f6aae.55653e33.js"></script>
</body>
</html>