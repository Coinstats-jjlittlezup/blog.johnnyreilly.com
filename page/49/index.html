<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.71">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="I CAN MAKE THIS WORK Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="I CAN MAKE THIS WORK Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-51754530-2","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><title data-react-helmet="true">I CAN MAKE THIS WORK | I CAN MAKE THIS WORK</title><meta data-react-helmet="true" property="og:title" content="I CAN MAKE THIS WORK | I CAN MAKE THIS WORK"><meta data-react-helmet="true" name="description" content="The blog of johnnyreilly"><meta data-react-helmet="true" property="og:description" content="The blog of johnnyreilly"><meta data-react-helmet="true" property="og:image" content="https://blog.priou.com/img/profile.png"><meta data-react-helmet="true" name="twitter:image" content="https://blog.priou.com/img/profile.png"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://blog.priou.com/page/49"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="blog_posts_list"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://blog.priou.com/page/49"><link data-react-helmet="true" rel="alternate" href="https://blog.priou.com/page/49" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://blog.priou.com/page/49" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.aa821496.css">
<link rel="preload" href="/assets/js/styles.08338fad.js" as="script">
<link rel="preload" href="/assets/js/runtime~main.734d3b47.js" as="script">
<link rel="preload" href="/assets/js/main.41ca5b25.js" as="script">
<link rel="preload" href="/assets/js/1.8ac526a0.js" as="script">
<link rel="preload" href="/assets/js/2.fbe8cf29.js" as="script">
<link rel="preload" href="/assets/js/a6aa9e1f.a367a3ad.js" as="script">
<link rel="preload" href="/assets/js/c3b5bd8c.f182eab6.js" as="script">
<link rel="preload" href="/assets/js/6eb1980c.e40cec04.js" as="script">
<link rel="preload" href="/assets/js/04c55e47.0ce4f546.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">I CAN MAKE THIS WORK</strong></a><a class="navbar__item navbar__link" href="/about">About</a><a class="navbar__item navbar__link" href="/blog-archive">Blog Archive</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/johnnyreilly" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><a href="https://twitter.com/johnny_reilly" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Twitter</a><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_GrZ2"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">I CAN MAKE THIS WORK</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/about">About</a></li><li class="menu__list-item"><a class="menu__link" href="/blog-archive">Blog Archive</a></li><li class="menu__list-item"><a href="https://github.com/johnnyreilly" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li><li class="menu__list-item"><a href="https://twitter.com/johnny_reilly" target="_blank" rel="noopener noreferrer" class="menu__link">Twitter</a></li></ul></div></div></div></nav><div class="main-wrapper blog-wrapper"><div class="container margin-vert--lg"><div class="row"><div class="col col--3"><div class="sidebar_2ahu thin-scrollbar"><h3 class="sidebarItemTitle_2hhb">Recent posts</h3><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/2021/03/15/from-blogger-to-docusaurus">From Blogger to Docusaurus</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/2021/03/10/managed-identity-azure-sql-entity-framework">Managed Identity, Azure SQL and Entity Framework</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/2021/03/06/generate-typescript-and-csharp-clients-with-nswag">Generate TypeScript and CSharp clients with NSwag based on an API</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/2021/02/27/goodbye-client-affinity-hello-data-protection-with-azure">Goodbye Client Affinity, Hello Data Protection with Azure</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/2021/02/16/easy-auth-tokens-survive-releases-on-linux-azure-app-service">Making Easy Auth tokens survive releases on Linux Azure App Service</a></li></ul></div></div><main class="col col--7"><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_GeHD"><a href="/2019/03/22/google-analytics-api-and-aspnet-core">Google Analytics API and ASP.Net Core</a></h2><div class="margin-vert--md"><time datetime="2019-03-22T00:00:00.000Z" class="blogPostDate_fNvV">March 22, 2019 Â· 3 min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/johnnyreilly" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars.githubusercontent.com/u/1010525?s=400&amp;u=294033082cfecf8ad1645b4290e362583b33094a&amp;v=4" alt="John Reilly"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/johnnyreilly" target="_blank" rel="noopener noreferrer">John Reilly</a></h4><small class="avatar__subtitle"></small></div></div></header><div class="markdown"><p>Some of my posts are meaningful treaties on the nature of software development. Some are detailed explanations of approaches you can use. Some are effectively code dumps. This is one of those.</p><p>I recently had need to be able to access the API for Google Analytics from ASP.Net Core. Getting this up and running turned out to be surprisingly tough because of an absence of good examples. So here it is; an example of how you can access a simple page access stat using <a href="https://www.nuget.org/packages/Google.Apis.AnalyticsReporting.v4/" target="_blank" rel="noopener noreferrer">the API</a>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><div tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar"><div class="codeBlockLines_39YC" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">async Task&lt;SomeKindOfDataStructure[]&gt; GetUsageFromGoogleAnalytics(DateTime startAtThisDate, DateTime endAtThisDate)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // Create the DateRange object. Here we want data from last week.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    var dateRange = new DateRange</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        StartDate = startAtThisDate.ToString(&quot;yyyy-MM-dd&quot;),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        EndDate = endAtThisDate.ToString(&quot;yyyy-MM-dd&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    };</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // Create the Metrics and dimensions object.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // var metrics = new List&lt;Metric&gt; { new Metric { Expression = &quot;ga:sessions&quot;, Alias = &quot;Sessions&quot; } };</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // var dimensions = new List&lt;Dimension&gt; { new Dimension { Name = &quot;ga:pageTitle&quot; } };</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    var metrics = new List&lt;Metric&gt; { new Metric { Expression = &quot;ga:uniquePageviews&quot; } };</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    var dimensions = new List&lt;Dimension&gt; { </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        new Dimension { Name = &quot;ga:date&quot; },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        new Dimension { Name = &quot;ga:dimension1&quot; } </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    };</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // Get required View Id from configuration</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    var viewId = $&quot;ga:{&quot;[VIEWID]&quot;}&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // Create the Request object.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    var reportRequest = new ReportRequest</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        DateRanges = new List&lt;DateRange&gt; { dateRange },</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Metrics = metrics,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Dimensions = dimensions,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        FiltersExpression = &quot;ga:pagePath==/index.html&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        ViewId = viewId</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    };</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    var getReportsRequest = new GetReportsRequest {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        ReportRequests = new List&lt;ReportRequest&gt; { reportRequest }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    };</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    //Invoke Google Analytics API call and get report</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    var analyticsService = GetAnalyticsReportingServiceInstance();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    var response = await (analyticsService.Reports.BatchGet(getReportsRequest)).ExecuteAsync();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    var logins = response.Reports[0].Data.Rows.Select(row =&gt; new SomeKindOfDataStructure {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Date = new DateTime(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            year: Convert.ToInt32(row.Dimensions[0].Substring(0, 4)), </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            month: Convert.ToInt32(row.Dimensions[0].Substring(4, 2)), </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            day: Convert.ToInt32(row.Dimensions[0].Substring(6, 2))),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        NumberOfLogins = Convert.ToInt32(row.Metrics[0].Values[0])</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    })</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .OrderByDescending(login =&gt; login.Date)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .ToArray();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    return logins;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">/// &lt;summary&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">/// Intializes and returns Analytics Reporting Service Instance</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">/// &lt;/summary&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">AnalyticsReportingService GetAnalyticsReportingServiceInstance() {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    var googleAuthFlow = new GoogleAuthorizationCodeFlow(new GoogleAuthorizationCodeFlow.Initializer {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        ClientSecrets = new ClientSecrets {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            ClientId = &quot;[CLIENTID]&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            ClientSecret = &quot;[CLIENTSECRET]&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    });</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    var responseToken = new TokenResponse {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        AccessToken = &quot;[ANALYTICSTOKEN]&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        RefreshToken = &quot;[REFRESHTOKEN]&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Scope = AnalyticsReportingService.Scope.AnalyticsReadonly, //Read-only access to Google Analytics,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        TokenType = &quot;Bearer&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    };</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    var credential = new UserCredential(googleAuthFlow, &quot;&quot;, responseToken);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // Create the  Analytics service.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    return new AnalyticsReportingService(new BaseClientService.Initializer {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        HttpClientInitializer = credential,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        ApplicationName = &quot;my-super-applicatio&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    });</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o">Copy</button></div></div><p>You can see above that you need various credentials to be able to use the API. You can acquire these by logging into GA. Enjoy!</p></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/tags/asp-net-core">asp net core</a><a class="margin-horiz--sm" href="/tags/google-analytics">google analytics</a></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/page/48"><div class="pagination-nav__label">Â« Newer Entries</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/page/50"><div class="pagination-nav__label">Older Entries Â»</div></a></div></nav></main></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><ul class="footer__items"><li class="footer__item"><a href="https://www.buymeacoffee.com/qUBm0Wh" target="_blank"><img src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png" alt="Buy Me A Coffee" style="height: 60px !important;width: 217px !important;"></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 John Reilly. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/styles.08338fad.js"></script>
<script src="/assets/js/runtime~main.734d3b47.js"></script>
<script src="/assets/js/main.41ca5b25.js"></script>
<script src="/assets/js/1.8ac526a0.js"></script>
<script src="/assets/js/2.fbe8cf29.js"></script>
<script src="/assets/js/a6aa9e1f.a367a3ad.js"></script>
<script src="/assets/js/c3b5bd8c.f182eab6.js"></script>
<script src="/assets/js/6eb1980c.e40cec04.js"></script>
<script src="/assets/js/04c55e47.0ce4f546.js"></script>
</body>
</html>