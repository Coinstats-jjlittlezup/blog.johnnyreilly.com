<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog.johnnyreilly.com/rss.xml" title="I CAN MAKE THIS WORK Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog.johnnyreilly.com/atom.xml" title="I CAN MAKE THIS WORK Blog Atom Feed"><title data-react-helmet="true">Blog | I CAN MAKE THIS WORK</title><meta data-react-helmet="true" property="og:title" content="Blog | I CAN MAKE THIS WORK"><meta data-react-helmet="true" name="description" content="Blog"><meta data-react-helmet="true" property="og:description" content="Blog"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><link data-react-helmet="true" rel="shortcut icon" href="/blog.johnnyreilly.com/img/favicon.ico"><link rel="stylesheet" href="/blog.johnnyreilly.com/styles.a755cef0.css">
<link rel="preload" href="/blog.johnnyreilly.com/styles.e251ffc4.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/runtime~main.17090397.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/main.76845b2c.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/1.32932134.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/2.7bb643e8.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/a6aa9e1f.f671cbae.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/c3b5bd8c.b09f7905.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/f209798b.0798303e.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/b2a2b18d.c900939d.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/0f249913.34304420.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/6266f07f.48f048ad.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/5932a0c0.810a8439.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/66936bf1.18428041.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/de994f05.7d3e0b0b.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/40f92029.bce93221.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/a9eac268.1ed7108e.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/f67d924e.cadd3f7a.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/4778bfa1.4d3ded6f.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/blog.johnnyreilly.com/"><img src="/blog.johnnyreilly.com/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/blog.johnnyreilly.com/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">I CAN MAKE THIS WORK</strong></a></div><div class="navbar__items navbar__items--right"><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk"></span></div><div class="react-toggle-track-x"><span class="toggle_3NWk"></span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/blog.johnnyreilly.com/"><img src="/blog.johnnyreilly.com/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/blog.johnnyreilly.com/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">I CAN MAKE THIS WORK</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"></ul></div></div></div></nav><div class="main-wrapper blog-wrapper"><div class="container margin-vert--lg"><div class="row"><div class="col col--2"><div class="sidebar_SWld thin-scrollbar"><h3 class="sidebarItemTitle_Km2m">Recent posts</h3><ul class="sidebarItemList_3UpA"><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog.johnnyreilly.com/2021/03/06/generate-typescript-and-csharp-clients-with-nswag">Generate TypeScript and CSharp clients with NSwag based on an API</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog.johnnyreilly.com/2021/02/27/goodbye-client-affinity-hello-data-protection-with-azure">Goodbye Client Affinity, Hello Data Protection with Azure</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog.johnnyreilly.com/2021/02/16/easy-auth-tokens-survive-releases-on-linux-azure-app-service">Making Easy Auth tokens survive releases on Linux Azure App Service</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog.johnnyreilly.com/2021/02/11/azure-app-service-health-checks-and-zero-downtime-deployments">Azure App Service, Health checks and zero downtime deployments</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog.johnnyreilly.com/2021/02/08/arm-templates-security-role-assignments">ARM templates, security, role assignments and magic GUIDs</a></li></ul></div></div><main class="col col--8"><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_3-lP"><a href="/blog.johnnyreilly.com/2012/04/23/jshint-customising-your-hurt-feelings">JSHint - Customising your hurt feelings</a></h2><div class="margin-vert--md"><time datetime="2012-04-23T00:00:00.000Z" class="blogPostDate_Ta7i">April 23, 2012  路 5 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener"><img src="https://avatars.githubusercontent.com/u/1010525?s=400&amp;u=294033082cfecf8ad1645b4290e362583b33094a&amp;v=4" alt="John Reilly"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener">John Reilly</a></h4><small class="avatar__subtitle"></small></div></div></header><section class="markdown"><p>As I&#x27;ve started making greater use of JavaScript to give a richer GUI experience the amount of JS in my ASP.NET apps has unsurprisingly ballooned. If I&#x27;m honest, I hadn&#x27;t given much consideration to the code quality of my JavaScript in the past. However, if I was going to make increasing use of it (and given the way the web is going at the moment I&#x27;d say that&#x27;s a given) I didn&#x27;t think this was tenable position to maintain. A friend of mine works for <a href="http://www.coverity.com/" target="_blank" rel="noopener noreferrer">Coverity</a> which is a company that provides tools for analysing code quality. I understand, from conversations with him, that their tools provide static analysis for compiled languages such as C++ / C# / Java etc. I was looking for something similar for JavaScript. Like many, I have read and loved <a href="http://www.amazon.com/JavaScript-Good-Parts-Douglas-Crockford/dp/0596517742" target="_blank" rel="noopener noreferrer">Douglas Crockford&#x27;s &quot;JavaScript: The Good Parts&quot;</a>; it is by some margin the most useful and interesting software related book I have read.So I was aware that Crockford had come up with his own JavaScript code quality tool called <a href="http://www.jslint.com/" target="_blank" rel="noopener noreferrer">JSLint</a>. JSLint is quite striking when you first encounter it: <img src="/blog.johnnyreilly.com/assets/images/JSLint-e63a8504cc193628ce6d531d0118f6f8.png"></p><p> It&#x27;s the &quot;Warning! JSLint will hurt your feelings.&quot; that grabs you. And it&#x27;s not wrong. I&#x27;ve copied and pasted code that I&#x27;ve written into JSLint and then gasped at the reams of errors JSLint would produce. I subsequently tried JSLint-ing various well known JS libraries (jQuery etc) and saw that JSLint considered they were thoroughly problematic as well. This made me feel slightly better. It was when I started examining some of the &quot;errors&quot; JSLint reported that I took exception. Yes, I took exception to exceptions! (I&#x27;m *<strong>very</strong>* pleased with that!) Here&#x27;s a few of the errors generated by JSLint when inspecting <a href="http://ajax.googleapis.com/ajax/libs/jquery/1.7.2/jquery.js" target="_blank" rel="noopener noreferrer">jquery-1.7.2.js</a>: - <code>Problem at line 16 character 10: Expected exactly one space between &#x27;function&#x27; and &#x27;(&#x27;.</code></p><ul><li><code>Problem at line 25 character 1: Expected &#x27;var&#x27; at column 13, not column 1.</code></li><li><code>Problem at line 31 character 5: Unexpected dangling &#x27;_&#x27; in &#x27;_jQuery&#x27;.</code></li></ul><p> JSLint is, much like it&#x27;s creator, quite opinionated. Which is no bad thing. Many of Crockfords opinions are clearly worth their salt. It&#x27;s just I didn&#x27;t want all of them enforced upon me. As you can see above most of these &quot;problems&quot; are essentially complaints about a different style rather than bugs or potential issues. Now there are options in JSLint that you can turn on and off which looked quite promising. But before I got to investigating them I heard about <a href="http://www.jshint.com" target="_blank" rel="noopener noreferrer">JSHint</a>, brainchild of Anton Kovalyov and Paul Irish. In their own words: <em>JSHint is a fork of JSLint, the tool written and maintained by Douglas Crockford. The project originally started as an effort to make a more configurable version of JSLintone that doesn&#x27;t enforce one particular coding style on its usersbut then transformed into a separate static analysis tool with its own goals and ideals.</em> This sounded right up my alley! So I thought I&#x27;d repeat my jQuery test. Here&#x27;s a sample of what JSHint threw back at me, with its default settings in place: - <code>Line 230: return num == null ? Expected &#x27;===&#x27; and instead saw &#x27;==&#x27;. </code></p><ul><li><code>Line 352: if ( (options = arguments[ i ]) != null ) { Expected &#x27;!==&#x27; and instead saw &#x27;!=&#x27;. </code></li><li><code>Line 354: for ( name in options ) { The body of a for in should be wrapped in an if statement to filter unwanted properties from the prototype. </code></li></ul><p> These were much more the sort of &quot;issues&quot; I was interested in. Plus it seemed there was plenty of scope to tweak my options. Excellent. This was good. The icing on my cake would have been a plug-in for Visual Studio which would allow me to evaluate my JS files from within my IDE. Happily the world seems to be full of developers doing good turns for one another. I discovered an extension for VS called <a href="http://jslint4vs2010.codeplex.com/" target="_blank" rel="noopener noreferrer">JSLint for Visual Studio 2010</a>: <img src="/blog.johnnyreilly.com/assets/images/Extensions-eaec649adf02eee1ecce09e1210e718e.png"></p><p> This was an extension that provided either JSLint *<strong>or</strong>* JSHint evaluation as you preferred from within Visual Studio. Fantastic! With this extension in play you could add JavaScript static code analysis to your compilation process and so learn of all the issues in your code at the same time, whether they lay in C# or JS or [insert language here]. You could control how JS problems were reported; as warnings, errors etc. You could straightforwardly exclude files from evaluation (essential if you&#x27;re reliant on a number of 3rd party JS libraries which you are not responsible for maintaining). You could cater for predefined variables; allow for jQuery or DOJO. You could simply evaluate a single file in your solution by right clicking it and hitting the &quot;JS Lint&quot; option in the context menu. And it was simplicity itself to activate and deactivate the JSHint / JSLint extension as required. For a more exhaustive round up of the options available I advise taking a look here: <a href="http://jslint4vs2010.codeplex.com/" target="_blank" rel="noopener noreferrer">http://jslint4vs2010.codeplex.com</a>. I would heartily recommend using JSHint if you&#x27;re looking to improve your JS code quality. I&#x27;m grateful to Crockford for making JSHint possible by first writing JSLint. For my part though I think JSHint is the more pragmatic and useful tool and likely to be the one I stick with. For interest (and frankly sheer entertainment value at the crotchetiness of Crockford) it&#x27;s definitely worth having a read up on how JSHint came to pass: - <a href="http://anton.kovalyov.net/2011/02/20/why-i-forked-jslint-to-jshint/" target="_blank" rel="noopener noreferrer">http://anton.kovalyov.net/2011/02/20/why-i-forked-jslint-to-jshint/</a></p><ul><li><a href="http://badassjs.com/post/3364925033/jshint-an-community-driven-fork-of-jslint" target="_blank" rel="noopener noreferrer">http://badassjs.com/post/3364925033/jshint-an-community-driven-fork-of-jslint</a></li></ul></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/js-lint-for-visual-studio">JSLint for Visual Studio</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/coverity">Coverity</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/anton-kovalyov">Anton Kovalyov</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/javascript">javascript</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/paul-irish">paul irish</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/static-code-analysis">static code analysis</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/js-lint">JSLint</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/js-hint">JSHint</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/douglas-crockford">douglas crockford</a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_3-lP"><a href="/blog.johnnyreilly.com/2012/04/16/simple-technique-for-initialising">A Simple Technique for Initialising Properties with Internal Setters for Unit Testing</a></h2><div class="margin-vert--md"><time datetime="2012-04-16T00:00:00.000Z" class="blogPostDate_Ta7i">April 16, 2012  路 6 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener"><img src="https://avatars.githubusercontent.com/u/1010525?s=400&amp;u=294033082cfecf8ad1645b4290e362583b33094a&amp;v=4" alt="John Reilly"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener">John Reilly</a></h4><small class="avatar__subtitle"></small></div></div></header><section class="markdown"><p>I was recently working with my colleagues on refactoring a legacy application. We didn&#x27;t have an immense amount of time available for this but the plan was to try and improve what was there as much as possible. In its initial state the application had no unit tests in place at all and so the plan was to refactor the code base in such a way as to make testing it a realistic proposition. To that end the <a href="http://en.wikipedia.org/wiki/Domain_layer" target="_blank" rel="noopener noreferrer">domain layer</a> was being heavily adjusted and the GUI was being migrated from WebForms to MVC 3. The intention was to build up a pretty solid collection of unit tests. However, as we were working on this we realised we had a problem with properties on our models with <a href="http://msdn.microsoft.com/en-us/library/7c5ka91b(v=vs.80).aspx" target="_blank" rel="noopener noreferrer"><code>internal</code></a> setters...</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="background"></a>Background<a class="hash-link" href="#background" title="Direct link to heading">#</a></h2><p>The entities of the project in question used an approach which would store pertinent bits of <a href="http://en.wikipedia.org/wiki/Database_normalization" target="_blank" rel="noopener noreferrer">normalised</a> data for read-only purposes in related entities. I&#x27;ve re-read that sentence and realise it&#x27;s as clear as mud. Here is an example to clarify:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cs codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">public class Person</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  public int Id { get; set; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  public string FirstName { get; set; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  public string LastName { get; set; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  public string Address { get; set; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  public DateTime DateOfBirth { get; set; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  /* Other fascinating properties... */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">public class Order</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  public int Id { get; set; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  public string ProductOrdered { get; set; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  public string OrderedById { get; set; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  public string OrderedByFirstName { get; internal set; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  public string OrderedByLastName { get; internal set; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>In the example above you have 2 types of entity: <code>Person</code> and <code>Order</code>. The <code>Order</code> entity makes use of the the <code>Id</code>, <code>FirstName</code> and <code>LastName</code> properties of the <code>Person</code> entity in the properties <code>OrderedById</code>, <code>OrderedByFirstName</code> and <code>OrderedByLastName</code>. For persistence (ie saving to the database) purposes the only necessary <code>Person</code> property is <code>OrderedById</code> identity. <code>OrderedByFirstName</code> and <code>OrderedByLastName</code> are just &quot;nice to haves&quot; - essentially present to make implementing the GUI more straightforward.</p><p>To express this behaviour / intention in the object model the setters for <code>OrderedByFirstName</code> and <code>OrderedByLastName</code> are marked as <code>internal</code>. The implication of this is that properties like this can only be initialised within the current assembly - or any explicitly associated &quot;friend&quot; assemblies. In practice this meant that internally set properties were only populated when an object was read in from the database. It wasn&#x27;t possible to set these properties in other assemblies which meant less code was written (<u>a good thing</u></p><p>) - after all, why set a property when you don&#x27;t need to?</p><p>Background explanation over. It may still be a little unclear but I hope you get the gist.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="whats-our-problem"></a>What&#x27;s our problem?<a class="hash-link" href="#whats-our-problem" title="Direct link to heading">#</a></h2><p>I was writing unit tests for the controllers in our main web application and was having problems with my arrangements. I was mocking the database calls in my controllers much in the manner that you might expect:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-ts codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Arrange</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">var</span><span class="token plain"> orderDb </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name maybe-class-name" style="color:rgb(255, 203, 107)">Mock</span><span class="token class-name operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token class-name maybe-class-name" style="color:rgb(255, 203, 107)">IOrderDb</span><span class="token class-name operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  orderDb</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access maybe-class-name" style="color:rgb(130, 170, 255)">Setup</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access maybe-class-name" style="color:rgb(130, 170, 255)">GetOrder</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token maybe-class-name">It</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token generic-function function" style="color:rgb(130, 170, 255)">IsAny</span><span class="token generic-function generic class-name operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token generic-function generic class-name" style="color:rgb(255, 203, 107)">int</span><span class="token generic-function generic class-name operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access maybe-class-name" style="color:rgb(130, 170, 255)">Returns</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name maybe-class-name" style="color:rgb(255, 203, 107)">Order</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token maybe-class-name">Id</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">123</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token maybe-class-name">ProductOrdered</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Packet of coffee&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token maybe-class-name">OrderedById</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">987456</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token maybe-class-name">OrderedByFirstName</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;John&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token maybe-class-name">OrderedByLastName</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Reilly&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>All looks fine doesn&#x27;t it? It&#x27;s not. Because <code>OrderedByFirstName</code> and <code>OrderedByLastName</code> have internal setters we are <u>unable</u></p><p> to initialise them from within the context of our test project. So what to do?</p><p>We toyed with 3 approaches and since each has merits I thought it worth going through each of them:</p><ol><li><p>To the MOQumentation Batman!: <a href="http://code.google.com/p/moq/wiki/QuickStart" target="_blank" rel="noopener noreferrer">http://code.google.com/p/moq/wiki/QuickStart</a>! Looking at the MOQ documentation it states the following:</p><p><em>Mocking internal types of another project: add the following assembly attributes (typically to the AssemblyInfo.cs) to the project containing the internal types:</em></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cs codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">// This assembly is the default dynamic assembly generated Castle DynamicProxy, </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// used by Moq. Paste in a single line.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[assembly:InternalsVisibleTo(&quot;DynamicProxyGenAssembly2,PublicKey=0024000004800000940000000602000000240000525341310004000001000100c547cac37abd99c8db225ef2f6c8a3602f3b3606cc9891605d02baa56104f4cfc0734aa39b93bf7852f7d9266654753cc297e7d2edfe0bac1cdcf9f717241550e0a7b191195b7667bb4f64bcb8e2121380fd1d9d46ad2d92d2d15605093924cceaf74c4861eff62abf69b9291ed0a340e113be11e6a7d3113e92484cf7045cc7&quot;)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[assembly: InternalsVisibleTo(&quot;The.NameSpace.Of.Your.Unit.Test&quot;)] //I&#x27;d hope it was shorter than that...</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>This looked to be exactly what we needed and in most situations it would make sense to go with this. Unfortunately for us there was a gotcha. Certain core shared parts of our application platform were <a href="http://en.wikipedia.org/wiki/Global_Assembly_Cache" target="_blank" rel="noopener noreferrer">GAC</a>&#x27;d. A requirement for GAC-ing an assembly is that it is <a href="http://msdn.microsoft.com/en-us/library/xc31ft41.aspx" target="_blank" rel="noopener noreferrer">signed</a>.</p><p>The upshot of this was that if we wanted to use the <code>InternalsVisibleTo</code> approach then we would need to sign our web application test project. We weren&#x27;t particularly averse to that and initially did so without much thought. It was then we remembered that every assembly referenced by a signed assembly must also be signed as well. We didn&#x27;t really want to sign our main web application purely for testing purposes. We could and if there weren&#x27;t viable alternatives we well might have. But it just seemed like the wrong reason to be taking that decision. Like using a sledgehammer to crack a nut.</p></li><li><p>The next approach we took was using mock objects. Instead of using our objects straight we would mock them as below:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cs codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">//Create mock and set internal properties</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      var orderMock = new Mock&lt;Order&gt;();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      orderMock.SetupGet(x =&gt; x.OrderedByFirstName).Returns(&quot;John&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      orderMock.SetupGet(x =&gt; x.OrderedByLastName).Returns(&quot;Reilly&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      //Set up standard properties</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      orderMock.SetupAllProperties();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      var orderStub = orderMock.Object;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      orderStub.Id = 123;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      orderStub.ProductOrdered = &quot;Packet of coffee&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      orderStub.OrderedById = 987456;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Now this approach worked fine but had a couple of snags:</p><ul><li><p>As you can see it&#x27;s pretty verbose and much less clear to read than it was previously.</p></li><li><p>It required that we add the <code>virtual</code> keyword to all our internally set properties like so: </p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cs codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">public class Order</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  // ....</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  public virtual string OrderedByFirstName { get; internal set; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  public virtual string OrderedByLastName { get; internal set; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  // ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div></li><li><p>Our standard constructor already initialised the value of our internally set properties. So adding <code>virtual</code> to the internally set properties generated <a href="http://www.jetbrains.com/resharper/" target="_blank" rel="noopener noreferrer">ReSharper</a> warnings aplenty about virtual properties being initialised in the constructor. Fair enough.</p></li></ul><p>Because of the snags it still felt like we were in nutcracking territory...</p></li><li><p>... and this took us to the approach that we ended up adopting: a special mocking constructor for each class we wanted to test, for example: ```cs
/// </p><summary>
/// Mocking constructor used to initialise internal properties
/// </summary>
public Order(string orderedByFirstName = null, string orderedByLastName = null)
: this()
{
OrderedByFirstName = orderedByFirstName;
OrderedByLastName = orderedByLastName;
}<p></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Thanks to the ever lovely [Named and Optional Arguments](&lt;http://msdn.microsoft.com/en-us/library/dd264739.aspx&gt;) feature of C# combined with [Object Initializers](&lt;http://msdn.microsoft.com/en-us/library/bb397680.aspx&gt;) it meant it was possible to write quite expressive, succinct code using this approach; for example:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">```cs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">var order = new Order(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        orderedByFirstName: &quot;John&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        orderedByLastName: &quot;Reilly&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      )</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Id = 123,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        ProductOrdered = &quot;Packet of coffee&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        OrderedById = 987456</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      };</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Here we&#x27;re calling the mocking constructor to set the internally set properties and subsequently initialising the other properties using the object initialiser mechanism.</p><p>Implementing these custom constructors wasn&#x27;t a massive piece of work and so we ended up settling on this technique for initialising internal properties.</p></li></ol></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/unit-testing">unit testing</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/internals-visible-to">InternalsVisibleTo</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/moq">MOQ</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/mocking">mocking</a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_3-lP"><a href="/blog.johnnyreilly.com/2012/04/05/making-pdfs-from-html-in-c-using">Making PDFs from HTML in C# using WKHTMLtoPDF</a></h2><div class="margin-vert--md"><time datetime="2012-04-05T00:00:00.000Z" class="blogPostDate_Ta7i">April 5, 2012  路 7 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener"><img src="https://avatars.githubusercontent.com/u/1010525?s=400&amp;u=294033082cfecf8ad1645b4290e362583b33094a&amp;v=4" alt="John Reilly"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener">John Reilly</a></h4><small class="avatar__subtitle"></small></div></div></header><section class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="update-03012013"></a>Update 03/01/2013<a class="hash-link" href="#update-03012013" title="Direct link to heading">#</a></h2><p> I&#x27;ve written a subsequent post which builds on the work of this original post. The new post exposes this functionality via a WCF service and can be found <a href="http://icanmakethiswork.blogspot.co.uk/2013/01/html-to-pdf-using-wcf-service.html" target="_blank" rel="noopener noreferrer">here</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="making-pdfs-from-html"></a>Making PDFs from HTML<a class="hash-link" href="#making-pdfs-from-html" title="Direct link to heading">#</a></h2><p>I wanted to talk about an approach I&#x27;ve discovered for making PDFs directly from HTML. I realise that in these wild and crazy days of <a href="http://mozilla.github.com/pdf.js/" target="_blank" rel="noopener noreferrer">PDF.js</a> and the like that techniques like this must seem very old hat. That said, this technique works and more importantly it solves a problem I was faced with but without forcing the users to move the &quot;newest hottest version of X&quot;. Much as many of would love to solve problems this way, alas many corporations move slower than that and in the meantime we still have to deliver - we still have to meet requirements. Rather than just say &quot;I did this&quot; I thought I&#x27;d record how I got to this point in the first place. I don&#x27;t know about you but I find the reasoning behind why different technical decisions get made quite an interesting topic...</p><p>For some time I&#x27;ve been developing / supporting an application which is used in an intranet environment where the company mandated browser is still IE 6. It was a requirement that there be &quot;print&quot; functionality in this application. As is well known (even by Microsoft themselves) the print functionality in IE 6 was never fantastic. But the requirement for usable printouts remained.</p><p>The developers working on the system before me decided to leverage Crystal Reports (remember that?). Essentially there was a reporting component to the application at the time which created custom reports using Crystal and rendered them to the user in the form of PDFs (which have been eminently printable for as long as I care to remember). One of the developers working on the system realised that it would be perfectly possible to create some &quot;reports&quot; within Crystal which were really &quot;print to PDF&quot; screens for the app.</p><p>It worked well and this solution stayed in place for a very long time. However, some years down the line the Crystal Reports was discarded as the reporting mechanism for the app. But we were unable to decommission Crystal entirely because we still needed it for printing.</p><p>I&#x27;d never really liked the Crystal solution for a number of reasons:</p><ol><li>We needed custom stored procs to drive the Crystal print screens which were near duplicates of the main app procs. This duplication of effort never felt right.</li><li>We had to switch IDEs whenever we were maintaining our print screens. And the Crystal IDE is not a joy to use.</li><li>Perhaps most importantly, for certain users we needed to hide bits of information from the print. The version of Crystal we were using did not make the dynamic customisation of our print screens a straightforward proposition. (In its defence we weren&#x27;t really using it for what it was designed for.) As a result the developers before me had ended up creating various versions of each print screen revealing different levels of information. As you can imagine, this meant that the effort involved in making changes to the print screens had increased exponentially</li></ol><p>It occurred to me that it would be good if we could find some way of generating our own PDF reports without using Crystal that would be a step forward. It was shortly after this that I happened upon <a href="http://code.google.com/p/wkhtmltopdf/" target="_blank" rel="noopener noreferrer">WKHTMLtoPDF</a>. This is an open source project which describes itself as a <em>&quot;Simple shell utility to convert html to pdf using the webkit rendering engine, and qt.&quot;</em> I tested it out on various websites and it worked. It wasn&#x27;t by any stretch of the imagination a perfect HTML to PDF tool but the quality it produced greatly outstripped the presentation currently in place via Crystal.</p><p>This was just the ticket. Using WKHTMLtoPDF I could have simple web pages in the application which could be piped into WKHTMLtoPDF to make a PDF as needed. It could be dynamic - because ASP.NET is dynamic. We wouldn&#x27;t need to write and maintain custom stored procs anymore. And happily we would no longer need to use Crystal.</p><p>Before we could rid ourselves of Crystal though, I needed a way that I could generate these PDFs on the fly within the website. For this I ended up writing a simple wrapper class for WKHTMLtoPDF which could be used to invoke it on the fly. In fact a good portion of this was derived from various contributions on <a href="http://stackoverflow.com/q/1331926" target="_blank" rel="noopener noreferrer">a post on StackOverflow</a>. It ended up looking like this:</p><script src="https://gist.github.com/2341776.js?file=PdfGenerator.cs"></script><p>With this wrapper I could pass in URLs and extract out PDFs. Here&#x27;s a couple of examples of me doing just that:</p><div class="mdxCodeBlock_1zKU">//Create PDF from a single URL var pdfUrl = PdfGenerator.HtmlToPdf(pdfOutputLocation: &quot;~/PDFs/&quot;, outputFilenamePrefix: &quot;GeneratedPDF&quot;, urls: new string[] http://news.bbc.co.uk); //Create PDF from multiple URLs var pdfUrl = PdfGenerator.HtmlToPdf(pdfOutputLocation: &quot;~/PDFs/&quot;, outputFilenamePrefix: &quot;GeneratedPDF&quot;, urls: new string[] http://news.bbc.co.uk);</div><p>As you can see from the second example above it&#x27;s possible to pipe a number of URLs into the wrapper all to be rendered to a single PDF. Most of the time this was surplus to our requirements but it&#x27;s good to know it&#x27;s possible. Take a look at the BBC website PDF generated by the first example:</p><iframe src="https://docs.google.com/file/d/0B87K8-qxOZGFYktEWGtXRXJSSS1ZWFR4emFfMmVxZw/preview" width="500" height="500"></iframe><p>Pretty good, no? As you can see it&#x27;s not perfect from looking at the titles (bit squashed) but I deliberately picked a more complicated page to show what WKHTMLtoPDF was capable of. The print screens I had in mind to build would be significantly simpler than this.</p><p>Once this was in place I was able to scrap the Crystal solution. It was replaced with a couple of &quot;print to PDF&quot; ASPXs in the main web app which would be customised when rendering to hide the relevant bits of data from the user. These ASPXs would be piped into the HtmlToPdf method as needed and then the user would be redirected to that PDF. If for some reason the PDF failed to render the users would see the straight &quot;print to PDF&quot; ASPX - just not as a PDF if you see what I mean. I should say that it was pretty rare for a PDF to not render but this was my failsafe.</p><p>This new solution had a number of upsides from our perspective:</p><ul><li>Development maintenance time (and consequently cost for our customers) for print screens was significantly reduced. This was due to the print screens being part of the main web app. This meant they shared styling etc with all the other web screens and the dynamic nature of ASP.NET made customising a screen on the fly simplicity itself.</li><li>We were now able to regionalise our print screens for the users in the same way as we did with our main web app. This just wasn&#x27;t realistic with the Crystal solution because of the amount of work involved.</li><li>I guess this is kind of a <a href="http://en.wikipedia.org/wiki/Don%27t_repeat_yourself" target="_blank" rel="noopener noreferrer">DRY</a> solution :-)</li></ul><p>You can easily make use of the above approach yourself. All you need do is download and install <a href="http://code.google.com/p/wkhtmltopdf/" target="_blank" rel="noopener noreferrer">WKHTMLtoPDF</a> on your machine. I advise using version 0.9.9 as the later release candidates appear slightly buggy at present.</p><p>Couple of gotchas:</p><ol><li>Make sure that you pass the correct installation path to the HtmlToPdf method if you installed it anywhere other than the default location. You&#x27;ll see that the class assumes the default if it wasn&#x27;t passed</li><li>Ensure that Read and Execute rights are granted to the wkhtmltopdf folder for the relevant process</li><li>Ensure that Write rights are granted for the location you want to create your PDFs for the relevant process</li></ol><p>In our situation we are are invoking this directly in our web application on demand. I have no idea how this would scale - perhaps not well. This is not really an issue for us as our user base is fairly small and this functionality isn&#x27;t called excessively. I think if this was used much more than it is I&#x27;d be tempted to hive off this functionality into a separate app. But this works just dandy for now.</p></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/wkhtmltopdf">wkhtmltopdf</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/webkit">webkit</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/c">c#</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/html">html</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/pdf">pdf</a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_3-lP"><a href="/blog.johnnyreilly.com/2012/03/22/wcf-moving-from-config-to-code-simple">WCF - moving from Config to Code, a simple WCF service harness (plus implementing your own Authorization)</a></h2><div class="margin-vert--md"><time datetime="2012-03-22T00:00:00.000Z" class="blogPostDate_Ta7i">March 22, 2012  路 11 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener"><img src="https://avatars.githubusercontent.com/u/1010525?s=400&amp;u=294033082cfecf8ad1645b4290e362583b33094a&amp;v=4" alt="John Reilly"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener">John Reilly</a></h4><small class="avatar__subtitle"></small></div></div></header><section class="markdown"><p>Last time I wrote about WCF I was getting up and running with <a href="http://icanmakethiswork.blogspot.com/2012/02/wcf-transport-windows-authentication.html" target="_blank" rel="noopener noreferrer">WCF Transport Windows authentication using NetTcpBinding in an Intranet environment</a>. I ended up with a WCF service hosted in a Windows Service which did pretty much what the previous post name implies.</p><p> Since writing that I&#x27;ve taken things on a bit further and I thought it worth recording my approach whilst it&#x27;s still fresh in my mind. There&#x27;s 3 things I want to go over:</p><ol><li>I&#x27;ve moved away from the standard config driven WCF approach to a more &quot;code-first&quot; style</li><li>I&#x27;ve established a basic Windows Service hosted WCF service / client harness which is useful if you&#x27;re trying to get up and running with a WCF service quickly</li><li>I&#x27;ve locked down the WCF authorization to a single Windows account through the use of my own <a href="http://msdn.microsoft.com/en-us/library/ms731774.aspx" target="_blank" rel="noopener noreferrer">ServiceAuthorizationManager</a></li></ol><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="moving-from-config-to-code"></a>Moving from Config to Code<a class="hash-link" href="#moving-from-config-to-code" title="Direct link to heading">#</a></h2><p>So, originally I was doing what all the cool kids are doing and driving the configuration of my WCF service and all its clients through config files. And why not? I&#x27;m in good company.</p><p>Here&#x27;s why not: it gets *<strong>very</strong>* verbose *<strong>very</strong>* quickly....</p><p>Okay - that&#x27;s not the end of the world. My problem was that I had ~10 Windows Services and 3 Web applications that needed to call into my WCF Service. I didn&#x27;t want to have to separately tweak 15 or so configs each time I wanted to make one standard change to WCF configuration settings. I wanted everything in one place.</p><p>Now there&#x27;s newer (and probably hipper) ways of achieving this. <a href="http://stackoverflow.com/a/2814286" target="_blank" rel="noopener noreferrer">Here&#x27;s one possibility I happened upon on StackOverflow that looks perfectly fine.</a></p><p>Well I didn&#x27;t use a hip new approach - no I went Old School with my old friend the <a href="http://msdn.microsoft.com/en-us/library/ms228154.aspx" target="_blank" rel="noopener noreferrer">appSettings file attribute</a>. Remember that? It&#x27;s just a simple way to have all your common appSettings configuration settings in a single file which can be linked to from as many other apps as you like. It&#x27;s wonderful and I&#x27;ve been using it for a long time now. Unfortunately it&#x27;s pretty basic in that it&#x27;s only the appSettings section that can be shared out; no <code>&amp;lt;system.serviceModel&amp;gt;</code> or similar.</p><p>But that wasn&#x27;t really a problem from my perspective. I realised that there were actually very few things that needed to be configurable for my WCF service. Really I wanted a basic WCF harness that could be initialised in code which implicitly set all the basic configuration with settings that worked (ie it was set up with defaults like maximum message size which were sufficiently sized). On top of that I would allow myself to configure just those things that I needed to through the use of my own custom WCF config settings in the shared appSettings.config file.</p><p>Once done I massively reduced the size of my configs from frankly gazillions of entries to just these appSettings.config entries which were shared across each of my WCF service clients and by my Windows Service harness:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-xml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">appSettings</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">add</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">key</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">WcfBaseAddressForClient</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">value</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">net.tcp://localhost:9700/</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">add</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">key</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">WcfWindowsSecurityApplied</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">value</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">true</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">add</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">key</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">WcfCredentialsUserName</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">value</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">myUserName</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">add</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">key</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">WcfCredentialsPassword</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">value</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">myPassword</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">add</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">key</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">WcfCredentialsDomain</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">value</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">myDomain</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">appSettings</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>And these config settings used only by my Windows Service harness:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-xml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">appSettings</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">file</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">../Shared/AppSettings.config</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">add</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">key</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">WcfBaseAddressForService</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">value</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">net.tcp://localhost:9700/</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">appSettings</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="show-me-your-harness"></a>Show me your harness<a class="hash-link" href="#show-me-your-harness" title="Direct link to heading">#</a></h2><p>I ended up with a quite a nice basic &quot;vanilla&quot; framework that allowed me to quickly set up Windows Service hosted WCF services. The framework also provided me with a simple way to consume these WCF services with a minimum of code an configuration. No muss. No fuss. :-) So pleased with it was I that I thought I&#x27;d go through it here much in the manner of a chef baking a cake...</p><p>To start with I created myself a Windows Service in Visual Studio which I grandly called &quot;WcfWindowsService&quot;. The main service class looked like this:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cs codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">public class WcfWindowsService: ServiceBase</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public static string WindowsServiceName = &quot;WCF Windows Service&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public static string WindowsServiceDescription = &quot;Windows service that hosts a WCF service.&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    private static readonly log4net.ILog _logger = log4net.LogManager.GetLogger(System.Reflection.MethodBase.GetCurrentMethod().DeclaringType);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public List&lt;ServiceHost&gt; _serviceHosts = null;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public WcfWindowsService()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ServiceName = WindowsServiceName;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public static void Main()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      ServiceBase.Run(new WcfWindowsService());</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// &lt;summary&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// The Windows Service is starting</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// &lt;/summary&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// &lt;param name=&quot;args&quot;&gt;&lt;/param&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    protected override void OnStart(string[] args)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      try</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        CloseAndClearServiceHosts();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        //Make log4net startup</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        XmlConfigurator.Configure();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        _logger.Warn(&quot;WCF Windows Service starting...&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        _logger.Info(&quot;Global.WcfWindowsSecurityApplied = &quot; + Global.WcfWindowsSecurityApplied.ToString().ToLower());</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        if (Global.WcfWindowsSecurityApplied)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          _logger.Info(&quot;Global.WcfOnlyAuthorizedForWcfCredentials = &quot; + Global.WcfOnlyAuthorizedForWcfCredentials.ToString().ToLower());</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          if (Global.WcfOnlyAuthorizedForWcfCredentials)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            _logger.Info(&quot;Global.WcfCredentialsDomain = &quot; + Global.WcfCredentialsDomain);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            _logger.Info(&quot;Global.WcfCredentialsUserName = &quot; + Global.WcfCredentialsUserName);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        //Create binding</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        var wcfBinding = WcfHelper.CreateBinding(Global.WcfWindowsSecurityApplied);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        // Create a servicehost and endpoints for each service and open each</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        _serviceHosts = new List&lt;ServiceHost&gt;();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        _serviceHosts.Add(WcfServiceFactory&lt;IHello&gt;.CreateAndOpenServiceHost(typeof(HelloService), wcfBinding));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        _serviceHosts.Add(WcfServiceFactory&lt;IGoodbye&gt;.CreateAndOpenServiceHost(typeof(GoodbyeService), wcfBinding));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        _logger.Warn(&quot;WCF Windows Service started.&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      catch (Exception exc)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        _logger.Error(&quot;Problem starting up&quot;, exc);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        throw exc;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// &lt;summary&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// The Windows Service is stopping</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// &lt;/summary&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    protected override void OnStop()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      CloseAndClearServiceHosts();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      _logger.Warn(&quot;WCF Windows Service stopped&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// &lt;summary&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Close and clear service hosts in list and clear it down</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// &lt;/summary&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    private void CloseAndClearServiceHosts()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      if (_serviceHosts != null)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        foreach (var serviceHost in _serviceHosts)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          CloseAndClearServiceHost(serviceHost);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        _serviceHosts.Clear();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// &lt;summary&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Close and clear the passed service host</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// &lt;/summary&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// &lt;param name=&quot;serviceHost&quot;&gt;&lt;/param&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    private void CloseAndClearServiceHost(ServiceHost serviceHost)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      if (serviceHost != null)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        _logger.Info(string.Join(&quot;, &quot;, serviceHost.BaseAddresses) + &quot; is closing...&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        serviceHost.Close();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        _logger.Info(string.Join(&quot;, &quot;, serviceHost.BaseAddresses) + &quot; is closed&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>As you&#x27;ve no doubt noticed this makes use of <a href="http://logging.apache.org/log4net/" target="_blank" rel="noopener noreferrer">Log4Net</a> for logging purposes (I&#x27;ll assume you&#x27;re aware of it). My Windows Service implements such fantastic WCF services as HelloService and GoodbyeService. Each revolutionary in their own little way. To give you a taste of the joie de vivre that these services exemplify take a look at this:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cs codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">// Implement the IHello service contract in a service class.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  public class HelloService : WcfServiceAuthorizationManager, IHello</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // Implement the IHello methods.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public string GreetMe(string thePersonToGreet)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      return &quot;well hello there &quot; + thePersonToGreet;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Exciting! WcfWindowsService also references another class called &quot;Global&quot; which is a helper class - to be honest not much more than a wrapper for my config settings. It looks like this:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cs codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">static public class Global</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    #region Properties</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // eg &quot;net.tcp://localhost:9700/&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public static string WcfBaseAddressForService { get { return ConfigurationManager.AppSettings[&quot;WcfBaseAddressForService&quot;]; } }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // eg true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public static bool WcfWindowsSecurityApplied { get { return bool.Parse(ConfigurationManager.AppSettings[&quot;WcfWindowsSecurityApplied&quot;]); } }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // eg true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public static bool WcfOnlyAuthorizedForWcfCredentials { get { return bool.Parse(ConfigurationManager.AppSettings[&quot;WcfOnlyAuthorizedForWcfCredentials&quot;]); } }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // eg &quot;myDomain&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public static string WcfCredentialsDomain { get { return ConfigurationManager.AppSettings[&quot;WcfCredentialsDomain&quot;]; } }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // eg &quot;myUserName&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public static string WcfCredentialsUserName { get { return ConfigurationManager.AppSettings[&quot;WcfCredentialsUserName&quot;]; } }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    // eg &quot;myPassword&quot; - this should *never* be stored unencrypted and is only ever used by clients that are not already running with the approved Windows credentials</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public static string WcfCredentialsPassword { get { return ConfigurationManager.AppSettings[&quot;WcfCredentialsPassword&quot;]; } }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    #endregion</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>WcfWindowsService creates and hosts a HelloService and a GoodbyeService when it starts up. It does this using my handy WcfServiceFactory:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cs codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">public class WcfServiceFactory&lt;TInterface&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    private static readonly log4net.ILog _logger = log4net.LogManager.GetLogger(System.Reflection.MethodBase.GetCurrentMethod().DeclaringType);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public static ServiceHost CreateAndOpenServiceHost(Type serviceType, NetTcpBinding wcfBinding)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      var serviceHost = new ServiceHost(serviceType, new Uri(Global.WcfBaseAddressForService + ServiceHelper&lt;TInterface&gt;.GetServiceName()));</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      serviceHost.AddServiceEndpoint(typeof(TInterface), wcfBinding, &quot;&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      serviceHost.Authorization.ServiceAuthorizationManager = new WcfServiceAuthorizationManager(); // This allows us to control authorisation within WcfServiceAuthorizationManager</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      serviceHost.Open();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      _logger.Info(string.Join(&quot;, &quot;, serviceHost.BaseAddresses) + &quot; is now listening.&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      return serviceHost;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>To do this it also uses my equally handy WcfHelper class:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cs codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">static public class WcfHelper</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// &lt;summary&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// Create a NetTcpBinding</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// &lt;/summary&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// &lt;param name=&quot;useWindowsSecurity&quot;&gt;&lt;/param&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    /// &lt;returns&gt;&lt;/returns&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public static NetTcpBinding CreateBinding(bool useWindowsSecurity)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      var wcfBinding = new NetTcpBinding();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      if (useWindowsSecurity)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        wcfBinding.Security.Mode = SecurityMode.Transport;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        wcfBinding.Security.Transport.ClientCredentialType = TcpClientCredentialType.Windows;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      else</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        wcfBinding.Security.Mode = SecurityMode.None;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      wcfBinding.MaxBufferSize = int.MaxValue;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      wcfBinding.MaxReceivedMessageSize = int.MaxValue;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      wcfBinding.ReaderQuotas.MaxArrayLength = int.MaxValue;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      wcfBinding.ReaderQuotas.MaxDepth = int.MaxValue;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      wcfBinding.ReaderQuotas.MaxStringContentLength = int.MaxValue;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      wcfBinding.ReaderQuotas.MaxBytesPerRead = int.MaxValue;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      return wcfBinding;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  /// &lt;summary&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  /// Create a WCF Client for use anywhere (be it Windows Service or ASP.Net web application)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  /// nb Credential fields are optional and only likely to be needed by web applications</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  /// &lt;/summary&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  /// &lt;typeparam name=&quot;TInterface&quot;&gt;&lt;/typeparam&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  public class WcfClientFactory&lt;TInterface&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public static TInterface CreateChannel(bool useWindowsSecurity, string wcfBaseAddress, string wcfCredentialsUserName = null, string wcfCredentialsPassword = null, string wcfCredentialsDomain = null)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      //Create NetTcpBinding using universally</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      var wcfBinding = WcfHelper.CreateBinding(useWindowsSecurity);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      //Get Service name from examining the ServiceNameAttribute decorating the interface</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      var serviceName = ServiceHelper&lt;TInterface&gt;.GetServiceName();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      //Create the factory for creating your channel</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      var factory = new ChannelFactory&lt;TInterface&gt;(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        wcfBinding,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        new EndpointAddress(wcfBaseAddress + serviceName)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        );</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      //if credentials have been supplied then use them</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      if (!string.IsNullOrEmpty(wcfCredentialsUserName))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        factory.Credentials.Windows.ClientCredential = new System.Net.NetworkCredential(wcfCredentialsUserName, wcfCredentialsPassword, wcfCredentialsDomain);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      //Create the channel</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      var channel = factory.CreateChannel();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      return channel;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Now the above WcfHelper class and it&#x27;s comrade-in-arms the WcfClientFactory don&#x27;t live in the WcfWindowsService project with the other classes. No. They live in a separate project called the WcfWindowsServiceContracts project with their old mucker the ServiceHelper:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cs codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">public class ServiceHelper&lt;T&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public static string GetServiceName()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      var customAttributes = typeof(T).GetCustomAttributes(false);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      if (customAttributes.Length &gt; 0)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        foreach (var customAttribute in customAttributes)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          if (customAttribute is ServiceNameAttribute)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            return ((ServiceNameAttribute)customAttribute).ServiceName;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      throw new ArgumentException(&quot;Interface is missing ServiceNameAttribute&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  [AttributeUsage(AttributeTargets.Interface, AllowMultiple = false)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  public class ServiceNameAttribute : System.Attribute</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public ServiceNameAttribute(string serviceName)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      this.ServiceName = serviceName;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public string ServiceName { get; set; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Now can you guess what the WcfWindowsServiceContracts project might contain? Yes; contracts for your services (oh the excitement)! What might one of these contracts look like I hear you ask... Well, like this:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cs codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[ServiceContract()]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  [ServiceName(&quot;HelloService&quot;)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  public interface IHello</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    [OperationContract]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    string GreetMe(string thePersonToGreet);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The WcfWindowsServiceContracts project is included in *<strong>any</strong>* WCF client solution that wants to call your WCF services. It is also included in the WCF service solution. It facilitates the calling of services. What you&#x27;re no doubt wondering is how this might be achieved. Well here&#x27;s how, it uses our old friend the <code>WcfClientFactory</code>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cs codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">var helloClient = WcfClientFactory&lt;IHello&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .CreateChannel(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      useWindowsSecurity:     Global.WcfWindowsSecurityApplied,  // eg true</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      wcfBaseAddress:         Global.WcfBaseAddressForClient,    // eg &quot;net.tcp://localhost:9700/&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      wcfCredentialsUserName: Global.WcfCredentialsUserName,     // eg &quot;myUserName&quot; - Optional parameter - only passed by web applications that need to impersonate the valid user</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      wcfCredentialsPassword: Global.WcfCredentialsPassword,     // eg &quot;myPassword&quot; - Optional parameter - only passed by web applications that need to impersonate the valid user</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      wcfCredentialsDomain:   Global.WcfCredentialsDomain        // eg &quot;myDomain&quot; - Optional parameter - only passed by web applications that need to impersonate the valid user</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    );</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  var greeting = helloClient.GreetMe(&quot;John&quot;); //&quot;well hello there John&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>See? Simple as simple. The eagle eyed amongst you will have noticed that client example above is using &quot;<code>Global</code>&quot; which is essentially a copy of the <code>Global</code> class mentioned above that is part of the WcfWindowsService project.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="locking-down-authorization-to-a-single-windows-account"></a>Locking down Authorization to a single Windows account<a class="hash-link" href="#locking-down-authorization-to-a-single-windows-account" title="Direct link to heading">#</a></h2><p>I can tell you think i&#x27;ve forgotten something. &quot;Tell me about this locking down to the single Windows account / what is this mysterious <code>WcfServiceAuthorizationManager</code> class that all your WCF services inherit from? Don&#x27;t you fob me off now.... etc&quot;</p><p>Well ensuring that only a single Windows account is authorised (yes dammit the original English spelling) to access our WCF services is achieved by implementing our own <code>ServiceAuthorizationManager</code> class. This implementation is used for authorisation by your <code>ServiceHost</code> and the logic sits in the overridden <code>CheckAccessCore</code> method. All of our WCF service classes will inherit from our <code>ServiceAuthorizationManager</code> class and so trigger the <code>CheckAccessCore</code> authorisation each time they are called.</p><p>As you can see from the code below, depending on our configuration, we lock down access to all our WCF services to a specific Windows account. This is far from the only approach that you might want to take to authorisation; it&#x27;s simply the one that we&#x27;ve been using. However the power of being able to implement your own authorisation in the <code>CheckAccessCore</code> method allows you the flexibility to do pretty much anything you want:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cs codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">public class WcfServiceAuthorizationManager : ServiceAuthorizationManager</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    protected static readonly log4net.ILog _logger = log4net.LogManager.GetLogger(System.Reflection.MethodBase.GetCurrentMethod().DeclaringType);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    protected override bool CheckAccessCore(OperationContext operationContext)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      if (Global.WcfWindowsSecurityApplied)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        if ((operationContext.ServiceSecurityContext.IsAnonymous) ||</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          (operationContext.ServiceSecurityContext.PrimaryIdentity == null))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          _logger.Error(&quot;WcfWindowsSecurityApplied = true but no credentials have been supplied&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          return false;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        if (Global.WcfOnlyAuthorizedForWcfCredentials)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          if (operationContext.ServiceSecurityContext.PrimaryIdentity.Name.ToLower() == Global.WcfCredentialsDomain.ToLower() + &quot;\\&quot; + Global.WcfCredentialsUserName.ToLower())</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            _logger.Debug(&quot;WcfOnlyAuthorizedForWcfCredentials = true and the valid user (&quot; + operationContext.ServiceSecurityContext.PrimaryIdentity.Name + &quot;) has been supplied and access allowed&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            return true;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          else</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            _logger.Error(&quot;WcfOnlyAuthorizedForWcfCredentials = true and an invalid user (&quot; + operationContext.ServiceSecurityContext.PrimaryIdentity.Name + &quot;) has been supplied and access denied&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            return false;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        else</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          _logger.Debug(&quot;WcfOnlyAuthorizedForWcfCredentials = false, credentials were supplied (&quot; + operationContext.ServiceSecurityContext.PrimaryIdentity.Name + &quot;) so access allowed&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          return true;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      else</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        _logger.Info(&quot;WcfWindowsSecurityApplied = false so we are allowing unfettered access&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        return true;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Phewwww... I know this has ended up as a bit of a brain dump but hopefully people will find it useful. At some point I&#x27;ll try to put up the above solution on GitHub so people can grab it easily for themselves.</p></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/service-authorization-manager">ServiceAuthorizationManager</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/windows-account">Windows Account</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/windows-service">Windows Service</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/configuration">configuration</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/wcf">WCF</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/authorisation">authorisation</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/net-tcp-binding">NetTcpBinding</a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_3-lP"><a href="/blog.johnnyreilly.com/2012/03/17/using-pubsub-observer-pattern-to">Using the PubSub / Observer pattern to emulate constructor chaining without cluttering up global scope</a></h2><div class="margin-vert--md"><time datetime="2012-03-17T00:00:00.000Z" class="blogPostDate_Ta7i">March 17, 2012  路 6 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener"><img src="https://avatars.githubusercontent.com/u/1010525?s=400&amp;u=294033082cfecf8ad1645b4290e362583b33094a&amp;v=4" alt="John Reilly"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener">John Reilly</a></h4><small class="avatar__subtitle"></small></div></div></header><section class="markdown"><p>Yes the title of this post is *<strong>painfully</strong>* verbose. Sorry about that. Couple of questions for you: - Have you ever liked the way you can have base classes in C# which can then be inherited and subclassed <u>in a different file / class</u></p><p>?</p><ul><li>Have you ever thought; gosh it&#x27;d be nice to do something like that in JavaScript...</li><li>Have you then looked at JavaScripts prototypical inheritance and thought &quot;right.... I&#x27;m sure it&#x27;s possible but this going to end up like <a href="http://en.wikipedia.org/wiki/War_and_Peace" target="_blank" rel="noopener noreferrer">War and Peace</a>&quot;</li><li>Have you then subsequently thought &quot;and hold on a minute... even if I did implement this using the prototype and split things between different files / modules wouldn&#x27;t I have to pollute the global scope to achieve that? And wouldn&#x27;t that mean that my code was exposed to the vagaries of any other scripts on the page? Hmmm...&quot;</li><li><a href="http://www.thrillingdetective.com/eyes/oxford.html" target="_blank" rel="noopener noreferrer">Men! Are you skinny? Do bullies kick sand in your face?</a> (Just wanted to see if you were still paying attention...)</li></ul><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="the-problem"></a>The Problem<a class="hash-link" href="#the-problem" title="Direct link to heading">#</a></h2><p>Well, the above thoughts occurred to me just recently. I had a situation where I was working on an MVC project and needed to build up quite large objects within JavaScript representing various models. The models in question were already implemented on the server side using classes and made extensive use of inheritance because many of the properties were shared between the various models. That is to say we would have models which were implemented through the use of a class inheriting a base class which in turn inherits a further base class. With me? Good. Perhaps I can make it a little clearer with an example. Here are my 3 classes. First BaseReilly.cs: ```cs
public class BaseReilly
{
public string LastName { get; set; }</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public BaseReilly()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        LastName = &quot;Reilly&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Next BoyReilly.cs (which inherits from BaseReilly): ```cs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">public class BoyReilly : BaseReilly</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        public string Sex { get; set; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        public BoyReilly()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            : base()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            Sex = &quot;It is a manchild&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>And finally JohnReilly.cs (which inherits from BoyReilly which in turn inherits from BaseReilly): ```cs
public class JohnReilly : BoyReilly
{
public string FirstName { get; set; }</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public JohnReilly()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        : base()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        FirstName = &quot;John&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Using the above I can create myself my very own &quot;JohnReilly&quot; like so: ```cs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">var johnReilly = new JohnReilly();</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>And it will look like this: <img src="/blog.johnnyreilly.com/assets/images/C%2523%2Bversion%2Bof%2BJohnReilly-d980bc6ac3a2f7f3fe7c55b8a7e24c7f.png"></p><p> I was looking to implement something similar on the client and within JavaScript. I was keen to ensure <a href="http://en.wikipedia.org/wiki/Code_reuse" target="_blank" rel="noopener noreferrer">code reuse</a>. And my inclination to keep things simple made me wary of making use of the <a href="http://bonsaiden.github.com/JavaScript-Garden/#object.prototype" target="_blank" rel="noopener noreferrer">prototype</a>. It is undoubtedly powerful but I don&#x27;t think even the mighty <a href="http://javascript.crockford.com/prototypal.html" target="_blank" rel="noopener noreferrer">Crockford</a> would consider it &quot;simple&quot;. Also I had the reservation of exposing my object to the global scope. So what to do? I had an idea.... ## The Big Idea</p><p> For a while I&#x27;ve been making use explicit use of the <a href="http://en.wikipedia.org/wiki/Observer_pattern" target="_blank" rel="noopener noreferrer">Observer pattern</a> in my JavaScript, better known by most as the publish/subscribe (or &quot;PubSub&quot;) pattern. There&#x27;s a million JavaScript libraries that facilitate this and after some experimentation I finally settled on <a href="https://github.com/phiggins42/bloody-jquery-plugins/blob/master/pubsub.js" target="_blank" rel="noopener noreferrer">higgins</a> implementation as it&#x27;s simple and I saw a <a href="http://jsperf.com/pubsubjs-vs-jquery-custom-events/11" target="_blank" rel="noopener noreferrer">JSPerf</a> which demonstrated it as either the fastest or second fastest in class. Up until now my main use for it had been to facilitate loosely coupled GUI interactions. If I wanted one component on the screen to influence anothers behaviour I simply needed to get the first component to publish out the relevant events and the second to subscribe to these self-same events. One of the handy things about publishing out events this way is that with them you can also include data. This data can be useful when driving the response in the subscribers. However, it occurred to me that it would be equally possible to pass an object when publishing an event. **<u>And the subscribers could enrich that object with data as they saw fit.</u></p><p>** Now this struck me as a pretty useful approach. It&#x27;s not rock solid secure as it&#x27;s always possible that someone could subscribe to your events and get access to your object as you published out. However, that&#x27;s pretty unlikely to happen accidentally; certainly far less likely than someone else&#x27;s global object clashing with your global object. ## What might this look like in practice?</p><p>So this is what it ended up looking like when I turned my 3 classes into JavaScript files / modules. First BaseReilly.js: ```js
$(function () {</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$.subscribe(&quot;PubSub.Inheritance.Emulation&quot;, function (obj) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    obj.LastName = &quot;Reilly&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">});</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>});</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Next BoyReilly.js: ```js</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">$(function () {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $.subscribe(&quot;PubSub.Inheritance.Emulation&quot;, function (obj) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        obj.Sex = &quot;It is a manchild&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    });</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">});</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>And finally JohnReilly.js: ```js
$(function () {</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">$.subscribe(&quot;PubSub.Inheritance.Emulation&quot;, function (obj) {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    obj.FirstName = &quot;John&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">});</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>});</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">If the above scripts have been included in a page I can create myself my very own &quot;JohnReilly&quot; in JavaScript like so: ```js</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">var oJohnReilly = {}; //Empty object</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    $.publish(&quot;PubSub.Inheritance.Emulation&quot;, [oJohnReilly]); //Empty object &quot;published&quot; so it can be enriched by subscribers</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    console.log(JSON.stringify(oJohnReilly)); //Show me this thing you call &quot;JohnReilly&quot;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>And it will look like this: <img src="/blog.johnnyreilly.com/assets/images/JavaScript%2Bversion%2Bof%2BJohnReilly-61bf5d26bcf47e84491e329e64ba9d24.png"></p><p> And it works. Obviously the example I&#x27;ve given above it somewhat naive - in reality my object properties are driven by GUI components rather than hard-coded. But I hope this illustrates the point. This technique allows you to simply share functionality between different JavaScript files and so keep your codebase tight. I certainly wouldn&#x27;t recommend it for all circumstances but when you&#x27;re doing something as simple as building up an object to be used to pass data around (as I am) then it works very well indeed. ## A Final Thought on Script Ordering</p><p>A final thing that maybe worth mentioning is script ordering. The order in which functions are called is driven by the order in which subscriptions are made. In my example I was registering the scripts in this order: ```html</p><script src="/Scripts/PubSubInheritanceDemo/BaseReilly.js"></script><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;script src=&quot;/Scripts/PubSubInheritanceDemo/BoyReilly.js&quot;&gt;&lt;/script&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    &lt;script src=&quot;/Scripts/PubSubInheritanceDemo/JohnReilly.js&quot;&lt;&gt;/script&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">So when my event was published out the functions in the above JS files would be called in this order: 1. BaseReilly.js</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">2. BoyReilly.js</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">3. JohnReilly.js</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;!-- --&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">If you were so inclined you could use this to emulate inheritance in behaviour. Eg you could set a property in `BaseReilly.js` which was subsequently overridden in `JohnReilly.js` or `BoyReilly.js` if you so desired. I&#x27;m not doing that myself but it occurred as a possibility. ## PS</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">If you&#x27;re interested in learning more about JavaScript stabs at inheritance you could do far worse than look at Bob Inces in depth StackOverflow [answer](&lt;http://stackoverflow.com/a/1598077/761388&gt;).</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/inheritance">inheritance</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/javascript">javascript</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/c">c#</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/observer-pattern">observer pattern</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/pubsub">pubsub</a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_3-lP"><a href="/blog.johnnyreilly.com/2012/03/12/striving-for-javascript-convention">Striving for (JavaScript) Convention</a></h2><div class="margin-vert--md"><time datetime="2012-03-12T00:00:00.000Z" class="blogPostDate_Ta7i">March 12, 2012  路 10 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener"><img src="https://avatars.githubusercontent.com/u/1010525?s=400&amp;u=294033082cfecf8ad1645b4290e362583b33094a&amp;v=4" alt="John Reilly"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener">John Reilly</a></h4><small class="avatar__subtitle"></small></div></div></header><section class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="update"></a>Update<a class="hash-link" href="#update" title="Direct link to heading">#</a></h2><p> The speed of change makes fools of us all. Since I originally wrote this post all of 3 weeks ago Visual Studio 11 beta has been released and the issues I was seeking to solve have pretty much been resolved by the new innovations found therein. It&#x27;s nicely detailed in <a href="http://www.twitter.com/carlbergenhem" target="_blank" rel="noopener noreferrer">@carlbergenhem</a>&#x27;s blog post: <a href="http://blogs.telerik.com/blogs/posts/12-03-26/my-top-5-visual-studio-11-designer-improvements-for-asp-net-4-5-development.aspx" target="_blank" rel="noopener noreferrer">My Top 5 Visual Studio 11 Designer Improvements for ASP.NET 4.5 Development</a>. I&#x27;ve left the post in place below but much of what I said (particularly with regard to Hungarian Notation) I&#x27;ve now moved away from. That was originally my intention anyway so that&#x27;s no bad thing. The one HN artefact that I&#x27;ve held onto is using &quot;$&quot; as a prefix for jQuery objects. I think that still makes sense. I would have written my first line of JavaScript in probably 2000. It probably looked something like this: <code>alert(&#x27;hello world&#x27;)</code>. I know. Classy. As I&#x27;ve mentioned before it was around 2010 before I took JavaScript in any way seriously. Certainly it was then when I started to actively learn the language. Because up until this point I&#x27;d been studiously avoiding writing any JavaScript at all I&#x27;d never really given thought to forms and conventions. When I wrote any JavaScript I just used the same style and approaches as I used in my main development language (of C#). By and large I have been following the .net naming conventions which are ably explained by Pete Brown <a href="http://10rem.net/articles/net-naming-conventions-and-programming-standards---best-practices" target="_blank" rel="noopener noreferrer">here</a>. Over time I have started to move away from this approach. Without a deliberate intention to do so I have found myself adopting a different style for my JavaScript code as compared with anything else I write. I wouldn&#x27;t go so far as to say I&#x27;m completely happy with the style I&#x27;m currently using. But I find it more helpful than not and thought it might be worth talking about. It was really 2 things that started me down the road of &quot;rolling my own&quot; convention: dynamic typing and the lack of safety nets. Let&#x27;s take each in turn.... ### 1. Dynamic typing</p><p> Having grown up (in a development sense) using compiled and strongly-typed languages I was used to the IDE making it pretty clear what was what through friendly tooltips and the like: <img src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAK4AAAA6CAIAAACmmfXsAAAAA3NCSVQICAjb4U/gAAAAX3pUWHRSYXcgcHJvZmlsZSB0eXBlIEFQUDEAAAiZ40pPzUstykxWKCjKT8vMSeVSAANjEy4TSxNLo0QDAwMLAwgwNDAwNgSSRkC2OVQo0QAFmJibpQGhuVmymSmIzwUAT7oVaBst2IwAAAnCSURBVHic7VxdbBNXFj7TpQmxopKnipV2BdhxaNOENMGWIKL7sFUScMjSTQIlsIUge5U6NGGJpYaUIpqWnwatp0kodFXiJQQWi4Yfpal/aKtdiVbaB5ywTtoQPNN94JGWB9jZtfzQnH2YGXvGnokdO3gmeD7dh5nr83t9zrnXM0cmEBGEoMBcAhUeGLLAkoLXRlxvxKVmtZrwTNqcpBls3sUzxGsjCMJMUgAAQJFmYjGFP2l4bYQYNq/MpIqREApGuI0KlQSTCdzjlBKaM4VlCGPwWMFUapSZVDFEoeC1AUEAQYjS3UYASXLzZhIAgCKBIMARAFc9N0/KfIEUaTaTJJvvpI3LDIo0R9MfRHctvS3uPlHqeG3RXOIrhaTMGDlBCKoLyxWflF4bYSOj84ucqxR51GXt7TLOO+m1qbBIiELBMgSI4DTFEzlmABHQAwEHeAGMXRyZ1QOIgAhd8vEecMw0oscacLhLQyGnKThLGbt6rQE+/alxdyC2SMaGluD15CuUKBMAAFz11xsREUNOcOwiKQDw2kpmevm8hPpYhLjccJnLVpesQkEYpRw13j4HOLstKUyqDimdFTxDAABghIQgSQHWRgsAgKmlIRovlkY+Fqhxt2iRjF29cFSuxswrEwCsHnZjMza0mAIzFAA1GwRXPfc91ruEpHz0WYbkj5rGrtsoQtJ9M6WSANzeobYjbvrHxkxg6XaCe5wCb5+jIm7lLI0Vjr7xxVFDzQRMzlDsq7w9T/WSYl9gVaDIXYnZLzmpSqQfCi9UQHA2XWZjV2+Fe5y87uLyWwBLtzPodsfu2fJPkbscgRSFe/scAWujha0+jr60t+QFVgVvnyOQUBIkJ8U/l9QCUSiQZtF5cP4ksHQDOJIcG+djb6xwOCQigQ2TQIBX4gRHCUEQJe4WpzWJSH4vqA86Q+y3ZhkKOYP8DvFk154ij7pMiSVBYhIAjKUmgMCMukKBiH/ElDV4bcTR0tACa/bTAoo0l7hbVOY9KgOPFcDqUUi5ogg5TQAgOsOoAwpUBa+NqHeByamynMh5KLdBaFAZlv3443+UtiGreP755x48eKy0FWqEMs8VNKgQObdBEETOuZwiFKkKgpdMGlSDtEJhSfcWaJBBulVB+d4CydKi1Zv0EQuFp7a3QJXNASqEqCos4d4CDRlDvEEshd4CvnbUu3h6M0lJTvIeqLE5QIVIflZQW28B/+rYY+VfYtzuMkpOLo5hOYMUjo1LordgPhVqbA5QIVL6BbG0ewtU2RygQqT26G1p9xaImgO0p42ySOFF9hLuLUhsDkjN5VwEMf9ruq8PPrfrb/By750v7YYsxeYThvZmUg5JQkFD7iC2cYbD4Rs3boRCoXA4rKxNGrKJgoKC1atXNzU1xULh8uXLq1atqq6uJghCWeM0ZBOIODMzc+vWrWXRqVAotHPnTvYz5QzToABKS0tHRkZioRAOhwEILQxyFsuEN1o9yGWIQmFuTguF3EVcVVDKDA3KQxwKoMVC7kL0Oor934zEQfVvWN7mQ/S9mb9hgJIlS2FkLIHqr5aVIClcVqOv7dnqfnoh8hdx+N7Mf3Z5m2/xVibThU0MBSlQH+298vrUJ5vZQ2WGD7ozlWA48G34nx2GBQiX01j3ycyOK38YoBYgH9FrX74hniUtAKyvmvqd3ZfczpQFZsoufkmNEoP2XIEdW4vZWxmaBYzMJSxUuKzG4s4j6w45fcrYD7DjyKmpD/rpxZKcMXvSqkB5PoPtW9g0AYzSUP2bdHk6XZ5Ol2f3x4gHNokm/XbuVsfFv0ACTx9j97fpNvVTElw+u26j3b5Rp2vzo8+u28jmpbRwmjNsE5e8kja3cTr1L1ZN3RMneVS+z67bODDQpotJ89l124Zh4tC6qEYBi58TbvcjNbBRwCXpIyAA6g+8W/52a7ydMQfjjZFVIed7osuxlYz7mlM5K9Czk+tKDLEdBQAQ/e0Vb5dfizBMhAmemm6sHqQBkR585aXR7d8zTIRhImdqARFqz0QYJsIwY3svvD9ICyWwo7jj8L4LY3721j92fu/hAwZpronpF0YY5i+1AgmSZD3H4DwTYYKnoGePWKO/veLK9mCEYSLMNTg2SCMCGtaWT96lE3ZNVj7ARM/sawwTYa7tm+z5sx83n2HG9sL6k8EIc2azmIXXe23fhcb8fTAi4JL2kUXtmbHyeDtFSyQyRlaFnO8SLkdXMq2zAoiCBxGRnp2G1oZaNrE639kzcZdCpL8YnWx95y3xNutvKyzMLyzcdiEqPE5L7bY9F26wATs23XewVo5rffMWQ7wEKbITf+3UC60S2TzRU5FfWJhf2HR+kvvMsLZq6h4dnyAxaQfrOCOBJ5Ncpaje2m17oqZGuSR95OTUfXy1vMfpE+sVqEh0TVKFpO+SLgtXUuS0OBTmEBMHGyL8NSLiHF/N2EkEAIifnEOcowd+0wyjj8OPHk8fr2QZoxKio+5PJ6aOn6ao0+9PN1vWpMDFXScho+5Ns1YJbW4dfRx+xI6P61iy2clyoz7OX3mlEvbLUgquE3wUktU6jk+/tv/mAvQmI4j6LuGypP1zqW0QxWsrp0I0fwsACKgvKYPhz28CIiA9eGKkdWsNoN7SXDl84rTg5xl9907li3oEpL1X7wAIJQiGfvPrMOr8aHRdz/7ilLjYa2myyateGrnJ1q018TaLzENAOjTNChEOkFcqZb8speCa9xGaNxcnkBXvd/VNN/9+hJspXls5Ocsu+M2xkfmNERmW4Luky5L2p7ZBGOqa4aqPL7V8WRuc+PC77QVFKwqKqq40TZytQUQ0tP/jRtnh8qIVBUUrCjpuItZ0HYPu9SsKiqx3yypBLEEA/ZYmGL5Ytq2GvU3CxV9Lk1WVze4tWlFQVNVd9hlrlchm4M0resuPiEjfvVNWohdZE6WXUop1DW9MHq7i2eM/lb/Wd/SUDV8sO9KuTyRD1HecO17Fzxjae1ovsmv7ObwxnzFx1ib6nuiy7DEAhK0r3d3dh3reg0T8MPjqH+HTv3c+JR1tMdBnf9sK575tz4pjX3Xqxhv+N1iTDV1p4MOT76XwZlLf8WnTK+aOkoeDdVmyKyv4qnPduy9df6iXdnqR8cPgye9OnhvIiq50IQoFkDFUb//mofynSxQ1A//NilP02Vcrjvyr6oPb3+jVvYDRUKBAripoyAgG+9eMHUD9qxsNBSM8bWmvYWHQupg0cNC6mDRw0LqYNHDQNggNHGKhkJeXBzCHqP2pZ84Bf/4ZhKGwZs2a+/f//atf/hp+kaecVRoUwIPvv3zmp59iD54fPXp06dKl+/fvK2uWhuxj5cqVu3fv/j/uFn0+fT2EAgAAAABJRU5ErkJggg=="></p><p> JavaScript is loosely / dynamically typed (<a href="http://stackoverflow.com/questions/9154388/does-untyped-also-mean-dynamically-typed-in-the-academic-cs-world" target="_blank" rel="noopener noreferrer">occasionally called &quot;untyped&quot; but let&#x27;s not go there</a>). This means that the IDE can&#x27;t easily determine what&#x27;s what. So no tooltips for you sunshine. ### 2. The lack of safety nets / running with scissors</p><p> Now I&#x27;ve come to love it but what I realised pretty quickly when getting into JavaScript was this: you are running with scissors. If you&#x27;re not careful and you don&#x27;t take precautions it can bloody quickly. If I&#x27;m writing C# I have a lot of safety nets. Not the least of which is &quot;does it compile&quot;? If I declare an integer and then subsequently try to assign a string value to it <u>it won&#x27;t let me</u></p><p>. But JavaScript is forgiving. Some would say too forgiving. Let&#x27;s do something mad: ```js
var iAmANumber = 77;</p><p>console.log(iAmANumber); //Logs a number</p><p>iAmANumber = &quot;It&#x27;s a string&quot;;</p><p>console.log(iAmANumber); //Logs a string</p><p>iAmANumber = {
description: &quot;I am an object&quot;
};</p><p>console.log(iAmANumber); //Logs an object</p><p>iAmANumber = function (myVariable) {</p><p>  console.log(myVariable);
}</p><p>console.log(iAmANumber); //Logs a function
iAmANumber(&quot;I am not a number, I am a free man!&quot;); //Calls a function which performs a log</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Now if I were to attempt something similar in C# fuggedaboudit but JavaScript; no I&#x27;m romping home free: ![](../static/blog/2012-03-12-striving-for-javascript-convention/Mad%2BStuff.png)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> Now I&#x27;m not saying that you should ever do the above, and thinking about it I can&#x27;t think of a situation where you&#x27;d want to (suggestions on a postcard). But the point is it&#x27;s possible. And because it&#x27;s possible to do this deliberately, it&#x27;s doubly possible to do this accidentally. My point is this: it&#x27;s easy to make bugs in JavaScript. ## What ~~Katy~~ Johnny Did Next</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">I&#x27;d started making more and more extensive use of JavaScript. I was beginning to move in the direction of using the [single-page application](&lt;http://en.wikipedia.org/wiki/Single-page_application&gt;) approach (*&lt;sideNote&gt;although more in the sense of giving application style complexity to individual pages rather than ensuring that entire applications ended up in a single page&lt;/sideNote&gt;*). This meant that whereas in the past I&#x27;d had the occasional 2 lines of JavaScript I now had a multitude of functions which were all interacting in response to user input. All these functions would contain a number of different variables. As well as this I was making use of jQuery for both Ajax purposes and to smooth out the DOM inconsistencies between various browsers. This only added to the mix as variables in one of my functions could be any one of the following: - a number</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">- a string</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">- a boolean</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">- a date</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">- an object</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">- an array</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">- a function</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">- a jQuery object - not strictly a distinct JavaScript type obviously but treated pretty much as one in the sense that it has a particular functions / properties etc associated with it</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;!-- --&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> As I started doing this sort of work I made no changes to my coding style. Wherever possible I did \***exactly**\* what I would have been doing in C# in JavaScript. And it worked fine. Until.... Okay there is no &quot;until&quot; as such, it did work fine. But what I found was that I would do a piece of work, check it into source control, get users to test it, release the work into Production and promptly move onto the next thing. However, a little way down the line there would be a request to add a new feature or perhaps a bug was reported and I&#x27;d find myself back looking at the code. And, as is often the case, despite the comments I would realise that it wasn&#x27;t particularly clear why something worked in the way it did. (Happily it&#x27;s not just me that has this experience, paranoia has lead me to ask many a fellow developer and they have confessed to similar) When it came to bug hunting in particular I found myself cursing the lack of friendly tooltips and the like. Each time I wanted to look at a variable I&#x27;d find myself tracking back through the function, looking for the initial use of the variable to determine the type. Then I&#x27;d be tracking forward through the function for each subsequent use to ensure that it conformed. Distressingly, I would find examples of where it looked like I&#x27;d forgotten the type of the variable towards the end of a function (for which I can only, regrettably, blame myself). Most commonly I would have a situation like this: ```js</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">var tableCell = $(&quot;#ItIsMostDefinitelyATableCell&quot;); //I jest ;-)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">/* ...THERE WOULD BE SOME CODE DOING SOMETHING HERE... */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">tableCell.className = &quot;makeMeProminent&quot;; //Oh dear - not good.</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p> You see what happened above? I forgot I had a jQuery object and instead treated it like it was a standard DOM element. Oh dear. ## Spinning my own safety net; Hungarian style</p><p> After I&#x27;d experienced a few of the situations described above I decided that steps needed to be taken to minimise the risk of this. In this case, I decided that &quot;steps&quot; meant <a href="http://en.wikipedia.org/wiki/Hungarian_notation" target="_blank" rel="noopener noreferrer">Hungarian notation</a>. I know. I bet you&#x27;re wincing right now. For those of you that don&#x27;t remember HN was pretty much the standard way of coding at one point (although at the point that I started coding professionally it had already started to decline). It was adopted in simpler times long before the modern IDE&#x27;s that tell you what each variable is became the norm. Back when you couldn&#x27;t be sure of the types you were dealing with. In short, kind of like my situation with JavaScript right now. There&#x27;s not much to it. By and large HN simply means having a lowercase prefix of 1-3 characters on all your variables indicating type. It doesn&#x27;t solve all your problems. It doesn&#x27;t guarantee to stop bugs. But because each instance of the variables use implicitly indicates it&#x27;s type it makes bugs more glaringly obvious. This means when writing code I&#x27;m less likely to misuse a variable (eg <code>iNum = &quot;JIKJ&quot;</code>) because part of my brain would be bellowing: &quot;that just looks wrong... pay better attention lad!&quot;. Likewise, if I&#x27;m scanning through some JavaScript and searching for a bug then this can make it more obvious. Here&#x27;s some examples of different types of variables declared using the style I have adopted: ```js
var iInteger = 4;
var dDecimal = 10.50;
var sString = &quot;I am a string&quot;;
var bBoolean = true;
var dteDate = new Date();
var oObject = {
description: &quot;I am an object&quot;
};
var aArray = [34, 77];
var fnFunction = function () {
//Do something
};
var $jQueryObject = $(&quot;#ItIsMostDefinitelyATableCell&quot;);</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> Some of you have read this and thought &quot;hold on a minute... JavaScript doesn&#x27;t have integers / decimals etc&quot;. You&#x27;re quite right. My style is not specifically stating the type of a variable. More it is seeking to provide a guide on how a variable should be used. JavaScript does not have integers. But oftentimes I&#x27;ll be using a number variable which i will only ever want to treat as an integer. And so I&#x27;ll name it accordingly. ## Spinning a better safety net; DOJO style</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">I would be the first to say that alternative approaches are available. And here&#x27;s one I recently happened upon that I rather like the look of: look 2/3rds down at the parameters section of [the DOJO styleguide](&lt;http://dojotoolkit.org/community/styleGuide&gt;) Essentially they advise specifying parameter types through the use of prefixed comments. See the examples below: ```js</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">function(/*String*/ foo, /*int*/ bar)...</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>or ```js
function(/<em>String?</em>/ foo, /<em>int</em>/ bar, /<em>String[]?</em>/ baz)...</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">I really rather like this approach and I&#x27;m thinking about starting to adopt it. It&#x27;s not possible in Hungarian Notation to be so clear about the purpose of a variable. At least not without starting to adopt all kinds of kooky conventions that take in all the possible permutations of variable types. And if you did that you&#x27;d really be defeating yourself anyway as it would simply reduce the clarity of your code and make bugs more likely. ## Spinning a better safety net; unit tests</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Despite being quite used to writing unit tests for all my server-side code I have not yet fully embraced unit testing on the client. Partly I&#x27;ve been holding back because of the variety of JavaScript testing frameworks available. I wasn&#x27;t sure which to start with. But given that it is so easy to introduce bugs into JavaScript I have come to the conclusion that it&#x27;s better to have some tests in place rather than none. Time to embrace the new. ## Conclusion</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">I&#x27;ve found using Hungarian Notation useful whilst working in JavaScript. Not everyone will feel the same and I think that&#x27;s fair enough; within reason I think it&#x27;s generally a good idea to go with what you find useful. However, I am giving genuine consideration to moving to the DOJO style and moving back to my more standard camel-cased variable names instead of Hungarian Notation. Particularly since I strive to keep my functions short with the view that ideally each should 1 thing well. Keep it simple etc... And so in a perfect world the situation of forgetting a variables purpose shouldn&#x27;t really arise... I think once I&#x27;ve got up and running with JavaScript unit tests I may make that move. Hungarian Notation may have proved to be just a stop-gap measure until better techniques were employed... </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/naming-convention">naming convention</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/javascript">javascript</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/hungarian-notation">Hungarian Notation</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/dojo">DOJO</a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_3-lP"><a href="/blog.johnnyreilly.com/2012/03/03/jquery-unobtrusive-remote-validation">jQuery Unobtrusive Remote Validation</a></h2><div class="margin-vert--md"><time datetime="2012-03-03T00:00:00.000Z" class="blogPostDate_Ta7i">March 3, 2012  路 9 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener"><img src="https://avatars.githubusercontent.com/u/1010525?s=400&amp;u=294033082cfecf8ad1645b4290e362583b33094a&amp;v=4" alt="John Reilly"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener">John Reilly</a></h4><small class="avatar__subtitle"></small></div></div></header><section class="markdown"><p>Just recently I have been particularly needing to make use of remote / server-side validation in my ASP.NET MVC application and found that the unobtrusive way of using this seemed to be rather inadequately documented (of course it&#x27;s possible that it&#x27;s well documented and I just didn&#x27;t find the resources). Anyway I&#x27;ve rambled on much longer than I intended to in this post so here&#x27;s the TL;DR:</p><ul><li>You *<strong>can</strong>* use remote validation driven by unobtrusive data attributes</li><li>Using remote validation you can supply *<strong>multiple</strong>* parameters to be evaluated</li><li>It is possible to block validation and force it to be re-evaluted - although using a slightly hacky method which I document here. For what it&#x27;s worth I acknowledge up front that this is *<strong>not</strong>* an ideal solution but it does seem to work. I really hope there is a better solution out there and if anyone knows about it then please get in contact and let me know.</li></ul><p>Off we go... So, jQuery unobtrusive validation; clearly the new cool right?</p><p>I&#x27;d never been particularly happy with the validation that I had traditionally been using with ASP.NET classic. It worked... but it always seemed a little... clunky? I realise that&#x27;s not the most well expressed concern. For basic scenarios it seemed fine, but I have recollections of going through some pain as soon as I stepped outside of the basic form validation. Certainly when it came to validating custom controls that we had developed it never seemed entirely straightforward to get validation to play nice.</p><p>Based on this I was keen to try something new and the opportunity presented itself when we started integrating MVC into our classic WebForms app. (By the way if you didn&#x27;t know that MVC and ASP.NET could live together in perfect harmony, well, they can! And a good explanation on how to achieve it is offered by Colin Farr <a href="http://www.britishdeveloper.co.uk/2011/05/convert-web-forms-mvc3-how-to.html" target="_blank" rel="noopener noreferrer">here</a>.)</p><p>J枚rn Zaefferer came out with the <a href="http://bassistance.de/jquery-plugins/jquery-plugin-validation/" target="_blank" rel="noopener noreferrer">jQuery validation plug-in</a> way back in 2006. And mighty fine it is too. Microsoft (gor&#x27; bless &#x27;em) really brought something new to the jQuery validation party when they came out with their unobtrusive javascript validation library along with MVC 3. What this library does, in short, is allows for jQuery validation to be driven by <code>data-val-*</code> attributes alone as long as the <a href="http://ajax.aspnetcdn.com/ajax/jquery.validate/1.9/jquery.validate.js" target="_blank" rel="noopener noreferrer">jquery.validate.js</a> and <a href="http://ajax.aspnetcdn.com/ajax/mvc/3.0/jquery.validate.unobtrusive.js" target="_blank" rel="noopener noreferrer">jquery.validate.unobtrusive.js</a> libraries are included in the screen (I have assumed you are already including jQuery). I know; powerful stuff!</p><p>A good explanation of unobtrusive validation is given by Brad Wilson <a href="http://bradwilson.typepad.com/blog/2010/10/mvc3-unobtrusive-validation.html" target="_blank" rel="noopener noreferrer">here</a>.</p><p>Anyway, to my point: what about remote validation? That is to say, what about validation which needs to go back to the server to perform the necessary tests? Well I struggled to find decent examples of how to use this. Those that I did find seemed to universally be php examples; not so useful for an ASP.NET user. Also, when I did root out an ASP.NET example there seemed to be a fundamental flaw. Namely, if remote validation hadn&#x27;t been triggered and completed successfully then the submit could fire anyway. This seems to be down to the asynchronous nature of the test; ie because it is *<strong>not</strong>* synchronous there is no &quot;block&quot; to the submit. And out of the box with unobtrusive validation there seems no way to make this synchronous. I could of course wire this up manually and simply side-step the restrictions of unobtrusive validation but that wasn&#x27;t what I wanted.</p><p>***Your mission John, should you decide to accept it, is this: <u>block the submit until remote validation has completed successfully</u></p><p>. As always, should you or any of your I.M. Force be caught or killed, the Secretary will disavow any knowledge of your actions.***</p><p>So that&#x27;s what I wanted to do. Make it act like it&#x27;s synchronous even though it&#x27;s asynchronous. Bit horrible but I had a deadline to meet and so this is my pragmatic solution. There may be better alternatives but this worked for me.</p><p>First of all the HTML:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-html codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">form</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">action</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">/Dummy/ValidationDemo.mvc/SaveUser</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">id</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">ValidationForm</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">method</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">post</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain">  </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  First name: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">input</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">data-val</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">true</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">data-val-required</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">First Name required</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">      </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">id</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">FirstName</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">name</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">FirstName</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">type</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">text</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">value</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Last name: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">input</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">data-val</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">true</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">data-val-required</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">Last Name required</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">      </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">id</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">LastName</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">name</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">LastName</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">type</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">text</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">value</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  User name: </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">input</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">id</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">UserName</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">name</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">UserName</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">type</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">text</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">value</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">data-val</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">true</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">data-val-required</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">You must enter a user name before we can validate it remotely</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">data-val-remote</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value entity named-entity" style="color:rgb(255, 85, 114)">&amp;amp;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">#39;UserNameInput</span><span class="token tag attr-value entity named-entity" style="color:rgb(255, 85, 114)">&amp;amp;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">#39; is invalid.</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">data-val-remote-additionalfields</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">*.FirstName,*.LastName</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">    </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">data-val-remote-url</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">/Dummy/ValidationDemo/IsUserNameValid</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">input</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">id</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">SaveMyDataButton</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">name</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">SaveMyDataButton</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">      </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">type</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">button</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">value</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">Click to Save</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">form</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>I should mention that on my actual page (a cshtml partial view) the HTML for the inputs is generated by the use of the <a href="http://msdn.microsoft.com/en-us/library/system.web.mvc.html.inputextensions.textboxfor.aspx" target="_blank" rel="noopener noreferrer">InputExtensions.TextBoxFor</a> method which is lovely. It takes your model and using the validation attributes that decorate your models properties it generates the relevant jQuery unobtrusive validation data attributes so you don&#x27;t have to do it manually.</p><p>But for the purposes of seeing what&#x27;s &quot;under the bonnet&quot; I thought it would be more useful to post the raw HTML so it&#x27;s entirely clear what is being used. Also there doesn&#x27;t appear to be a good way (that I&#x27;ve yet seen) for automatically generating Remote validation data attributes in the way that I&#x27;ve found works. So I&#x27;m manually specifying the <code>data-val-remote-*</code> attributes using the htmlAttributes parameter of the TextBoxFor (<a href="http://stackoverflow.com/questions/4844001/html5-data-with-asp-net-mvc-textboxfor-html-attributes" target="_blank" rel="noopener noreferrer">using &quot;_&quot; to replace &quot;-&quot;</a> obviously).</p><p>Next the JavaScript that performs the validation:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-js codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">$</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token dom variable" style="color:rgb(191, 199, 213)">document</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">ready</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">var</span><span class="token plain"> intervalId </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword null nil" style="font-style:italic">null</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// DECLARE FUNCTION EXPRESSIONS</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//======================================================</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// function that triggers update when remote validation </span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// completes successfully</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//======================================================</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">pendingValidationComplete</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">var</span><span class="token plain"> i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> errorList</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> errorListForUsers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">var</span><span class="token plain"> $ValidationForm </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">$</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;#ValidationForm&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword control-flow" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">$ValidationForm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;validator&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">pendingRequest</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">===</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token function" style="color:rgb(130, 170, 255)">clearInterval</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">intervalId</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//Force validation to present to user </span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//(this will *not* retrigger remote validation)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword control-flow" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">$ValidationForm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">valid</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">alert</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Validation has succeeded - you can now submit&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token keyword control-flow" style="font-style:italic">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//Validation failed! </span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        errorList </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> $ValidationForm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">data</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;validator&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">errorList</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        errorListForUsers </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword control-flow" style="font-style:italic">for</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">i </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain"> errorList</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">length</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> i</span><span class="token operator" style="color:rgb(137, 221, 255)">++</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">          errorListForUsers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">push</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">errorList</span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain">i</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">message</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">alert</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">errorListForUsers</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">join</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;\r\n&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//======================================================</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Trigger validation</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//======================================================</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">triggerValidation</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">evt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//Removed cached values where remote is concerned</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// so remote validation is retriggered</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">$</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;#UserName&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">removeData</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;previousValue&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//Trigger validation</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">$</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;#ValidationForm&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">valid</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//Setup interval which will evaluate validation </span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//(this approach because of remote validation)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    intervalId </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">setInterval</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">pendingValidationComplete</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">50</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//ASSIGN EVENT HANDLERS</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">$</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;#SaveMyDataButton&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">click</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">triggerValidation</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>And finally the Controller:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cs codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">public JsonResult IsUserNameValid(string UserName,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                  string FirstName, </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                                  string LastName)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  var userNameIsUnique = IsUserNameUnique(UserName);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  if (userNameIsUnique)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    return Json(true, JsonRequestBehavior.AllowGet);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  else</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    return Json(string.Format(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                  &quot;{0} is already taken I&#x27;m afraid {1} {2}&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                  UserName, FirstName, LastName), </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                JsonRequestBehavior.AllowGet);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">private bool IsUserNameUnique(string potentialUserName)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  return false;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>So what happens here exactly? Well it&#x27;s like this:</p><ol><li>The user enters their first name, last name and desired user name and hits the &quot;Click to Save&quot; button. </li><li>This forces validation by first removing any cached validation values stored in <code>previousValue</code> data attribute and then triggering the <code>valid</code> method. Disclaimer: I KNOW THIS IS A LITTLE HACKY. I would have expected there would be some way in the API to manually re-force validation. Unless I&#x27;ve missed something there doesn&#x27;t appear to be. (<a href="http://stackoverflow.com/a/3797712/761388" target="_blank" rel="noopener noreferrer">And the good citizens of Stack Overflow would seem to concur.</a>) I would guess that the underlying assumption is that if nothing has changed on the client then that&#x27;s all that matters. Clearly that&#x27;s invalid for our remote example given that a username could be &quot;claimed&quot; at any time; eg in between people first entering their username (when validation should have fired automatically) and actually submitting the form. Anyway - this approach seems to get us round the problem. </li><li>When validation takes place the IsUserNameValid action / method on our controller will be called. It&#x27;s important to note that I have set up a method that takes 3 inputs; UserName, which is supplied by default as the UserName input is the one which is decorated with remote validation attributes as well as the 2 extra inputs of FirstName and LastName. In the example I&#x27;ve given I don&#x27;t actually need these extra attributes. I&#x27;m doing this because I know that I have situations in remote validation where I *<strong>need</strong>* to supply multiple inputs and so essentially I did it here as a proof of concept. The addition of these 2 extra inputs was achieved through the use of the <code>data-val-remote-additionalfields</code> attribute. When searching for documentation about this I found absolutely <u>none</u></li></ol><p>. I assume there is some out there - if anyone knows then I&#x27;d very pleased to learn about it. I only learned about it in the end by finding an example of someone using this out in the great wide world and understanding how to use it based on their example. To understand how the <code>data-val-remote-additionalfields</code> attribute works you can look at jquery.validate.unobtrusive.js. If you&#x27;re just looking to get up and running then I found that the following works: <code>data-val-remote-additionalfields=&quot;*.FirstName,*.LastName&quot;</code> You will notice that: - Each parameter is supplied in the format <em>*.[InputName]</em> and inputs are delimited by &quot;,&quot;&#x27;s - Name is a <u>required</u></p><p> attribute for an input if you wish it to be evaluated with unobtrusive validation. (Completely obvious statement I realise; I&#x27;m writing that sentence more for my benefit than yours) - Finally, our validation always fails. That&#x27;s deliberate - I just wanted to be clear on the approach used to get remote unobtrusive validation with extra parameters up and running.
4. Using <code>setInterval</code> we intend to trigger the <code>pendingValidationComplete</code> function to check if remote validation has completed every 50ms - again I try to avoid setInterval wherever possible but this seems to be the most sensible solution in this case.
5. When the remote request finally completes (ie when <code>pendingRequest</code> has a value of 0) then we can safely proceed on the basis of our validation results. In the example above I&#x27;m simply alerting to the screen based on my results; this is *<strong>not</strong>* advised for any finished work; I&#x27;m just using this mechanism here to demonstrate the principle.</p><p><img src="/blog.johnnyreilly.com/assets/images/validation-screenshot2-c75182f9ca0cb7f729b344ee31f67637.png"></p></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/jquery">jquery</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/jquery-remote-validation">jquery remote validation</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/jquery-unobtrusive-validation">jquery unobtrusive validation</a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_3-lP"><a href="/blog.johnnyreilly.com/2012/02/23/joy-of-json">The Joy of JSON</a></h2><div class="margin-vert--md"><time datetime="2012-02-23T00:00:00.000Z" class="blogPostDate_Ta7i">February 23, 2012  路 4 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener"><img src="https://avatars.githubusercontent.com/u/1010525?s=400&amp;u=294033082cfecf8ad1645b4290e362583b33094a&amp;v=4" alt="John Reilly"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener">John Reilly</a></h4><small class="avatar__subtitle"></small></div></div></header><section class="markdown"><p>So back to JSON. For those of you that don&#x27;t know JSON stands for JavaScript Object Notation and is lightweight text based data interchange format. Rather than quote other people verbatim you can find thorough explanations of JSON here: - <a href="http://www.json.org/" target="_blank" rel="noopener noreferrer">Introducing JSON</a></p><ul><li><a href="http://www.json.org/js.html" target="_blank" rel="noopener noreferrer">JSON in Javascript</a></li></ul><p> As mentioned in my previous <a href="http://icanmakethiswork.blogspot.com/2012/02/potted-history-of-using-ajax-on.html" target="_blank" rel="noopener noreferrer">post on Ajax</a> I came upon JSON quite by accident and was actually using it for some time without having any idea. But let&#x27;s pull back a bit. Let&#x27;s start with the JavaScript Object Literal. Some years ago I came upon this article by Christan Heilmann about the JavaScript Object Literal which had been published all the way back in 2006: <a href="http://christianheilmann.com/2006/02/16/show-love-to-the-object-literal/" target="_blank" rel="noopener noreferrer">Show love to the JavaScript Object Literal</a> Now when I read this it was a revelation to me. I hadn&#x27;t really used JavaScript objects a great deal at this point (yes I am one of those people that started using JavaScript without actually learning the thing) and when I had used them is was through the <code>var obj = new Object()</code> pattern (as that&#x27;s the only approach I knew). So it was wonderful to discover that instead of the needlessly verbose: ```js
var myCar = new Object();
myCar.wheels = 4;
myCar.colour = &quot;blue&quot;;</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> I could simply use the much more concise object literal syntax to declare an object instead: ```js</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">var myCar = { wheels: 4, colour: &quot;blue&quot; };</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p> Lovely. Henceforth I adopted this approach in my code as I&#x27;m generally a believer that brevity is best. It was sometime later that I happened upon JSON (when I started looking into <a href="http://icanmakethiswork.blogspot.com/2012/01/jqgrid-its-just-far-better-grid.html" target="_blank" rel="noopener noreferrer">jqGrid</a>). Basically I was looking to pass complex data structures backward and forward to the server and, as far as I knew, there was no way to achieve this simply in JavaScript. I was expecting that I would have to manually serialise and deserialise (yes dammit I will use the English spellings!) objects when ever I wanted to do this sort of thing. However, I was reading the the fantastic Dave Ward&#x27;s <a href="http://encosia.com/" target="_blank" rel="noopener noreferrer">Encosia</a> blog which on this occasion was talking about the <a href="http://encosia.com/why-aspnet-ajax-updatepanels-are-dangerous/" target="_blank" rel="noopener noreferrer">troubles of UpdatePanels</a> (a subject close to my heart by the way) and more interestingly the use of PageMethods in ASP.NET. This is what he said that made me prick up my ears: <em>&quot;Page methods allow ASP.NET AJAX pages to directly execute a pages static methods, using JSON (JavaScript Object Notation). JSON is basically a minimalistic version of SOAP, which is perfectly suited for light weight communication between client and server.&quot;</em> JSON is a lightweight SOAP eh? I&#x27;ve used SOAP. I wonder if I could use this.... To my complete surprise, and may I say delight, I discovered that a wonderful fellow called Douglas Crockford, he of <a href="http://www.amazon.co.uk/JavaScript-Good-Parts-Douglas-Crockford/dp/0596517742" target="_blank" rel="noopener noreferrer">JavaScript, The Good Parts</a> fame had quietly come up with JSON some time ago. JSON, from my perspective, turned out to be a simple way to turn an object into a string and then from a string back into an object. So simple that it consists of 2 methods on a JSON object: - JSON.stringify(myObject) - take an object and make me a JSON string. (and by the way isn&#x27;t &quot;stringify&quot; just the loveliest method name ever?)</p><ul><li>JSON.parse(myJSONString) - take a JSON string and make me an object</li></ul><p>Let me illustrate the above method names using the myCar example from earlier: ```js
var myCar = { wheels: 4, colour: &quot;blue&quot; };
// myCar is an object</p><p>var myCarJSON = JSON.stringify(myCar);
//myCarJSON will look like this: &#x27;{&quot;wheels&quot;:4,&quot;colour&quot;:&quot;blue&quot;}&#x27;</p><p>var anotherCarMadeFromMyJSON = JSON.parse(myCarJSON);
//anotherCarMadeFromMyJSON will be a brand new &quot;car&quot; object</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> I&#x27;ve also demonstrated this using the Chrome Console: ![](../static/blog/2012-02-23-joy-of-json/Using%2BJSON.png)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> Crockford initially invented/discovered JSON himself and wrote a little helper library which provided a JSON object to be used by all and sundry. This can be found here: [JSON on GitHub](&lt;https://github.com/douglascrockford/JSON-js&gt;) Because JSON was so clearly wonderful, glorious and useful it ended up becoming a part of the EcmaScript 5 spec (in fact it&#x27;s worth reading the brilliant [John Resig&#x27;s blog post](&lt;http://ejohn.org/blog/ecmascript-5-strict-mode-json-and-more/&gt;) on this). This has lead to JSON being offered [natively in browsers](&lt;http://en.wikipedia.org/wiki/JSON#Native_encoding_and_decoding_in_browsers&gt;) for quite some time. However, for those of us (and I am one alas) still supporting IE 6 and the like we still have Crockfords JSON2.js to fall back on.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/dave-ward">Dave Ward</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/json">json</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/encosia">Encosia</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/christian-heilmann-javascript-object-literal">Christian Heilmann javascript object literal</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/douglas-crockford">douglas crockford</a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_3-lP"><a href="/blog.johnnyreilly.com/2012/02/15/wcf-transport-windows-authentication">WCF Transport Windows authentication using NetTcpBinding in an Intranet environment</a></h2><div class="margin-vert--md"><time datetime="2012-02-15T00:00:00.000Z" class="blogPostDate_Ta7i">February 15, 2012  路 5 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener"><img src="https://avatars.githubusercontent.com/u/1010525?s=400&amp;u=294033082cfecf8ad1645b4290e362583b33094a&amp;v=4" alt="John Reilly"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener">John Reilly</a></h4><small class="avatar__subtitle"></small></div></div></header><section class="markdown"><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="update"></a>Update<a class="hash-link" href="#update" title="Direct link to heading">#</a></h2><p>Since I wrote this initial post I&#x27;ve taken thinks on a bit further. Take a look at this post to see what I mean: <a href="http://icanmakethiswork.blogspot.com/2012/03/wcf-moving-from-config-to-code-simple.html" target="_blank" rel="noopener noreferrer">http://icanmakethiswork.blogspot.com/2012/03/wcf-moving-from-config-to-code-simple.html</a> I know I said I&#x27;d write about JSON this time. I will get to that but not this time. This time WCF authentication quirks. I&#x27;ve been working on a project that uses .NET Remoting to have a single central point to which web applications and Windows services can call into. This is used in an intranet environment and all the websites and Windows services were hosted on the same single server along with our .NET Remoting Windows service. (They could quite easily have been on different servers but there was no need in this case.) It was decided to &quot;embrace the new&quot; by migrating this .NET Remoting project over to WCF. The plan wasn&#x27;t to do anything revolutionary, just to move from one approach to the other as easily as possible. I found the following useful article on MSDN: <a href="http://msdn.microsoft.com/en-us/library/aa730857%28v=vs.80%29.aspx" target="_blank" rel="noopener noreferrer">http://msdn.microsoft.com/en-us/library/aa730857%28v=vs.80%29.aspx</a> This particular article was helpful and following the steps enclosed I was quickly up and running with a basic WCF service hosted in a Windows service. It was at this point I started thinking about security. The existing .NET Remoting approach had no security in place. This wasn&#x27;t ideal but also probably wasn&#x27;t the worry you might think. It was hosted in an intranet environment and hence not so exposed to the rigours of the Wild Wild Web. However, since I was looking at WCF I thought it would be a good opportunity to get some basic security in place. This generally pleases auditors. I opted to use <a href="http://msdn.microsoft.com/en-us/library/ms733089.aspx" target="_blank" rel="noopener noreferrer">Windows Transport authentication</a> as this seemed pretty appropriate for an intranet environment. The idea being that we&#x27;d authenticate with Windows for an account in our domain. After headbutting Windows for some time I managed to get a successful client call going from the website running on my development machine to the (separate) development server that was hosting our WCF Window service using Transport Windows authentication. However, when deploying the website to the development server I discovered we would experience the following error when the website attempted to call the WCF service (on the same server). ```
Event Type:            Failure Audit
Event Source:         Security
Event Category:     Logon/Logoff
Event ID: 537
Date:                       15/02/2012
Time:                       16:32:04
User:                       NT AUTHORITY\SYSTEM
Computer:               MINE999
Description:
Logon Failure:
Reason:                   An error occurred during logon
Logon Type:            3
Logon Process:         ^
Authentication Package:         NTLM
Status code:            0xC000006D</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> Not terribly helpful. At the end of the day it seemed we were suffering from a security &quot;feature&quot; introduced by Microsoft to prevent services calling services on the same box with a fully qualified name. An explanation of this can be found here: [http://developers.de/blogs/damir\_dobric/archive/2009/08/28/authentication-problems-by-using-of-ntlm.aspx](&lt;http://developers.de/blogs/damir_dobric/archive/2009/08/28/authentication-problems-by-using-of-ntlm.aspx&gt;) Using method 1 in the enclosed link I initially worked round this by amending the registry and rebooting the server: [http://support.microsoft.com/kb/887993](&lt;http://support.microsoft.com/kb/887993&gt;) This was not a fantastic solution. Fortunately I subsequently found a better one but since the resources on the web are \***ATROCIOUS**\* on this point I thought I should take the time to note down the full explanation since otherwise it&#x27;ll be lost in the mists of time. Here we go: The equivalent security to the previous .NET Remoting solution in WCF was to use this config setting on client and service: ```xml</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;security mode=&quot;None&quot; /&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p> As I&#x27;ve said, this is an intranet environment and so having this &quot;none&quot; security setting in place is made less worrying by the fact that the network itself is secured. But obviously this is not ideal and unlikely to be audit compliant. To use Windows security you need this netTcpBinding config setting on client and service: ```xml</p><security mode="Transport"><transport clientcredentialtype="Windows"></transport></security>```<p> To call the service with this setting in place you will need to be an authenticated Windows user. (Or at the very least impersonating one - but you knew that.) <strong>NOW FOR THE MOST IMPORTANT BIT.....</strong> The endpoint addresses *<strong>must</strong>* be &quot;localhost&quot; for <u>both</u></p><p> client and service when both are deployed to the same server. If this is not the case then you will suffer from the aforementioned security &quot;feature&quot; which will provide you with unhelpful &quot;the server has rejected the client credentials&quot; messages and *<strong>nothing</strong>* else. <strong>OK FINISHED - MOVE ALONG NOW... NOTHING MORE TO SEE HERE</strong> With WCF Windows Transport authentication in place you can interrogate the calling user id within the service methods by simply evaluating ServiceSecurityContext.Current.PrimaryIdentity.Name (which will be something like &quot;myDomain\myUserName&quot;). So we you wanted to, we could have a simple step which evaluated if the calling user is on the &quot;approved&quot; / &quot;authorised&quot; list. I&#x27;m sure this could be made more sophisticated by using groups etc I guess - though I haven&#x27;t investigated it further as yet. In fact, I suspect Microsoft may have something even more sophisticated still available for use which I&#x27;m unaware of - if anyone knows a simple explanation of this then please do let me know! In closing, I do think Microsoft could work on providing more helpful error messages than &quot;the server has rejected the client credentials&quot;. Going by what I read as I researched this error many people seem to have struggled much as I did before eventually bailing out and ended up chancing it by turning security off in their applications. Clearly it is not desirable to have people so confused by errors that they give up and settle for a less secure solution.</p></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/client-credential-type">clientCredentialType</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/security">Security</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/windows">Windows</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/wcf">WCF</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/authentication">Authentication</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/the-server-has-rejected-the-client-credentials">the server has rejected the client credentials</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/net-tcp-binding">NetTcpBinding</a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_3-lP"><a href="/blog.johnnyreilly.com/2012/02/05/potted-history-of-using-ajax-on">A Potted History of using Ajax (on the Microsoft Stack of Love)</a></h2><div class="margin-vert--md"><time datetime="2012-02-05T00:00:00.000Z" class="blogPostDate_Ta7i">February 5, 2012  路 8 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener"><img src="https://avatars.githubusercontent.com/u/1010525?s=400&amp;u=294033082cfecf8ad1645b4290e362583b33094a&amp;v=4" alt="John Reilly"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener">John Reilly</a></h4><small class="avatar__subtitle"></small></div></div></header><section class="markdown"><p>This post originally started out as an explanation of JSON. However as I wrote this quickly got abandoned in favour of writing about how I came to use JSON in the first place - which was through the use of Ajax. Having written a goodly amount I&#x27;ve now decided to move the actual JSON stuff into another post since I think Ajax is probably worth thinking about by itself rather than as an aside. So let me start at the beginning and explain how I came to use Ajax in the first place (this may take some time so please bear with me). In late 2004 I first started working on a project which I was to remain involved with (on and off) for a very long time indeed. The project was part financial reporting system and part sales incentivisation tool; it was used internally in the investment bank in which I was working. The project had been in existence for a number of years and had a web front end which at that point would been built in a combination of HTML, JavaScript, classic ASP and with a Visual Basic 6.0 back end. One of the reasons I had been brought on to the project was to help &quot;.Net-ify&quot; the thing and migrate it to ASP.NET and C#. I digress. The interesting thing about this app was that there were actually some quite advanced things being done with it (despite the classic ASP / VB). The users could enter trades into the system which represented actual trades that had been entered into a trading system elsewhere in the organisation. These trades would be assigned a reporting value which would be based on their various attributes. (Stay with me people this will get more interesting I *<strong>promise</strong>*.) The calculation of the reporting value was quite an in depth process and needed to be performed server-side. However, the users had decreed that it wasn&#x27;t acceptable to do a full postback to the server to perform this calculation; they wanted it done &quot;on-the-fly&quot;. Now if you asked me at the time I&#x27;d have said &quot;can&#x27;t be done&quot;. Fortunately the other people working on the project then weren&#x27;t nearly so defeatist. Instead they went away and found Microsoft&#x27;s <a href="http://msdn.microsoft.com/en-us/library/ie/ms531033%28v=vs.85%29.aspx" target="_blank" rel="noopener noreferrer">webservice.htc</a> library. For those of you that don&#x27;t know this was a JavaScript library that Microsoft came up with to enable the access of Web Services on the client. Given that it was designed to work with IE 5 I suspect it was created between 1999-2001 (but I&#x27;m not certain about that). Now it came as a revelation to me but this was a JavaScript library that talked to our web services through the medium of XML. In short it was my first encounter with anything remotely <a href="http://en.wikipedia.org/wiki/Ajax_(programming)" target="_blank" rel="noopener noreferrer">Ajax</a>-y. It was exciting! However, the possibilities of what we could do didn&#x27;t actually become apparent to me for some years. It&#x27;s worth saying that the way we were using webservice.htc was exceedingly simplistic and rather than investigating further I took the limited ways we were using it as indications of the limitations of Ajax and / or webservice.htc. So for a long time I thought the following: - The only way to pass multiple arguments to a web service was to package up arguments into a single string with delimiters which you could <a href="http://en.wikipedia.org/wiki/Comparison_of_programming_languages_(string_functions)#split" target="_blank" rel="noopener noreferrer">split</a> and unpackage as your first step on the server.</p><ul><li>The only valid return type was a single string. And so if you wanted to return a number of numeric values (as we did) the only way to do this was to package up return values into a very long string with delimiters in and (you guessed it!) <a href="http://en.wikipedia.org/wiki/Comparison_of_programming_languages_(string_functions)#split" target="_blank" rel="noopener noreferrer">split</a> and unpackage as your first step on the client.</li><li>The only thing that you could (or would want to) send back and forth between client and server was XML</li></ul><p> So to recap, I&#x27;m now aware that it&#x27;s possible for JavaScript to interact with the server through the use of web services. It&#x27;s possible, but ugly, not that quick and requires an awful lot of manual serialization / deserialization operations. It&#x27;s clearly powerful but not much fun at all. And that&#x27;s where I left it for a number of years. Let&#x27;s fade to black... It&#x27;s now 2007 and Microsoft have released ASP.NET Ajax, the details of which are well explained in this <a href="http://msdn.microsoft.com/en-us/magazine/cc163499.aspx" target="_blank" rel="noopener noreferrer">article</a> (which I have only recently discovered). Now I&#x27;m always interested in &quot;the new&quot; and so I was naturally interested in this. Just to be completely upfront about this I should confess that when I first discovered ASP.NET Ajax I didn&#x27;t clock the power of it at all. Initially I just switched over from using webservice.htc to ASP.NET Ajax. This alone gave us a *<strong>massive</strong>* performance improvement (I know it was massive since we actually received a &quot;well done&quot; email from our users which is testament to the difference it was making to their experience of the system). But we were still performing our manual serialisation / deserialisation of values on the client and the server. ie. Using Ajax was now much faster but still not too much fun. Let&#x27;s jump forward in time again to around 2010 to the point in time when I was discovering jQuery and that JavaScript wasn&#x27;t actually evil. It&#x27;s not unusual for me to play around with &quot;what if&quot; scenarios in my code, just to see what might might be possible. Sometimes I discover things. So it was with JSON. We had a web service in the system that allowed us to look up a counterparty (ie a bank account) with an identifier. Once we looked it up we packaged up the counterparty details (eg name, location etc) into a big long string with delimiters and sent it back to client. One day I decided to change the return type on the web service from a string to the actual counterparty class. So we went from something like this: ```cs
[WebService(Namespace = &quot;http://tempuri.org/&quot;)][WebServiceBinding(ConformsTo = WsiProfiles.BasicProfile1_1)]
[ScriptService]
public class CounterpartyWebService : System.Web.Services.WebService
{
[WebMethod]
public string GetCounterparty(string parameters)
{
string[] aParameters = parameters.Split(&quot;|&quot;);
int counterpartyId = int.Parse(aParameters[0]);
bool includeLocation = (aParameters[1] == &quot;1&quot;);
Counterparty counterparty = _counterpartyDb
.GetCounterparty(counterpartyId);</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">string returnValue = counterparty.Id + </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                   &quot;|&quot; + counterparty.Name + </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                   (includeLocation</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                     ? &quot;|&quot; + counterparty.Location </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                     : &quot;&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">return returnValue;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>  }
}</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">To something like this: ```cs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[WebMethod]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">public Counterparty GetCounterparty(string parameters)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  string[] aParameters = parameters.Split(&quot;|&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  int counterpartyId = int.Parse(aParameters[0]);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  bool includeLocation = (aParameters[1] == &quot;1&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  Counterparty counterparty = _counterpartyDb</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .GetCounterparty(counterpartyId);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  return counterparty;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>I genuinely expected that this was just going to break. It didn&#x27;t. Suddenly on the client I&#x27;m sat there with a full blown object that looks just like the object I had on the server. <strong>WHAT BLACK MAGIC COULD THIS BE??????????</strong> Certain that I&#x27;d discovered witchcraft I decided to try something else. What would happen if I changed the signature on the method so it received individual parameters and passed my individual parameters to the web service instead of packaging them up into a string? I tried this: ```cs
[WebMethod]
public Counterparty GetCounterparty(int counterpartyId,
bool includeLocation)
{
Counterparty counterparty = _counterpartyDb
.GetCounterparty(counterpartyId);</p><p>  return counterparty;
}</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">And it worked! **[IT WORKED!!!!!!!!!!!!!!!!!!!!!](&lt;http://www.youtube.com/watch?v=N_dWpCy8rdc&amp;feature=related&gt;)** (And yes I know I wasn&#x27;t actually using the includeLocation parameter - but the point was it was being passed to the server and I could have used it if I&#x27;d wanted to.) I couldn&#x27;t believe it. For **years** I&#x27;d been using Ajax and without **any** idea of the power available to me. The ignorance! The stupidity of the man! To my complete surprise it turned out that: - Ajax could be quick! ASP.NET Ajax was lightening fast when compared to webservice.htc</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">- You could send multiple arguments to a web service without all that packaging nonsense</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">- You could return complex objects without the need for packaging it all up yourself.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">&lt;!-- --&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> Essentially the source of all this goodness was the magic of JSON. I wouldn&#x27;t really come to comprehend this until I moved away from using the ASP.NET Ajax client libraries in favour of using the [jQuery.ajax](&lt;http://api.jquery.com/jQuery.ajax/&gt;) functionality. (Yes, having mostly rattled on about using webservice.htc and ASP.NET Ajax I should clarify that I have now forsaken both for jQuery as I find it more powerful and more configurable - but it&#x27;s the journey that counts I guess!) It&#x27;s abysmal that I didn&#x27;t discover the power of Ajax sooner but the difference this discovery made to me was immense. Approaches that I would have dismissed or shied away from previously because of the amount of &quot;plumbing&quot; involved now became easy. This massively contributed to my [programmer joy](&lt;http://www.hanselman.com/blog/HanselminutesPodcast260NETAPIDesignThatOptimizesForProgrammerJoyWithJonathanCarter.aspx&gt;)! Next time I promise I&#x27;ll aim to actually get onto JSON.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/ajax">ajax</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/jquery">jquery</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/webservice-htc">webservice.htc</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/json">json</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/microsoft">microsoft</a></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog.johnnyreilly.com/page/20"><div class="pagination-nav__label">芦 Newer Entries</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog.johnnyreilly.com/page/22"><div class="pagination-nav__label">Older Entries 禄</div></a></div></nav></main></div></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright 漏 2021 John Reilly. Built with Docusaurus.</div></div></div></footer></div>
<script src="/blog.johnnyreilly.com/styles.e251ffc4.js"></script>
<script src="/blog.johnnyreilly.com/runtime~main.17090397.js"></script>
<script src="/blog.johnnyreilly.com/main.76845b2c.js"></script>
<script src="/blog.johnnyreilly.com/1.32932134.js"></script>
<script src="/blog.johnnyreilly.com/2.7bb643e8.js"></script>
<script src="/blog.johnnyreilly.com/a6aa9e1f.f671cbae.js"></script>
<script src="/blog.johnnyreilly.com/c3b5bd8c.b09f7905.js"></script>
<script src="/blog.johnnyreilly.com/f209798b.0798303e.js"></script>
<script src="/blog.johnnyreilly.com/b2a2b18d.c900939d.js"></script>
<script src="/blog.johnnyreilly.com/0f249913.34304420.js"></script>
<script src="/blog.johnnyreilly.com/6266f07f.48f048ad.js"></script>
<script src="/blog.johnnyreilly.com/5932a0c0.810a8439.js"></script>
<script src="/blog.johnnyreilly.com/66936bf1.18428041.js"></script>
<script src="/blog.johnnyreilly.com/de994f05.7d3e0b0b.js"></script>
<script src="/blog.johnnyreilly.com/40f92029.bce93221.js"></script>
<script src="/blog.johnnyreilly.com/a9eac268.1ed7108e.js"></script>
<script src="/blog.johnnyreilly.com/f67d924e.cadd3f7a.js"></script>
<script src="/blog.johnnyreilly.com/4778bfa1.4d3ded6f.js"></script>
</body>
</html>