<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="I CAN MAKE THIS WORK Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="I CAN MAKE THIS WORK Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-51754530-2","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><title data-react-helmet="true">Blog | I CAN MAKE THIS WORK</title><meta data-react-helmet="true" property="og:title" content="Blog | I CAN MAKE THIS WORK"><meta data-react-helmet="true" name="description" content="Blog"><meta data-react-helmet="true" property="og:description" content="Blog"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link rel="stylesheet" href="/styles.a30a8c8e.css">
<link rel="preload" href="/styles.9c2995a9.js" as="script">
<link rel="preload" href="/runtime~main.e2b992e5.js" as="script">
<link rel="preload" href="/main.015a56c2.js" as="script">
<link rel="preload" href="/1.9d1369a3.js" as="script">
<link rel="preload" href="/2.3dd236d5.js" as="script">
<link rel="preload" href="/a6aa9e1f.6c8d1a94.js" as="script">
<link rel="preload" href="/c3b5bd8c.0459a1fb.js" as="script">
<link rel="preload" href="/b2a2b18d.49511c67.js" as="script">
<link rel="preload" href="/d2760453.13537e23.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/"><img src="/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">I CAN MAKE THIS WORK</strong></a></div><div class="navbar__items navbar__items--right"><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">I CAN MAKE THIS WORK</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"></ul></div></div></div></nav><div class="main-wrapper blog-wrapper"><div class="container margin-vert--lg"><div class="row"><div class="col col--2"><div class="sidebar_SWld thin-scrollbar"><h3 class="sidebarItemTitle_Km2m">Recent posts</h3><ul class="sidebarItemList_3UpA"><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/2021/03/10/managed-identity-azure-sql-entity-framework">Managed Identity, Azure SQL and Entity Framework</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/2021/03/06/generate-typescript-and-csharp-clients-with-nswag">Generate TypeScript and CSharp clients with NSwag based on an API</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/2021/02/27/goodbye-client-affinity-hello-data-protection-with-azure">Goodbye Client Affinity, Hello Data Protection with Azure</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/2021/02/16/easy-auth-tokens-survive-releases-on-linux-azure-app-service">Making Easy Auth tokens survive releases on Linux Azure App Service</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/2021/02/11/azure-app-service-health-checks-and-zero-downtime-deployments">Azure App Service, Health checks and zero downtime deployments</a></li></ul></div></div><main class="col col--8"><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_3-lP"><a href="/2012/04/16/simple-technique-for-initialising">A Simple Technique for Initialising Properties with Internal Setters for Unit Testing</a></h2><div class="margin-vert--md"><time datetime="2012-04-16T00:00:00.000Z" class="blogPostDate_Ta7i">April 16, 2012  Â· 6 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener"><img src="https://avatars.githubusercontent.com/u/1010525?s=400&amp;u=294033082cfecf8ad1645b4290e362583b33094a&amp;v=4" alt="John Reilly"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener">John Reilly</a></h4><small class="avatar__subtitle"></small></div></div></header><section class="markdown"><p>I was recently working with my colleagues on refactoring a legacy application. We didn&#x27;t have an immense amount of time available for this but the plan was to try and improve what was there as much as possible. In its initial state the application had no unit tests in place at all and so the plan was to refactor the code base in such a way as to make testing it a realistic proposition. To that end the <a href="http://en.wikipedia.org/wiki/Domain_layer" target="_blank" rel="noopener noreferrer">domain layer</a> was being heavily adjusted and the GUI was being migrated from WebForms to MVC 3. The intention was to build up a pretty solid collection of unit tests. However, as we were working on this we realised we had a problem with properties on our models with <a href="http://msdn.microsoft.com/en-us/library/7c5ka91b(v=vs.80).aspx" target="_blank" rel="noopener noreferrer"><code>internal</code></a> setters...</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="background"></a>Background<a class="hash-link" href="#background" title="Direct link to heading">#</a></h2><p>The entities of the project in question used an approach which would store pertinent bits of <a href="http://en.wikipedia.org/wiki/Database_normalization" target="_blank" rel="noopener noreferrer">normalised</a> data for read-only purposes in related entities. I&#x27;ve re-read that sentence and realise it&#x27;s as clear as mud. Here is an example to clarify:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cs codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">public class Person</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  public int Id { get; set; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  public string FirstName { get; set; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  public string LastName { get; set; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  public string Address { get; set; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  public DateTime DateOfBirth { get; set; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  /* Other fascinating properties... */</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">public class Order</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  public int Id { get; set; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  public string ProductOrdered { get; set; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  public string OrderedById { get; set; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  public string OrderedByFirstName { get; internal set; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  public string OrderedByLastName { get; internal set; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>In the example above you have 2 types of entity: <code>Person</code> and <code>Order</code>. The <code>Order</code> entity makes use of the the <code>Id</code>, <code>FirstName</code> and <code>LastName</code> properties of the <code>Person</code> entity in the properties <code>OrderedById</code>, <code>OrderedByFirstName</code> and <code>OrderedByLastName</code>. For persistence (ie saving to the database) purposes the only necessary <code>Person</code> property is <code>OrderedById</code> identity. <code>OrderedByFirstName</code> and <code>OrderedByLastName</code> are just &quot;nice to haves&quot; - essentially present to make implementing the GUI more straightforward.</p><p>To express this behaviour / intention in the object model the setters for <code>OrderedByFirstName</code> and <code>OrderedByLastName</code> are marked as <code>internal</code>. The implication of this is that properties like this can only be initialised within the current assembly - or any explicitly associated &quot;friend&quot; assemblies. In practice this meant that internally set properties were only populated when an object was read in from the database. It wasn&#x27;t possible to set these properties in other assemblies which meant less code was written (<u>a good thing</u></p><p>) - after all, why set a property when you don&#x27;t need to?</p><p>Background explanation over. It may still be a little unclear but I hope you get the gist.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="whats-our-problem"></a>What&#x27;s our problem?<a class="hash-link" href="#whats-our-problem" title="Direct link to heading">#</a></h2><p>I was writing unit tests for the controllers in our main web application and was having problems with my arrangements. I was mocking the database calls in my controllers much in the manner that you might expect:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-ts codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Arrange</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token keyword" style="font-style:italic">var</span><span class="token plain"> orderDb </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name maybe-class-name" style="color:rgb(255, 203, 107)">Mock</span><span class="token class-name operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token class-name maybe-class-name" style="color:rgb(255, 203, 107)">IOrderDb</span><span class="token class-name operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  orderDb</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access maybe-class-name" style="color:rgb(130, 170, 255)">Setup</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">x </span><span class="token arrow operator" style="color:rgb(137, 221, 255)">=&gt;</span><span class="token plain"> x</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access maybe-class-name" style="color:rgb(130, 170, 255)">GetOrder</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token maybe-class-name">It</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token generic-function function" style="color:rgb(130, 170, 255)">IsAny</span><span class="token generic-function generic class-name operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token generic-function generic class-name" style="color:rgb(255, 203, 107)">int</span><span class="token generic-function generic class-name operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access maybe-class-name" style="color:rgb(130, 170, 255)">Returns</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">new</span><span class="token plain"> </span><span class="token class-name maybe-class-name" style="color:rgb(255, 203, 107)">Order</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token maybe-class-name">Id</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">123</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token maybe-class-name">ProductOrdered</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Packet of coffee&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token maybe-class-name">OrderedById</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">987456</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token maybe-class-name">OrderedByFirstName</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;John&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      </span><span class="token maybe-class-name">OrderedByLastName</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Reilly&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>All looks fine doesn&#x27;t it? It&#x27;s not. Because <code>OrderedByFirstName</code> and <code>OrderedByLastName</code> have internal setters we are <u>unable</u></p><p> to initialise them from within the context of our test project. So what to do?</p><p>We toyed with 3 approaches and since each has merits I thought it worth going through each of them:</p><ol><li><p>To the MOQumentation Batman!: <a href="http://code.google.com/p/moq/wiki/QuickStart" target="_blank" rel="noopener noreferrer">http://code.google.com/p/moq/wiki/QuickStart</a>! Looking at the MOQ documentation it states the following:</p><p><em>Mocking internal types of another project: add the following assembly attributes (typically to the AssemblyInfo.cs) to the project containing the internal types:</em></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cs codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">// This assembly is the default dynamic assembly generated Castle DynamicProxy, </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// used by Moq. Paste in a single line.</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[assembly:InternalsVisibleTo(&quot;DynamicProxyGenAssembly2,PublicKey=0024000004800000940000000602000000240000525341310004000001000100c547cac37abd99c8db225ef2f6c8a3602f3b3606cc9891605d02baa56104f4cfc0734aa39b93bf7852f7d9266654753cc297e7d2edfe0bac1cdcf9f717241550e0a7b191195b7667bb4f64bcb8e2121380fd1d9d46ad2d92d2d15605093924cceaf74c4861eff62abf69b9291ed0a340e113be11e6a7d3113e92484cf7045cc7&quot;)]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">[assembly: InternalsVisibleTo(&quot;The.NameSpace.Of.Your.Unit.Test&quot;)] //I&#x27;d hope it was shorter than that...</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>This looked to be exactly what we needed and in most situations it would make sense to go with this. Unfortunately for us there was a gotcha. Certain core shared parts of our application platform were <a href="http://en.wikipedia.org/wiki/Global_Assembly_Cache" target="_blank" rel="noopener noreferrer">GAC</a>&#x27;d. A requirement for GAC-ing an assembly is that it is <a href="http://msdn.microsoft.com/en-us/library/xc31ft41.aspx" target="_blank" rel="noopener noreferrer">signed</a>.</p><p>The upshot of this was that if we wanted to use the <code>InternalsVisibleTo</code> approach then we would need to sign our web application test project. We weren&#x27;t particularly averse to that and initially did so without much thought. It was then we remembered that every assembly referenced by a signed assembly must also be signed as well. We didn&#x27;t really want to sign our main web application purely for testing purposes. We could and if there weren&#x27;t viable alternatives we well might have. But it just seemed like the wrong reason to be taking that decision. Like using a sledgehammer to crack a nut.</p></li><li><p>The next approach we took was using mock objects. Instead of using our objects straight we would mock them as below:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cs codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">//Create mock and set internal properties</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      var orderMock = new Mock&lt;Order&gt;();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      orderMock.SetupGet(x =&gt; x.OrderedByFirstName).Returns(&quot;John&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      orderMock.SetupGet(x =&gt; x.OrderedByLastName).Returns(&quot;Reilly&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      //Set up standard properties</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      orderMock.SetupAllProperties();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      var orderStub = orderMock.Object;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      orderStub.Id = 123;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      orderStub.ProductOrdered = &quot;Packet of coffee&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      orderStub.OrderedById = 987456;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Now this approach worked fine but had a couple of snags:</p><ul><li><p>As you can see it&#x27;s pretty verbose and much less clear to read than it was previously.</p></li><li><p>It required that we add the <code>virtual</code> keyword to all our internally set properties like so: </p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cs codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">public class Order</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  // ....</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  public virtual string OrderedByFirstName { get; internal set; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  public virtual string OrderedByLastName { get; internal set; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">  // ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div></li><li><p>Our standard constructor already initialised the value of our internally set properties. So adding <code>virtual</code> to the internally set properties generated <a href="http://www.jetbrains.com/resharper/" target="_blank" rel="noopener noreferrer">ReSharper</a> warnings aplenty about virtual properties being initialised in the constructor. Fair enough.</p></li></ul><p>Because of the snags it still felt like we were in nutcracking territory...</p></li><li><p>... and this took us to the approach that we ended up adopting: a special mocking constructor for each class we wanted to test, for example: ```cs
/// </p><summary>
/// Mocking constructor used to initialise internal properties
/// </summary>
public Order(string orderedByFirstName = null, string orderedByLastName = null)
: this()
{
OrderedByFirstName = orderedByFirstName;
OrderedByLastName = orderedByLastName;
}<p></p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-undefined codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">Thanks to the ever lovely [Named and Optional Arguments](&lt;http://msdn.microsoft.com/en-us/library/dd264739.aspx&gt;) feature of C# combined with [Object Initializers](&lt;http://msdn.microsoft.com/en-us/library/bb397680.aspx&gt;) it meant it was possible to write quite expressive, succinct code using this approach; for example:</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">```cs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">var order = new Order(</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        orderedByFirstName: &quot;John&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        orderedByLastName: &quot;Reilly&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      )</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        Id = 123,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        ProductOrdered = &quot;Packet of coffee&quot;,</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        OrderedById = 987456</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">      };</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Here we&#x27;re calling the mocking constructor to set the internally set properties and subsequently initialising the other properties using the object initialiser mechanism.</p><p>Implementing these custom constructors wasn&#x27;t a massive piece of work and so we ended up settling on this technique for initialising internal properties.</p></li></ol></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/tags/unit-testing">unit testing</a><a class="margin-horiz--sm" href="/tags/internals-visible-to">InternalsVisibleTo</a><a class="margin-horiz--sm" href="/tags/moq">MOQ</a><a class="margin-horiz--sm" href="/tags/mocking">mocking</a></div></footer></article><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/page/202"><div class="pagination-nav__label">Â« Newer Entries</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/page/204"><div class="pagination-nav__label">Older Entries Â»</div></a></div></nav></main></div></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 John Reilly. Built with Docusaurus.</div></div></div></footer></div>
<script src="/styles.9c2995a9.js"></script>
<script src="/runtime~main.e2b992e5.js"></script>
<script src="/main.015a56c2.js"></script>
<script src="/1.9d1369a3.js"></script>
<script src="/2.3dd236d5.js"></script>
<script src="/a6aa9e1f.6c8d1a94.js"></script>
<script src="/c3b5bd8c.0459a1fb.js"></script>
<script src="/b2a2b18d.49511c67.js"></script>
<script src="/d2760453.13537e23.js"></script>
</body>
</html>