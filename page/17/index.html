<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog.johnnyreilly.com/rss.xml" title="I CAN MAKE THIS WORK Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog.johnnyreilly.com/atom.xml" title="I CAN MAKE THIS WORK Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-51754530-2","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script><title data-react-helmet="true">Blog | I CAN MAKE THIS WORK</title><meta data-react-helmet="true" property="og:title" content="Blog | I CAN MAKE THIS WORK"><meta data-react-helmet="true" name="description" content="Blog"><meta data-react-helmet="true" property="og:description" content="Blog"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><link data-react-helmet="true" rel="shortcut icon" href="/blog.johnnyreilly.com/img/favicon.ico"><link rel="stylesheet" href="/blog.johnnyreilly.com/styles.a30a8c8e.css">
<link rel="preload" href="/blog.johnnyreilly.com/styles.b80bbee1.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/runtime~main.94d0c56d.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/main.08f1a502.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/1.b4966bec.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/2.7d3f6764.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/a6aa9e1f.88297f1e.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/c3b5bd8c.4d75ffb7.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/91f96256.e23882b2.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/5a727dac.ed4e0df0.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/00d73702.ddf62eef.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/f6213bbd.3e96180f.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/867e7696.198c6174.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/8f5729b9.e9aa869a.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/9957bc3e.0e0e78fa.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/6496ed56.54be6eea.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/d6e44df4.a898d0e3.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/ebd64336.241d0737.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/e3e5222a.9bb0b6b7.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/blog.johnnyreilly.com/"><img src="/blog.johnnyreilly.com/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/blog.johnnyreilly.com/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">I CAN MAKE THIS WORK</strong></a></div><div class="navbar__items navbar__items--right"><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/blog.johnnyreilly.com/"><img src="/blog.johnnyreilly.com/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/blog.johnnyreilly.com/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">I CAN MAKE THIS WORK</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"></ul></div></div></div></nav><div class="main-wrapper blog-wrapper"><div class="container margin-vert--lg"><div class="row"><div class="col col--2"><div class="sidebar_SWld thin-scrollbar"><h3 class="sidebarItemTitle_Km2m">Recent posts</h3><ul class="sidebarItemList_3UpA"><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog.johnnyreilly.com/2021/03/10/managed-identity-azure-sql-entity-framework">Managed Identity, Azure SQL and Entity Framework</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog.johnnyreilly.com/2021/03/06/generate-typescript-and-csharp-clients-with-nswag">Generate TypeScript and CSharp clients with NSwag based on an API</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog.johnnyreilly.com/2021/02/27/goodbye-client-affinity-hello-data-protection-with-azure">Goodbye Client Affinity, Hello Data Protection with Azure</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog.johnnyreilly.com/2021/02/16/easy-auth-tokens-survive-releases-on-linux-azure-app-service">Making Easy Auth tokens survive releases on Linux Azure App Service</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog.johnnyreilly.com/2021/02/11/azure-app-service-health-checks-and-zero-downtime-deployments">Azure App Service, Health checks and zero downtime deployments</a></li></ul></div></div><main class="col col--8"><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_3-lP"><a href="/blog.johnnyreilly.com/2014/01/24/integration-testing-with-entity">Integration Testing with Entity Framework and Snapshot Backups</a></h2><div class="margin-vert--md"><time datetime="2014-01-24T00:00:00.000Z" class="blogPostDate_Ta7i">January 24, 2014  Â· 15 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener"><img src="https://avatars.githubusercontent.com/u/1010525?s=400&amp;u=294033082cfecf8ad1645b4290e362583b33094a&amp;v=4" alt="John Reilly"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener">John Reilly</a></h4><small class="avatar__subtitle"></small></div></div></header><section class="markdown"><p>I&#x27;ve written before about how unit testing <a href="http://icanmakethiswork.blogspot.co.uk/2012/10/unit-testing-and-entity-framework-filth.html" target="_blank" rel="noopener noreferrer">Entity Framework is a contentious and sometimes pointless activity</a>. The TL;DR is that LINQ-to-Objects != Linq-to-Entities and so if you want some useful tests around your data tier then integration tests that actually hit a database are what you want.</p><p> However hitting an actual database is has serious implications. For a start you need a database server and you need a database. But the real issue lies around cleanup. When you write a test that amends data in the database you need the test to clean up after itself. If it doesn&#x27;t then the next test that runs may trip over the amended data and that&#x27;s your test pack instantly useless.</p><p>What you want is a way to wipe the slate clean - to return the database back to the state that it was in before your test ran. Kind of like a database restore - except that would be slow. And this is where <a href="http://technet.microsoft.com/en-us/library/ms189548(v=sql.105).aspx" target="_blank" rel="noopener noreferrer">SQL Server&#x27;s snapshot backups</a> have got your back. To quote MSDN:</p><blockquote><p>*Snapshot backups have the following primary benefits:</p><ul><li>A backup can be created quickly, typically measured in seconds, with little or no effect on the server.</li><li>A restore operation can be accomplished from a disk backup just as quickly.</li><li>Backup to tape can be accomplished by another host without an effect on the production system.</li><li><strong>A copy of a production database can be created instantly for reporting or testing.</strong></li></ul><ul><li></li></ul></blockquote><p>Just the ticket.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="our-mission"></a>Our Mission<a class="hash-link" href="#our-mission" title="Direct link to heading">#</a></h2><p>In this post I want to go through the process of taking an existing database, pointing Entity Framework at it, setting up some repositories and then creating an integration test pack that uses snapshot backups to cleanup after each test runs. The code detailed in this post is available in this <a href="https://github.com/johnnyreilly/SnapshotBackupsIntegrationTesting" target="_blank" rel="noopener noreferrer">GitHub repo</a> if you want to have a go yourself.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="we-need-a-database"></a>We need a database<a class="hash-link" href="#we-need-a-database" title="Direct link to heading">#</a></h2><p>You can find a whole assortment of databases <a href="https://msftdbprodsamples.codeplex.com/releases" target="_blank" rel="noopener noreferrer">here</a>. I&#x27;m going to use <a href="https://msftdbprodsamples.codeplex.com/wikipage?title=AWLTDocs" target="_blank" rel="noopener noreferrer">AdventureWorksLT</a> as it&#x27;s small and simple. So I&#x27;ll download <a href="https://msftdbprodsamples.codeplex.com/downloads/get/478217" target="_blank" rel="noopener noreferrer">this</a> and unzip it. I&#x27;ll drop <code>AdventureWorksLT2008R2_Data.mdf</code> and <code>AdventureWorksLT2008R2_log.LDF</code> in my data folder and attach AdventureWorksLT2008R2 to my database server. And now I have a database:</p><p><a href="http://1.bp.blogspot.com/-Nke8F6wYI4A/UuEeJ6C0XqI/AAAAAAAAAgg/tbuhu2TuOpg/s1600/Database2.png" target="_blank" rel="noopener noreferrer"><img src="http://1.bp.blogspot.com/-Nke8F6wYI4A/UuEeJ6C0XqI/AAAAAAAAAgg/tbuhu2TuOpg/s320/Database2.png" alt="null"></a>## Assemble me your finest DbContext</p><p>Or in English: we want to point Entity Framework at our new shiny database. So let&#x27;s fire up Visual Studio (I&#x27;m using 2013) and create a new solution called &quot;AdventureWorks&quot;.</p><p>To our solution let&#x27;s add a new class library project called &quot;AdventureWorks.EntityFramework&quot;. And to that we&#x27;ll add an ADO.NET Entity Data Model which we&#x27;ll call &quot;AdventureWorks.edmx&quot;. When the wizard fires up we&#x27;ll use the &quot;Generate from database&quot; option, click Next and select &quot;New Connection&quot;. In the dialog we&#x27;ll select our newly attached AdventureWorksLT2008R2 database. We&#x27;ll leave the &quot;save entity connection settings in App.Config&quot; option selected and click Next. I&#x27;m going to use Entity Framework 6.0 - though I think that any version would do. I&#x27;m going to pull in all tables / store procs and views. And now Entity Framework is pointing at my database:</p><p><a href="http://3.bp.blogspot.com/-Sv_GPsqilao/UuElIcLCYaI/AAAAAAAAAgw/7ui-xpml8dk/s1600/EDMX.png" target="_blank" rel="noopener noreferrer"><img src="http://3.bp.blogspot.com/-Sv_GPsqilao/UuElIcLCYaI/AAAAAAAAAgw/7ui-xpml8dk/s400/EDMX.png" alt="null"></a>## Let There be Repositories!</p><p>In the name of testability let&#x27;s create a new project to house repositories called &quot;AdventureWorks.Repositories&quot;. I&#x27;m going to use <a href="http://odetocode.com/about/scott-allen" target="_blank" rel="noopener noreferrer">K. Scott Allen</a>&#x27;s fine <a href="http://msdn.microsoft.com/en-us/library/ff714955.aspx" target="_blank" rel="noopener noreferrer">article on MSDN</a> to create a very basic set of repositories wrapped in a unit of work.</p><p>In my new project I&#x27;ll add a reference to the <code>AdventureWorks.EntityFramework</code> project and create a new <code>IRepository</code> interface that looks like this:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cs codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">using System;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">using System.Linq;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">using System.Linq.Expressions;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">namespace AdventureWorks.Repositories</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public interface IRepository&lt;T&gt; where T : class</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        IQueryable&lt;T&gt; FindAll();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        IQueryable&lt;T&gt; FindWhere(Expression&lt;Func&lt;T, bool&gt;&gt; predicate);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        T Add(T newEntity);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        T Remove(T entity);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>And a new <code>IUnitOfWork</code> interface that looks like this:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cs codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">using AdventureWorks.EntityFramework;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">namespace AdventureWorks.Repositories</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public interface IUnitOfWork</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        public IRepository&lt;ErrorLog&gt; ErrorLogs { get; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        public IRepository&lt;Address&gt; Addresses { get; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        public IRepository&lt;Customer&gt; Customers { get; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        public IRepository&lt;CustomerAddress&gt; CustomerAddresses { get; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        public IRepository&lt;Product&gt; Products { get; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        public IRepository&lt;ProductCategory&gt; ProductCategories { get; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        public IRepository&lt;ProductDescription&gt; ProductDescriptions { get; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        public IRepository&lt;ProductModel&gt; ProductModels { get; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        public IRepository&lt;ProductModelProductDescription&gt; ProductModelProductDescriptions { get; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        public IRepository&lt;SalesOrderDetail&gt; SalesOrderDetails { get; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        public IRepository&lt;SalesOrderHeader&gt; SalesOrderHeaders { get; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        public IRepository&lt;BuildVersion&gt; BuildVersions { get; }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        void Commit();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Now for the implementation of <code>IRepository</code>. For this we&#x27;ll need a reference to Entity Framework in our project. Then we&#x27;ll create a class called <code>SqlRepository</code>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cs codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">using System;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">using System.Data.Entity;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">using System.Linq;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">using System.Linq.Expressions;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">namespace AdventureWorks.Repositories</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public class SqlRepository&lt;T&gt; : IRepository&lt;T&gt; where T : class</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        public SqlRepository(DbContext context)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            _dbSet = context.Set&lt;T&gt;();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        public IQueryable&lt;T&gt; FindAll()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            return _dbSet;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        public IQueryable&lt;T&gt; FindWhere(Expression&lt;Func&lt;T, bool&gt;&gt; predicate)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            return _dbSet.Where(predicate);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        public T Add(T newEntity)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            return _dbSet.Add(newEntity);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        public T Remove(T entity)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            return _dbSet.Remove(entity);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        protected DbSet&lt;T&gt; _dbSet;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>And we also need the implementation of <code>IUnitOfWork</code>. So we&#x27;ll create a class called <code>SqlUnitOfWork</code>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cs codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">using System;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">using System.Linq;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">using System.Data.Entity;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">using AdventureWorks.EntityFramework;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">namespace AdventureWorks.Repositories</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public class SqlUnitOfWork : IUnitOfWork</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        public SqlUnitOfWork()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            _context = new AdventureWorksLT2008R2Entities();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        public IRepository&lt;ErrorLog&gt; ErrorLogs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            get</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                if (_errorLogs == null) _errorLogs = new SqlRepository&lt;ErrorLog&gt;(_context);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                return _errorLogs;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        public IRepository&lt;Address&gt; Addresses</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            get</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                if (_addresses == null) _addresses = new SqlRepository&lt;Address&gt;(_context);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                return _addresses;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        public IRepository&lt;Customer&gt; Customers</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            get</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                if (_customers == null) _customers = new SqlRepository&lt;Customer&gt;(_context);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                return _customers;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        public IRepository&lt;CustomerAddress&gt; CustomerAddresses</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            get</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                if (_customerAddresses == null) _customerAddresses = new SqlRepository&lt;CustomerAddress&gt;(_context);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                return _customerAddresses;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        public IRepository&lt;Product&gt; Products</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            get</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                if (_products == null) _products = new SqlRepository&lt;Product&gt;(_context);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                return _products;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        public IRepository&lt;ProductCategory&gt; ProductCategories</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            get</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                if (_productCategories == null) _productCategories = new SqlRepository&lt;ProductCategory&gt;(_context);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                return _productCategories;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        public IRepository&lt;ProductDescription&gt; ProductDescriptions</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            get</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                if (_productDescriptions == null) _productDescriptions = new SqlRepository&lt;ProductDescription&gt;(_context);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                return _productDescriptions;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        public IRepository&lt;ProductModel&gt; ProductModels</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            get</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                if (_productModels == null) _productModels = new SqlRepository&lt;ProductModel&gt;(_context);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                return _productModels;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        public IRepository&lt;ProductModelProductDescription&gt; ProductModelProductDescriptions</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            get</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                if (_productModelProductDescriptions == null) _productModelProductDescriptions = new SqlRepository&lt;ProductModelProductDescription&gt;(_context);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                return _productModelProductDescriptions;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        public IRepository&lt;SalesOrderDetail&gt; SalesOrderDetails</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            get</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                if (_salesOrderDetails == null) _salesOrderDetails = new SqlRepository&lt;SalesOrderDetail&gt;(_context);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                return _salesOrderDetails;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        public IRepository&lt;SalesOrderHeader&gt; SalesOrderHeaders</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            get</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                if (_salesOrderHeaders == null) _salesOrderHeaders = new SqlRepository&lt;SalesOrderHeader&gt;(_context);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                return _salesOrderHeaders;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        public IRepository&lt;BuildVersion&gt; BuildVersions</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            get</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                if (_buildVersions == null) _buildVersions = new SqlRepository&lt;BuildVersion&gt;(_context);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                return _buildVersions;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        public void Commit()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            _context.SaveChanges();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        SqlRepository&lt;ErrorLog&gt; _errorLogs = null;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        SqlRepository&lt;Address&gt; _addresses = null;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        SqlRepository&lt;Customer&gt; _customers = null;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        SqlRepository&lt;CustomerAddress&gt; _customerAddresses = null;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        SqlRepository&lt;Product&gt; _products = null;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        SqlRepository&lt;ProductCategory&gt; _productCategories = null;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        SqlRepository&lt;ProductDescription&gt; _productDescriptions = null;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        SqlRepository&lt;ProductModel&gt; _productModels = null;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        SqlRepository&lt;ProductModelProductDescription&gt; _productModelProductDescriptions = null;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        SqlRepository&lt;SalesOrderDetail&gt; _salesOrderDetails = null;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        SqlRepository&lt;SalesOrderHeader&gt; _salesOrderHeaders = null;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        SqlRepository&lt;BuildVersion&gt; _buildVersions = null;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        readonly DbContext _context;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="and-now-lets-start-integration-testing"></a>And Now Let&#x27;s Start Integration Testing!<a class="hash-link" href="#and-now-lets-start-integration-testing" title="Direct link to heading">#</a></h2><p>Let&#x27;s create a new Unit Test project called &quot;AdventureWorks.Repositories.IntegrationTests&quot;. (And just to be clear: this is *not* a unit test project - it is an <strong><em>integration</em></strong> test project.) We&#x27;ll add a reference back to our <code>AdventureWorks.Repositories</code> project for the repositories and one back to <code>AdventureWorks.EntityFramework</code> for our domain models. And finally you&#x27;ll need a reference to Entity Framework in your IntegrationTest project as well as well.</p><p>We&#x27;ll copy across the <code>app.config</code> from <code>AdventureWorks.EntityFramework</code> to <code>AdventureWorks.Repositories.IntegrationTests</code> as it contains the database connection details. It&#x27;ll look something like this:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-xml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token prolog">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">configuration</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">configSections</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">section</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">name</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">entityFramework</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">type</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">System.Data.Entity.Internal.ConfigFile.EntityFrameworkSection, EntityFramework, Version=6.0.0.0, Culture=neutral, PublicKeyToken=b77a5c561934e089</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">requirePermission</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">false</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">&lt;!-- For more information on Entity Framework configuration, visit http://go.microsoft.com/fwlink/?LinkID=237468 --&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">configSections</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">connectionStrings</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">add</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">name</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">AdventureWorksLT2008R2Entities</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">             </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">connectionString</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">metadata=res://*/AdventureWorks.csdl|res://*/AdventureWorks.ssdl|res://*/AdventureWorks.msl;provider=System.Data.SqlClient;provider connection string=</span><span class="token tag attr-value entity named-entity" style="color:rgb(255, 85, 114)">&amp;quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">data source=.;initial catalog=AdventureWorksLT2008R2;integrated security=True;MultipleActiveResultSets=True;App=EntityFramework</span><span class="token tag attr-value entity named-entity" style="color:rgb(255, 85, 114)">&amp;quot;</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">             </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">providerName</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">System.Data.EntityClient</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">connectionStrings</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">entityFramework</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">defaultConnectionFactory</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">type</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">System.Data.Entity.Infrastructure.SqlConnectionFactory, EntityFramework</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">providers</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">provider</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">invariantName</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">System.Data.SqlClient</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">type</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">System.Data.Entity.SqlServer.SqlProviderServices, EntityFramework.SqlServer</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">providers</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">entityFramework</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">configuration</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Now we&#x27;re ready for a test. We&#x27;ll add ourselves a class called <code>BuildVersionTests</code>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cs codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">using System;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">using System.Linq;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">using System.Linq.Expressions;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">using Microsoft.VisualStudio.TestTools.UnitTesting;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">namespace AdventureWorks.Repositories.IntegrationTests</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    [TestClass]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public class BuildVersionTests</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        [TestMethod]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        public void BuildVersions_should_return_the_correct_version_information()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            // Arrange</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            var uow = new SqlUnitOfWork();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            // Act</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            var buildVersions = uow.BuildVersions.FindAll().ToList();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            // Assert</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            Assert.AreEqual(1, buildVersions.Count);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            Assert.AreEqual(&quot;10.00.80404.00&quot;, buildVersions[0].Database_Version);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            Assert.AreEqual(new DateTime(2008, 4, 4), buildVersions[0].ModifiedDate);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            Assert.AreEqual(1, buildVersions[0].SystemInformationID);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            Assert.AreEqual(new DateTime(2008, 4, 4), buildVersions[0].VersionDate);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>This is as simple as it gets - our test creates a new unit of work and queries the <code>BuildVersions</code> table to see what we can see. All it&#x27;s really doing is demonstrating that we can now hit our database through our repositories. As a side note, we could have the exact same test operating directly on the <code>DbContext</code> like this:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cs codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">[TestMethod]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        public void DbContext_BuildVersions_should_return_the_correct_version_information()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            // Arrange</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            var dbContext = new AdventureWorks.EntityFramework.AdventureWorksLT2008R2Entities();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            // Act</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            var buildVersions = dbContext.BuildVersions.ToList();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            // Assert</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            Assert.AreEqual(1, buildVersions.Count);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            Assert.AreEqual(&quot;10.00.80404.00&quot;, buildVersions[0].Database_Version);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            Assert.AreEqual(new DateTime(2008, 4, 4), buildVersions[0].ModifiedDate);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            Assert.AreEqual(1, buildVersions[0].SystemInformationID);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            Assert.AreEqual(new DateTime(2008, 4, 4), buildVersions[0].VersionDate);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>For the most part we won&#x27;t be doing this but I wanted to be clear that full power of Entity Framework is available to you as you&#x27;re putting together your integration tests.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="database-snapshotting-time"></a>Database Snapshotting Time<a class="hash-link" href="#database-snapshotting-time" title="Direct link to heading">#</a></h2><p>Up until this point we&#x27;ve essentially been laying our infrastructure and doing our plumbing. We now have a database, domain models and data access courtesy of Entity Framework, a testable repository layer and finally an integration test pack. What we want now is to get our database snapshot / backup and restore mechanism set up and integrated into the test pack.</p><p>Let&#x27;s add references to the <code>System.Data</code> and <code>System.Configuration</code> assemblies to our integration testing project and then add a new class called <code>DatabaseSnapshot</code>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cs codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">using System.Configuration;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">using System.Data;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">using System.Data.SqlClient;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">namespace AdventureWorks.Repositories.IntegrationTests</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public static class DatabaseSnapshot</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        private const string SpCreateSnapShotName = &quot;SnapshotBackup_Create&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        private const string SpCreateSnapShot =</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">@&quot;CREATE PROCEDURE [dbo].[&quot; + SpCreateSnapShotName + @&quot;]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    @databaseName        varchar(512),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    @databaseLogicalName varchar(512),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    @snapshotBackupPath  varchar(512),</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    @snapshotBackupName  varchar(512)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">AS</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">BEGIN</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    SET NOCOUNT ON;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    DECLARE @sql varchar(500)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    SELECT @sql = &#x27;CREATE DATABASE &#x27; + @snapshotBackupName +</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                  &#x27; ON (NAME=[&#x27; + @databaseLogicalName +</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                  &#x27;], FILENAME=&#x27;&#x27;&#x27; + @snapshotBackupPath + @snapshotBackupName + </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                  &#x27;&#x27;&#x27;) AS SNAPSHOT OF [&#x27; + @databaseName + &#x27;]&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    EXEC(@sql)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">END&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        private const string SpRestoreSnapShotName = &quot;SnapshotBackup_Restore&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        private const string SpRestoreSnapShot =</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">@&quot;CREATE PROCEDURE [dbo].[&quot; + SpRestoreSnapShotName + @&quot;]    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    @databaseName varchar(512),    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    @snapshotBackupName varchar(512)    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">AS    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">BEGIN    </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    SET NOCOUNT ON;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    DECLARE @sql varchar(500)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    SET @sql  = &#x27;ALTER DATABASE [&#x27; + @databaseName + &#x27;] SET SINGLE_USER WITH ROLLBACK IMMEDIATE&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    EXEC (@sql)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    RESTORE DATABASE @databaseName</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    FROM DATABASE_SNAPSHOT = @snapshotBackupName</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    SET @sql = &#x27;ALTER DATABASE [&#x27; + @databaseName + &#x27;] SET MULTI_USER&#x27;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    EXEC (@sql)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">END&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        private const string SpDeleteSnapShotName = &quot;SnapshotBackup_Delete&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        private const string SpDeleteSnapShot =</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">@&quot;CREATE PROCEDURE [dbo].[&quot; + SpDeleteSnapShotName + @&quot;]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    @snapshotBackupName varchar(512)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">AS</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">BEGIN</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    SET NOCOUNT ON;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    DECLARE @sql varchar(500)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    SELECT @sql = &#x27;DROP DATABASE &#x27; + @snapshotBackupName </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    EXEC(@sql) </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">END&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        private static string _masterDbConnectionString;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        private static string _dbName;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        private static ConnectionStringSettings _dbConnectionStringSettings;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        private static ConnectionStringSettings DbConnectionStringSettings</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            get</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                if (_dbConnectionStringSettings == null)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    _dbConnectionStringSettings = ConfigurationManager.ConnectionStrings[&quot;SnapshotBackup&quot;];</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                return _dbConnectionStringSettings;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        /// &lt;summary&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        /// Stored procedures should be executed against master database</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        /// &lt;/summary&gt;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        private static string MasterDbConnectionString</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            get</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                if (string.IsNullOrEmpty(_masterDbConnectionString))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    var sqlConnection = new SqlConnection(DbConnectionStringSettings.ConnectionString);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    _masterDbConnectionString = DbConnectionStringSettings.ConnectionString.Replace(sqlConnection.Database, &quot;master&quot;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                return _masterDbConnectionString;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        private static string DbName</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            get</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                if (string.IsNullOrEmpty(_dbName))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    _dbName = new SqlConnection(DbConnectionStringSettings.ConnectionString).Database.TrimStart(&#x27;[&#x27;).TrimEnd(&#x27;]&#x27;);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                return _dbName;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        public static void SetupStoredProcedures()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            using (var conn = new SqlConnection(MasterDbConnectionString))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                conn.Open();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                // Drop the existing stored procedures</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                SqlCommand cmd;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                const string dropProcSql = &quot;IF EXISTS (SELECT * FROM sys.objects WHERE object_id = OBJECT_ID(N&#x27;[dbo].[{0}]&#x27;) AND type in (N&#x27;P&#x27;, N&#x27;PC&#x27;)) DROP PROCEDURE [dbo].[{0}]&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                foreach (var spName in new[] { SpCreateSnapShotName, SpDeleteSnapShotName, SpRestoreSnapShotName })</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    cmd = new SqlCommand(string.Format(dropProcSql, spName), conn);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    cmd.ExecuteNonQuery();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                // Create the stored procedures anew</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                foreach (var createProcSql in new[] { SpCreateSnapShot, SpDeleteSnapShot, SpRestoreSnapShot })</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    cmd = new SqlCommand(createProcSql, conn);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                    cmd.ExecuteNonQuery();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                conn.Close();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        public static void CreateSnapShot()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            var databaseName = new SqlParameter { ParameterName = &quot;@databaseName&quot;, SqlValue = SqlDbType.VarChar, Value = DbName };</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            var databaseLogicalName = new SqlParameter { ParameterName = &quot;@databaseLogicalName&quot;, SqlValue = SqlDbType.VarChar, Value = ConfigurationManager.AppSettings[&quot;DatabaseLogicalName&quot;] };</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            var snapshotBackupPath = new SqlParameter { ParameterName = &quot;@snapshotBackupPath&quot;, SqlValue = SqlDbType.VarChar, Value = ConfigurationManager.AppSettings[&quot;SnapshotBackupPath&quot;] };</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            var snapshotBackupName = new SqlParameter { ParameterName = &quot;@snapshotBackupName&quot;, SqlValue = SqlDbType.VarChar, Value = ConfigurationManager.AppSettings[&quot;SnapshotBackupName&quot;] };</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            ExecuteStoredProcAgainstMaster(SpCreateSnapShotName, new[] { databaseName, databaseLogicalName, snapshotBackupPath, snapshotBackupName });</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        public static void DeleteSnapShot()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            var snapshotBackupName = new SqlParameter { ParameterName = &quot;@snapshotBackupName&quot;, SqlValue = SqlDbType.VarChar, Value = ConfigurationManager.AppSettings[&quot;SnapshotBackupName&quot;] };</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            ExecuteStoredProcAgainstMaster(SpDeleteSnapShotName, new[] { snapshotBackupName });</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        public static void RestoreSnapShot()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            var databaseName = new SqlParameter { ParameterName = &quot;@databaseName&quot;, SqlValue = SqlDbType.VarChar, Value = DbName };</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            var snapshotBackupName = new SqlParameter { ParameterName = &quot;@snapshotBackupName&quot;, SqlValue = SqlDbType.VarChar, Value = ConfigurationManager.AppSettings[&quot;SnapshotBackupName&quot;] };</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            ExecuteStoredProcAgainstMaster(SpRestoreSnapShotName, new[] { databaseName, snapshotBackupName });</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        private static void ExecuteStoredProcAgainstMaster(string storedProc, SqlParameter[] parameters)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            using (var conn = new SqlConnection(MasterDbConnectionString))</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                conn.Open();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                var cmd = new SqlCommand(storedProc, conn) { CommandType = CommandType.StoredProcedure };</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                cmd.Parameters.AddRange(parameters);</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                cmd.ExecuteNonQuery();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                conn.Close();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The <code>DatabaseSnapshot</code> class exposes 4 methods:</p><dl><dt>SetupStoredProcedures</dt><dd>This method creates 3 stored procedures on the master database: <code>SnapshotBackup_Create</code>, <code>SnapshotBackup_Restore</code> and <code>SnapshotBackup_Delete</code>. These procs do pretty much what their names suggest and the other 3 methods call these stored procedures when creating, restoring and deleting snapshot backups respectively. You can see the (fairly minimal) SQL for these stored procs at the top of the<code>DatabaseSnapshot</code> class.</dd><dt>CreateSnapShot</dt><dd>This method creates a snapshot backup of the database at this point in time.</dd><dt>RestoreSnapShot</dt><dd>This method restores the database back to state it was in when the snapshot backup was created.</dd><dt>DeleteSnapShot</dt><dd>This method attempts to delete the existing snapshot backup.</dd></dl><p>In order that we can use the <code>DatabaseSnapshot</code> class we need to add the following entries to our <code>app.config</code>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-xml codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">configuration</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">connectionStrings</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">add</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">name</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">SnapshotBackup</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token tag" style="color:rgb(255, 85, 114)">             </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">connectionString</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">data source=.;initial catalog=AdventureWorksLT2008R2;Trusted_Connection=true;Connection Timeout=200</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">connectionStrings</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">appSettings</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">add</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">key</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">DatabaseLogicalName</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">value</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">AdventureWorksLT2008_Data</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">add</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">key</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">SnapshotBackupPath</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">value</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">C:\DbSnapshots\</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">add</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">key</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">SnapshotBackupName</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">value</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">AdventureWorksLT2008R2_Snapshot</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">/&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">appSettings</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">configuration</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>These settings allow have the following purposes:</p><dl><dt>SnapshotBackup</dt><dd>A connection string that allows <code>DatabaseSnapshot</code> to connect to the database.</dd><dt>DatabaseLogicalName</dt><dd>The logical name of the database you want to backup. (This can be found on the Files tab of the Database Properties in SSMS)</dd><dt>SnapshotBackupPath</dt><dd>The location where the snapshot backup is to be stored. You need to make sure that this exists on your machine.</dd><dt>SnapshotBackupName</dt><dd>The name of the snapshot backup that will be created.</dd></dl><p>Now to make use of <code>DatabaseSnapshot</code>. Let&#x27;s add a new class called <code>SetUpTearDown</code>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cs codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">using Microsoft.VisualStudio.TestTools.UnitTesting;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">namespace AdventureWorks.Repositories.IntegrationTests</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    [TestClass]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public static class SetUpTearDown</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        [AssemblyInitialize]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        public static void TestRunInitialize(TestContext context)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            try</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                // Try to delete the snapshot in case it was left over from aborted test runs</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                DatabaseSnapshot.DeleteSnapShot();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            catch { /* this should fail with snapshot does not exist */ }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            DatabaseSnapshot.SetupStoredProcedures();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            DatabaseSnapshot.CreateSnapShot();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        [AssemblyCleanup]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        public static void TestRunCleanup()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            DatabaseSnapshot.DeleteSnapShot();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>At the start of the test run this will create a snapshot in case one doesn&#x27;t exist already. And at the end of the test run it will be a good citizen and delete the snapshot. We&#x27;ll also add an extra method to our <code>BuildVersionTests</code> class:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cs codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">namespace AdventureWorks.Repositories.IntegrationTests</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    [TestClass]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public class BuildVersionTests</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        // ... </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        [TestCleanup]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        public void TestCleanup()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            DatabaseSnapshot.RestoreSnapShot();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>This will ensure that after each test runs the database will be restored back to the snapshot created in <code>SetUpTearDown</code>. Now if you re-run your tests, in between each test the restore back to the snapshot is taking place.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="prove-it"></a>Prove it!<a class="hash-link" href="#prove-it" title="Direct link to heading">#</a></h2><p>Of course the tests we have in place at present don&#x27;t actually change the data at all. So I could be lying. I&#x27;m not. Let&#x27;s prove it by adding one more class called <code>CustomerTests</code>:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cs codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">using System;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">using System.Linq;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">using System.Linq.Expressions;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">using Microsoft.VisualStudio.TestTools.UnitTesting;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">using AdventureWorks.EntityFramework;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">namespace AdventureWorks.Repositories.IntegrationTests</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    [TestClass]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    public class CustomerTests</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        [TestMethod]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        public void Should_change_a_customers_first_and_last_name()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            // Arrange</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            var uow = new SqlUnitOfWork();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            // Act</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            var customer = uow.Customers.FindWhere(x =&gt; x.FirstName == &quot;Jay&quot; &amp;&amp; x.LastName == &quot;Adams&quot;).First();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            var customerId = customer.CustomerID;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            customer.FirstName = &quot;John&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            customer.LastName = &quot;Reilly&quot;;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            uow.Commit();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            // Assert</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            Assert.IsNotNull(uow.Customers.FindWhere(x =&gt; x.FirstName == &quot;John&quot; &amp;&amp; x.LastName == &quot;Reilly&quot; &amp;&amp; x.CustomerID == customerId).SingleOrDefault());</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        [TestCleanup]</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        public void TestCleanup()</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            DatabaseSnapshot.RestoreSnapShot();</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    }</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>The above test checks that you can look up an existing customer, Mr Jay Adams, and change his name to my name - to John Reilly. If I execute the test above and there was no restore in place then subsequently when I came to exercise this test it should start to fail as it no longer has a Mr Jay Adams to lookup. But with this restore mechanism in place I can execute this test repeatedly without worrying.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="rounding-off"></a>Rounding off<a class="hash-link" href="#rounding-off" title="Direct link to heading">#</a></h2><p>And that&#x27;s us finished - we now have a database snapshot restore mechanism in place. With this we can develop integration tests that thoroughly change the data in our database secure in the knowledge that once the test is complete our database will be restored back to it&#x27;s initial state.</p><p>Obviously there are other alternative approaches for integration testing available to that which I&#x27;ve laid out in this post. But I can imagine that this approach is very useful for applying to legacy applications that you might inherit and need to continue supporting. Also, this approach should fit in well with a continuous integration setup. It would be pretty straightforward to have database that existed purely for testing purposes against which all the integration tests could be set to run at the point of each check in.</p><p>Thanks to Marc Talary, Sandeep Deo and Tishul Vadher who all contributed to <code>DatabaseSnapshot</code>. Credit is also due to Google due to the hundreds of articles the team ended up reading on snapshot backups.</p></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/database-snapshot-backups">Database Snapshot Backups</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/integration-testing">Integration Testing</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/sql-server">SQL Server</a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_3-lP"><a href="/blog.johnnyreilly.com/2014/01/09/upgrading-to-typescript-095-personal">Upgrading to TypeScript 0.9.5 - A Personal Memoir</a></h2><div class="margin-vert--md"><time datetime="2014-01-09T00:00:00.000Z" class="blogPostDate_Ta7i">January 9, 2014  Â· 8 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener"><img src="https://avatars.githubusercontent.com/u/1010525?s=400&amp;u=294033082cfecf8ad1645b4290e362583b33094a&amp;v=4" alt="John Reilly"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener">John Reilly</a></h4><small class="avatar__subtitle"></small></div></div></header><section class="markdown"><p>I recently made the step to upgrade from TypeScript 0.9.1.1 to 0.9.5. To my surprise this process was rather painful and certainly not an unalloyed pleasure. Since I&#x27;m now on the other side, so to speak, I thought I&#x27;d share my experience and cast back a rope bridge to those about to journey over the abyss.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="tldr"></a>TL;DR<a class="hash-link" href="#tldr" title="Direct link to heading">#</a></h2><p>TypeScript 0.9.5 is worth making the jump to. However, if you are using Visual Studio (as I would guess many are) then you should be aware of a number of problems with the TypeScript Visual Studio tooling for TS 0.9.5. These problems can be worked around if you follow the instructions in this post.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="upgrading-the-plugin"></a>Upgrading the Plugin<a class="hash-link" href="#upgrading-the-plugin" title="Direct link to heading">#</a></h2><p>At home I upgraded the moment TS 0.9.5 was released. This allowed me to help with migrating the <a href="https://github.com/borisyankov/DefinitelyTyped" target="_blank" rel="noopener noreferrer">Definitely Typed typings</a> over from 0.9.1.1. And allowed me to give TS 0.9.5 a little test drive. However, I deliberately held off performing the upgrade at work until I knew that all the Definitely Typed typings had been upgraded. This was completed <a href="https://github.com/borisyankov/DefinitelyTyped/pull/1385" target="_blank" rel="noopener noreferrer">by the end of 2013</a>. So in the new year it seemed a good time to make the move.</p><p>If, like me, you are using TypeScript inside Visual Studio then you&#x27;d imagine it&#x27;s as simple as closing down VS, uninstalling TypeScript 0.9.1.1 from Programs and Features and then installing the <a href="http://www.typescriptlang.org/#Download" target="_blank" rel="noopener noreferrer">new plugin</a>. And it is if you are running IE 10 or IE 11 on your Windows machine. If you are running a lower IE version then there is a problem.</p><p>Regrettably, the TypeScript 0.9.5 plugin installer has a dependency on IE 10. Fortunately TypeScript itself has no dependency on IE 10 at all (and why would it?). This dependency appears to have been a mistake. I <a href="https://typescript.codeplex.com/workitem/1975" target="_blank" rel="noopener noreferrer">raised it as an issue</a> and the TS team have said that this will be resolved in the next major release.</p><p>Happily there is a workaround if you&#x27;re running IE 9 or lower which has been noted in the <a href="http://blogs.msdn.com/b/typescript/archive/2013/12/05/announcing-typescript-0-9-5.aspx" target="_blank" rel="noopener noreferrer">comments underneath the TS 0.9.5 release blog post</a>. All you do is set the <code>HKEY_LOCAL_MACHINE\SOFTWARE\Wow6432Node\Microsoft\Internet Explorer\svcVersion</code> registry key value to <code>10.0.9200.16384</code> for the duration of the install.</p><p>First hurdle jumped, the upgrade continues simple enough. Then the fun starts...</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="declaration-merging-is-dead-sort-of"></a>Declaration Merging is dead... Sort of<a class="hash-link" href="#declaration-merging-is-dead-sort-of" title="Direct link to heading">#</a></h2><p>Having upgraded my plugin I opened up the project I&#x27;m working on in Visual Studio. I used NuGet to upgrade all the Definitely Typed packages to the latest (TS 0.9.5) versions. Then I tried, and failed, to compile. It was the the most obscure error I&#x27;ve seen in a while:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-ts codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token constant" style="color:rgb(130, 170, 255)">VSTSC</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> tsc</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">js</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">37574</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">25</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token maybe-class-name">Microsoft</span><span class="token plain"> </span><span class="token maybe-class-name">JScript</span><span class="token plain"> runtime error </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token maybe-class-name">Unable</span><span class="token plain"> to </span><span class="token keyword" style="font-style:italic">get</span><span class="token plain"> value </span><span class="token keyword" style="font-style:italic">of</span><span class="token plain"> the property </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;wrapsSomeTypeParameter&#x27;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> object </span><span class="token keyword" style="font-style:italic">is</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">null</span><span class="token plain"> or </span><span class="token keyword" style="font-style:italic">undefined</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>As you can see there was no indication where in my code the problem was being caused. Fortunately someone had already suffered this particular problem and logged an issue <a href="https://typescript.codeplex.com/workitem/1995" target="_blank" rel="noopener noreferrer">here</a>. Digging through the comments I found a common theme; everyone experiencing the problem was using the <a href="https://github.com/borisyankov/DefinitelyTyped/blob/master/q/Q.d.ts" target="_blank" rel="noopener noreferrer">Q typings</a>. So what&#x27;s up with that?</p><p>Strangely, if you directly referenced the Q typings everything was okay - which is how the Definitely Typed tests came to pass in the first place. But if you wanted to make use of these typings with implicit referencing (in Visual Studio since TS 0.9.1, all TypeScript files in a project are considered to be referencing each other) - well it doesn&#x27;t work.</p><p>I decided to take a look at the Q typings at this point to see what was so upsetting about them. The one thing that was obvious was that these typings make use of <a href="http://blogs.msdn.com/b/typescript/archive/2013/06/18/announcing-typescript-0-9.aspx" target="_blank" rel="noopener noreferrer">Declaration Merging</a>. And this made them slightly different to most of the other typing libraries that I was using. So I decided to refactor the Q typings to use the more interface driven approach the other typing libraries used in the hope that might resolve the issue.</p><p>Roughly speaking I went from:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-ts codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">Q</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token constant" style="color:rgb(130, 170, 255)">T</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">promise</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">Q</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access maybe-class-name">IPromise</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token constant" style="color:rgb(130, 170, 255)">T</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">Q</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token known-class-name class-name" style="color:rgb(255, 203, 107)">Promise</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token constant" style="color:rgb(130, 170, 255)">T</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">Q</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token constant" style="color:rgb(130, 170, 255)">T</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">promise</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token maybe-class-name">JQueryPromise</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token constant" style="color:rgb(130, 170, 255)">T</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">Q</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token known-class-name class-name" style="color:rgb(255, 203, 107)">Promise</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token constant" style="color:rgb(130, 170, 255)">T</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">Q</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token constant" style="color:rgb(130, 170, 255)">T</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">value</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">T</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">Q</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token known-class-name class-name" style="color:rgb(255, 203, 107)">Promise</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token constant" style="color:rgb(130, 170, 255)">T</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">module</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">Q</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//â€¦ functions etc in here</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">module</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;q&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">export</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">Q</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>To:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-ts codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">interface</span><span class="token plain"> </span><span class="token class-name maybe-class-name" style="color:rgb(255, 203, 107)">QIPromise</span><span class="token class-name operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token class-name constant" style="color:rgb(130, 170, 255)">T</span><span class="token class-name operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//â€¦ functions etc in here</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">interface</span><span class="token plain"> </span><span class="token class-name maybe-class-name" style="color:rgb(255, 203, 107)">QDeferred</span><span class="token class-name operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token class-name constant" style="color:rgb(130, 170, 255)">T</span><span class="token class-name operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//â€¦ functions etc in here</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">interface</span><span class="token plain"> </span><span class="token class-name maybe-class-name" style="color:rgb(255, 203, 107)">QPromise</span><span class="token class-name operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token class-name constant" style="color:rgb(130, 170, 255)">T</span><span class="token class-name operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//â€¦ functions etc in here</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">interface</span><span class="token plain"> </span><span class="token class-name maybe-class-name" style="color:rgb(255, 203, 107)">QPromiseState</span><span class="token class-name operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token class-name constant" style="color:rgb(130, 170, 255)">T</span><span class="token class-name operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//â€¦ functions etc in here</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">interface</span><span class="token plain"> </span><span class="token class-name maybe-class-name" style="color:rgb(255, 203, 107)">QStatic</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">t</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">promise</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token maybe-class-name">QIPromise</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token constant" style="color:rgb(130, 170, 255)">T</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token maybe-class-name">QPromise</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token constant" style="color:rgb(130, 170, 255)">T</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">t</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">promise</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token maybe-class-name">JQueryPromise</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token constant" style="color:rgb(130, 170, 255)">T</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token maybe-class-name">QPromise</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token constant" style="color:rgb(130, 170, 255)">T</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token plain">t</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">value</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">T</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token maybe-class-name">QPromise</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token constant" style="color:rgb(130, 170, 255)">T</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//â€¦ other functions etc continue here</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"> </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">module</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;q&quot;</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">export</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">Q</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">declare</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">var</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">Q</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token maybe-class-name">QStatic</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">t</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">t</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span><span class="token operator" style="color:rgb(137, 221, 255)">&lt;</span><span class="token operator" style="color:rgb(137, 221, 255)">/</span><span class="token plain">t</span><span class="token operator" style="color:rgb(137, 221, 255)">&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>And that fixed the obscure &#x27;wrapsSomeTypeParameter&#x27; error. The full source code of these amended typings can be found as a GitHub Repo <a href="https://github.com/johnnyreilly/Q-TS-0.9.5-WorkAround" target="_blank" rel="noopener noreferrer">here</a> in case you want to use it yourself. (I did originally consider adding this to Definitely Typed but opted not to in the end - <a href="https://github.com/borisyankov/DefinitelyTyped/pull/1497" target="_blank" rel="noopener noreferrer">see discussion on GitHub</a>.)</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="the-promised-land"></a>The Promised Land<a class="hash-link" href="#the-promised-land" title="Direct link to heading">#</a></h2><p>You&#x27;re there. You&#x27;ve upgraded to the new plugin and the new typings. All is compiling as it should and the language service is working as well. Was it worth it? I think yes, for the following reasons:</p><ol><li>TS 0.9.5 compiles faster, and hogs less memory. </li><li>When we compiled with TS 0.9.5 we found there were a couple of bugs in our codebase which the tightened up compiler was now detecting. Essentially where we&#x27;d assumed types were flowing through to functions there were a couple of occasions with TS 0.9.1.1 where they weren&#x27;t. Where we&#x27;d assumed we had a type of <code>T</code> available in a function whereas it was actually a type of <code>any</code>. I was really surprised that this was the case since we were already making use of <code>noImplicitAny</code> compiler flag in our project. So where a type had changed and a retired property was being referenced TS 0.9.5 picked up an error that TS 0.9.1.1 had not. Good catch! </li><li>And finally (and I know these are really minor), the compiled JS is a little different now. Firstly, the compiled JS features all of TypeScript comments in the positions that you might hope for. Previously it seemed that about 75% came along for the ride and ended up in some strange locations sometimes. Secondly, enums are treated differently during compilation now - where it makes sense the actual backing value of an enum is used rather than going through the JavaScript construct. So it&#x27;s a bit like a <code>const</code> I guess - presumably this allows JavaScript engines to optimise a little more.</li></ol><p>I hope I haven&#x27;t put you off with this post. I think TypeScript 0.9.5 is well worth making the leap for - and hopefully by reading this you&#x27;ll have saved yourself from a few of the rough edges.</p></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/q">Q</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/type-script">TypeScript</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/0-9-1-1">0.9.1.1</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/0-9-5">0.9.5</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/upgrading">upgrading</a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_3-lP"><a href="/blog.johnnyreilly.com/2013/12/13/nuget-and-webmatrix-how-to-install">NuGet and WebMatrix: How to install a specific version of a package</a></h2><div class="margin-vert--md"><time datetime="2013-12-13T00:00:00.000Z" class="blogPostDate_Ta7i">December 13, 2013  Â· 3 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener"><img src="https://avatars.githubusercontent.com/u/1010525?s=400&amp;u=294033082cfecf8ad1645b4290e362583b33094a&amp;v=4" alt="John Reilly"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener">John Reilly</a></h4><small class="avatar__subtitle"></small></div></div></header><section class="markdown"><p>I&#x27;ve recently been experimenting with WebMatrix. If you haven&#x27;t heard of it, WebMatrix is Microsoft&#x27;s <em><a href="http://www.microsoft.com/web/webmatrix/" target="_blank" rel="noopener noreferrer">&quot;free, lightweight, cloud-connected web development tool&quot;</a></em>. All marketing aside, it&#x27;s pretty cool. You can whip up a site in next to no time, it has source control, publishing abilities, intellisense. Much good stuff. And one thing it has, that I genuinely hadn&#x27;t expected is <a href="https://www.nuget.org/" target="_blank" rel="noopener noreferrer">NuGet</a>. Brilliant!</p><p> But like any free product there are disadvantages. As a long time Visual Studio user I&#x27;ve become very used to the power of the NuGet command line. I&#x27;ve been spoiled. You don&#x27;t have this in WebMatrix. You have a nice UI that looks like this:</p><p><img src="http://2.bp.blogspot.com/-MLAAVw9-O_A/UqstzAa1-8I/AAAAAAAAAfU/gtg8kPjsP7M/s400/NuGetWebMatrix.png"></p><p>Looks great right? However, if you want to install a specific version of a NuGet package... well let&#x27;s see what happens...</p><p>As you&#x27;re probably aware jQuery currently exists in 2 branches; the 1.10.x branch which supports IE 6-8 and the 2.0.x branch which doesn&#x27;t. However there is only 1 jQuery inside NuGet. Let&#x27;s click on install and see if we can select a specific version:</p><p><img src="http://4.bp.blogspot.com/-Phqw0WYN0BM/UqswJPr7X1I/AAAAAAAAAfg/4lpkwUG5p5w/s400/NuGetWebMatrixjQuery.png"></p><p>Hmmm.... As you can see it&#x27;s 2.0.3 or bust. We can&#x27;t select a specific version; we&#x27;re forced to go with the latest and greatest which is a problem if you need to support IE 6-8. So the obvious strategy if you&#x27;re in this particular camp is to forego NuGet entirely. Go old school. And we could. But let&#x27;s say we want to keep using NuGet, mindful that a little while down the road we&#x27;ll be ready to do that upgrade. Can it be done? Let&#x27;s find out.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="nuget-by-hook-or-by-crook"></a>NuGet, by hook or by crook<a class="hash-link" href="#nuget-by-hook-or-by-crook" title="Direct link to heading">#</a></h2><p>I&#x27;ve created a new site in WebMatrix using the Empty Site template. Looks like this:</p><p><img src="http://4.bp.blogspot.com/-yDf_KCHWImA/Uqs8Csn8UWI/AAAAAAAAAfs/cmnj5ddqDCk/s400/EmptySite.png"></p><p>Lovely.</p><p>Now to get me some jQuery 1.10.2 goodness. To the console Batman! We&#x27;ve already got the NuGet command line installed (if you haven&#x27;t you could get it from <a href="http://nuget.org/nuget.exe" target="_blank" rel="noopener noreferrer">here</a>) and so we follow these steps:</p><ul><li>At the <code>C:\</code> prompt we enter <code>nuget install jQuery -Version 1.10.2</code> and down comes jQuery 1.10.2.</li><li>We move <code>C:\jQuery.1.10.2</code> to <code>C:\Users\me\Documents\My Web Sites\Empty Site\App_Data\packages\jQuery.1.10.2</code>.</li><li>Then we delete the <code>C:\Users\me\Documents\My Web Sites\Empty Site\App_Data\packages\jQuery.1.10.2\Tools</code> subfolder.</li><li>We move <code>C:\Users\me\Documents\My Web Sites\Empty Site\App_Data\packages\jQuery.1.10.2\Content\Scripts</code> to <code>C:\Users\me\Documents\My Web Sites\Empty Site\Scripts</code>.</li><li>And finally we delete the <code>C:\Users\me\Documents\My Web Sites\Empty Site\App_Data\packages\jQuery.1.10.2\Content</code> folder.</li></ul><p>We hit refresh back in WebMatrix and now we get this:</p><p><img src="http://4.bp.blogspot.com/-EAfCq2zjNl4/UqtAvAW35PI/AAAAAAAAAf4/u97kbdXWO84/s400/EmptySiteWithjQuery.png"></p><p>If we go to NuGet and select updates you&#x27;ll see that jQuery is now considered &quot;installed&quot; and an update is available. So, in short, our plan worked - yay!</p><p><img src="http://3.bp.blogspot.com/-3-pJuMZVJPo/UqtBiuBNdyI/AAAAAAAAAgE/GA_4difKXdQ/s320/NuGetWebMatrixjQueryUpgrade.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="now-for-bonus-points"></a>Now for bonus points<a class="hash-link" href="#now-for-bonus-points" title="Direct link to heading">#</a></h2><p>Just to prove that you can upgrade using the WebMatrix tooling following our manual install let&#x27;s do it. Click &quot;Update&quot;, then &quot;Yes&quot; and finally &quot;I Accept&quot; to the EULA. You&#x27;ll now see we&#x27;re now on jQuery 2.0.3:</p><p><img src="http://4.bp.blogspot.com/-6tLukWlzBfg/UqtE_Ni4FaI/AAAAAAAAAgM/AUxszwXhlGo/s400/NuGetWebMatrixjQueryUpgraded.png"></p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="rounding-off"></a>Rounding off<a class="hash-link" href="#rounding-off" title="Direct link to heading">#</a></h2><p>In my example I&#x27;m only looking at a simple JavaScript library. But the same principal should be able to be applied to any NuGet package as far as I&#x27;m aware. Hope that helps!</p></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/jquery">jquery</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/package">package</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/web-matrix">WebMatrix</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/nu-get">NuGet</a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_3-lP"><a href="/blog.johnnyreilly.com/2013/12/04/simple-fading-in-and-out-using-css-transitions">Simple fading in and out using CSS transitions and classes</a></h2><div class="margin-vert--md"><time datetime="2013-12-04T00:00:00.000Z" class="blogPostDate_Ta7i">December 4, 2013  Â· 4 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener"><img src="https://avatars.githubusercontent.com/u/1010525?s=400&amp;u=294033082cfecf8ad1645b4290e362583b33094a&amp;v=4" alt="John Reilly"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener">John Reilly</a></h4><small class="avatar__subtitle"></small></div></div></header><section class="markdown"><p>Caveat emptor folks... Let me start off by putting my hands up and saying I am no expert on CSS. And furthermore let me say that this blog post is essentially the distillation of a heady session of googling on the topic of CSS transitions. The credit for the technique detailed here belongs to many others, I&#x27;m just documenting it for my own benefit (and for anyone who stumbles upon this).</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="what-do-we-want-to-do"></a>What do we want to do?<a class="hash-link" href="#what-do-we-want-to-do" title="Direct link to heading">#</a></h2><p>Most web developers have likely reached at some point for jQuery&#x27;s <a href="http://api.jquery.com/fadeIn/" target="_blank" rel="noopener noreferrer"><code>fadeIn</code></a> and <a href="http://api.jquery.com/fadeOut/" target="_blank" rel="noopener noreferrer"><code>fadeOut</code></a> awesomeness. What could be cooler than fading in or out your UI, right?</p><p>Behind the scenes of <code>fadeIn</code> and <code>fadeOut</code> JavaScript is doing an awful lot of work to create that animation. And in our modern world we simply don&#x27;t need to do that work anymore; it&#x27;s gone native and is covered by <a href="https://developer.mozilla.org/en-US/docs/Web/Guide/CSS/Using_CSS_transitions" target="_blank" rel="noopener noreferrer">CSS transitions</a>.</p><p>Added to the &quot;<a href="http://en.wikipedia.org/wiki/George_Mallory" target="_blank" rel="noopener noreferrer">because it&#x27;s there</a>&quot; reason for using CSS transitions to do fading there is a more important reason; let me quote <a href="http://www.html5rocks.com/en/tutorials/speed/html5/#toc-css3-transitions" target="_blank" rel="noopener noreferrer">HTML5 rocks</a>:</p><blockquote><p>&quot;<em>CSS Transitions make style animation trivial for everyone, but they also are a smart performance feature. Because a CSS transition is managed by the browser, the fidelity of its animation can be greatly improved, and in many cases hardware accelerated. Currently WebKit (Chrome, Safari, iOS) have hardware accelerated CSS transforms, but it&#x27;s coming quickly to other browsers and platforms.</em>&quot;</p></blockquote><p>Added to this, if you have mobile users then the usage of native functionality (as opposed to doing it manually in JavaScript) actually saves battery life.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="im-sold---lets-do-it"></a>I&#x27;m sold - let&#x27;s do it!<a class="hash-link" href="#im-sold---lets-do-it" title="Direct link to heading">#</a></h2><p>This is the CSS we&#x27;ll need:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-css codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token selector class" style="color:rgb(199, 146, 234)">.fader</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">-moz-transition</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> opacity </span><span class="token number" style="color:rgb(247, 140, 108)">0.7</span><span class="token unit">s</span><span class="token plain"> linear</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">-o-transition</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> opacity </span><span class="token number" style="color:rgb(247, 140, 108)">0.7</span><span class="token unit">s</span><span class="token plain"> linear</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">-webkit-transition</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> opacity </span><span class="token number" style="color:rgb(247, 140, 108)">0.7</span><span class="token unit">s</span><span class="token plain"> linear</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">transition</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> opacity </span><span class="token number" style="color:rgb(247, 140, 108)">0.7</span><span class="token unit">s</span><span class="token plain"> linear</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token selector class" style="color:rgb(199, 146, 234)">.fader</span><span class="token selector class" style="color:rgb(199, 146, 234)">.fadedOut</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">opacity</span><span class="token punctuation" style="color:rgb(199, 146, 234)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Note we have 2 CSS classes:</p><ul><li><code>fader</code> - if this class is applied to an element then when the opacity of that element is changed it will be an animated change. The duration of the transition and the timing function used are customisable - in this case it takes 0.7 seconds and is linear.</li><li><code>fadedOut</code> - when used in conjunction with <code>fader</code> this class creates a fading in or fading out effect as it is removed or applied respectively. (This relies upon the default value of opacity being 1.)</li></ul><p>Let&#x27;s see it in action:</p><iframe width="100%" height="200" src="http://jsfiddle.net/johnny_reilly/86amq/embedded/result,js,html,css" allowfullscreen="" frameborder="0"></iframe><p>It goes without saying that one day in the not too distant future (I hope) we&#x27;ll be able to leave behind the horrible world of vendor prefixes. Then we&#x27;ll be down to just the single <code>transition</code> statement. One day...</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="now-a-warning"></a>Now, a warning...<a class="hash-link" href="#now-a-warning" title="Direct link to heading">#</a></h2><p>Unfortunately the technique detailed above differs from <a href="http://api.jquery.com/fadeIn/" target="_blank" rel="noopener noreferrer"><code>fadeIn</code></a> and <a href="http://api.jquery.com/fadeOut/" target="_blank" rel="noopener noreferrer"><code>fadeOut</code></a> in one important way. When the <code>fadeOut</code> animation completes it sets removes the element from the flow of the DOM using <code>display: none</code>. However, display is not a property that can be animated and so you can&#x27;t include this in your CSS transition. If removing the element from the flow of the DOM is something you need then you&#x27;ll need to bear this in mind. If anyone has any suggestions for an nice way to approach this I&#x27;d love to hear from you.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="a-halfway-there-solution-to-the-display-none"></a>A halfway there solution to the <code>display: none</code><a class="hash-link" href="#a-halfway-there-solution-to-the-display-none" title="Direct link to heading">#</a></h2><p>Andrew Davey tweeted me the suggestion below:</p><blockquote><p><a href="https://twitter.com/johnny_reilly" target="_blank" rel="noopener noreferrer">@johnny_reilly</a> Yep, transitions are sweet. You could use the transitionend event to remove the element from the DOM <a href="http://t.co/Q1oWy3g8Lp" target="_blank" rel="noopener noreferrer">http://t.co/Q1oWy3g8Lp</a></p><p>â€” Andrew Davey (@andrewdavey) <a href="https://twitter.com/andrewdavey/statuses/408545283606212608" target="_blank" rel="noopener noreferrer">December 5, 2013</a></p></blockquote><script src="//platform.twitter.com/widgets.js" charset="utf-8"></script><p>So I thought I&#x27;d give it a go. However, whilst we&#x27;ve a <code>transitionend</code> event to play with we don&#x27;t have a corresponding <code>transitionstart</code> or <code>transitionbegin</code>. So I tried this:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-js codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">$</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;#showHideButton&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">click</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">function</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">var</span><span class="token plain"> $alertDiv </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">$</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;#alertDiv&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword control-flow" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">$alertDiv</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">hasClass</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;fadedOut&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        $alertDiv</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">removeClass</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;fadedOut&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">css</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;display&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword control-flow" style="font-style:italic">else</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token function" style="color:rgb(130, 170, 255)">$</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;#alertDiv&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">addClass</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;fadedOut&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">$</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token dom variable" style="color:rgb(191, 199, 213)">document</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">on</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;webkitTransitionEnd transitionend oTransitionEnd&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;.fader&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">evnt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword" style="font-style:italic">var</span><span class="token plain"> $faded </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">$</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">evnt</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">target</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token keyword control-flow" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">$faded</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">hasClass</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;fadedOut&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            $faded</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">css</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;display&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;none&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Essentially, on the <code>transitionend</code> event <code>display: none</code> is applied to the element in question. Groovy. In the absence of a <code>transitionstart</code> or <code>transitionbegin</code>, when removing the <code>fadeOut</code> class I&#x27;m first manually clearing out the <code>display: none</code>. Whilst this works in terms of adding it back into the flow of the DOM it takes away all the <code>fadeIn</code> gorgeousness. So it&#x27;s not quite the fully featured solution you might hope for. But it&#x27;s a start.</p></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/css-3">CSS 3</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/transitionend">transitionend</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/fade-in">fadeIn</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/fade-out">fadeOut</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/transitions">transitions</a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_3-lP"><a href="/blog.johnnyreilly.com/2013/11/26/rolling-your-own-confirm-mechanism">Rolling your own confirm mechanism using Promises and jQuery UI</a></h2><div class="margin-vert--md"><time datetime="2013-11-26T00:00:00.000Z" class="blogPostDate_Ta7i">November 26, 2013  Â· 5 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener"><img src="https://avatars.githubusercontent.com/u/1010525?s=400&amp;u=294033082cfecf8ad1645b4290e362583b33094a&amp;v=4" alt="John Reilly"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener">John Reilly</a></h4><small class="avatar__subtitle"></small></div></div></header><section class="markdown"><p>It is said that a picture speaks a thousand words. So here&#x27;s two:</p><p> <img src="http://4.bp.blogspot.com/-zZvqgKiP9CI/UpN7YtkFbnI/AAAAAAAAAe4/OUpA5uVpCl4/s400/Ugly.png"></p><p><img src="http://4.bp.blogspot.com/-VVzJ7B0Uhys/UpN7vnX7diI/AAAAAAAAAe8/i3hlMT1ECB8/s400/Pretty.png"></p><p>That&#x27;s right, we&#x27;re here to talk about the <a href="https://developer.mozilla.org/en-US/docs/Web/API/Window.confirm" target="_blank" rel="noopener noreferrer">confirm</a> dialog. Or, more specifically, how we can make our own confirm dialog.</p><p>JavaScript in the browser has had the <code>window.confirm</code> method for the longest time. This method takes a string as an argument and displays it in the form of a dialog, giving the user the option to click on either an &quot;OK&quot; or a &quot;Cancel&quot; button. If the user clicks &quot;OK&quot; the method returns <code>true</code>, if the user clicks &quot;Cancel&quot; the method returns <code>false</code>.</p><p><code>window.confirm</code> is wonderful in one way - it has a simple API which is easy to grok. But regardless of the browser, <code>window.confirm</code> is always as ugly as sin. Look at the first picture in this blog post; hideous. Or, put more dispassionately, it&#x27;s not terribly configurable; want to change the button text? You can&#x27;t. Want to change the styling of the dialog? You can&#x27;t. You get the picture.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="making-confirm-20"></a>Making confirm 2.0<a class="hash-link" href="#making-confirm-20" title="Direct link to heading">#</a></h2><p><a href="http://jqueryui.com/dialog/#modal-confirmation" target="_blank" rel="noopener noreferrer">jQuery UI&#x27;s dialog</a> has been around for a long time. I&#x27;ve been using it for a long time. But, if you look at the API, you&#x27;ll see it works in a very different way to <code>window.confirm</code> - basically it&#x27;s all about the callbacks. My intention was to create a mechanism which allowed me to prompt the user with jQuery UI&#x27;s tried and tested dialog, but to expose it in a way that embraced the simplicity of the <code>window.confirm</code> API.</p><p>How to do this? Promises! To quote <a href="http://martinfowler.com/bliki/JavascriptPromise.html" target="_blank" rel="noopener noreferrer">Martin Fowler</a> (makes you look smart when you do that):</p><blockquote><p><em>&quot;In Javascript, promises are objects which represent the pending result of an asynchronous operation. You can use these to schedule further activity after the asynchronous operation has completed by supplying a callback.&quot;</em></p></blockquote><p>When we show our dialog we are in asynchronous land; waiting for the user to click &quot;OK&quot; or &quot;Cancel&quot;. When they do, we need to act on their response. So if our custom confirm dialog returns a promise of a boolean (<code>true</code> when the users click &quot;OK&quot;, <code>false</code> otherwise) then that should be exactly what we need. I&#x27;m going to use <a href="https://github.com/kriskowal/q" target="_blank" rel="noopener noreferrer">Q</a> for promises. (Nothing particularly special about Q - it&#x27;s one of many <a href="https://github.com/promises-aplus/promises-spec/blob/master/implementations.md" target="_blank" rel="noopener noreferrer">Promises / A+</a> compliant implementations available.)</p><p>Here&#x27;s my custom confirm dialog:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-js codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/**</span></div><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">  * Show a &quot;confirm&quot; dialog to the user (using jQuery UI&#x27;s dialog)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">  *</span></div><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">  * @param {string} message The message to display to the user</span></div><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">  * @param {string} okButtonText OPTIONAL - The OK button text, defaults to &quot;Yes&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">  * @param {string} cancelButtonText OPTIONAL - The Cancel button text, defaults to &quot;No&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">  * @param {string} title OPTIONAL - The title of the dialog box, defaults to &quot;Confirm...&quot;</span></div><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">  * @returns {Q.Promise&lt;boolean&gt;} A promise of a boolean value</span></div><div class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">  */</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">confirmDialog</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">message</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> okButtonText</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> cancelButtonText</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> title</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    okButtonText </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> okButtonText </span><span class="token operator" style="color:rgb(137, 221, 255)">||</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Yes&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    cancelButtonText </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> cancelButtonText </span><span class="token operator" style="color:rgb(137, 221, 255)">||</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;No&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    title </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> title </span><span class="token operator" style="color:rgb(137, 221, 255)">||</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Confirm...&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword" style="font-style:italic">var</span><span class="token plain"> deferred </span><span class="token operator" style="color:rgb(137, 221, 255)">=</span><span class="token plain"> </span><span class="token constant" style="color:rgb(130, 170, 255)">Q</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">defer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">$</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;&lt;div title=&quot;&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> title </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;&quot;&gt;&#x27;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> message </span><span class="token operator" style="color:rgb(137, 221, 255)">+</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&#x27;&lt;/div&gt;&#x27;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">dialog</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        modal</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        buttons</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// The OK button</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            text</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> okButtonText</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">click</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Resolve the promise as true indicating the user clicked &quot;OK&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                deferred</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">resolve</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token function" style="color:rgb(130, 170, 255)">$</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">dialog</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;close&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// The Cancel button</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            text</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> cancelButtonText</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">click</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                </span><span class="token function" style="color:rgb(130, 170, 255)">$</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">dialog</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;close&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token function-variable function" style="color:rgb(130, 170, 255)">close</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token keyword" style="font-style:italic">function</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">event</span><span class="token parameter punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token parameter"> ui</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Destroy the jQuery UI dialog and remove it from the DOM</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token function" style="color:rgb(130, 170, 255)">$</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">this</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">dialog</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;destroy&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">remove</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// If the promise has not yet been resolved (eg the user clicked the close icon) </span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// then resolve the promise as false indicating the user did *not* click &quot;OK&quot;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token keyword control-flow" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">deferred</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">promise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">isPending</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">                deferred</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">resolve</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token boolean" style="color:rgb(255, 88, 116)">false</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">            </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword control-flow" style="font-style:italic">return</span><span class="token plain"> deferred</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token property-access">promise</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>What&#x27;s happening here? Well first of all, if <code>okButtonText</code>, <code>cancelButtonText</code> or <code>title</code> have false-y values then they are initialised to defaults. Next, we create a deferred object with Q. Then we create our modal dialog using jQuery UI. There&#x27;s a few things worth noting about this:</p><ul><li>We&#x27;re not dependent on the dialog markup being in our HTML from the off. We create a brand new element which gets added to the DOM when the dialog is created. (I draw attention to this as the jQuery UI dialog documentation doesn&#x27;t mention that you can use this approach - and frankly I prefer it.)</li><li>The &quot;OK&quot; and &quot;Cancel&quot; buttons are initialised with the string values stored in <code>okButtonText</code> and <code>cancelButtonText</code>. So by default, &quot;Yes&quot; and &quot;No&quot;.</li><li>If the user clicks the &quot;OK&quot; button then the promise is resolved with a value of <code>true</code>.</li><li>If the dialog closes and the promise has not been resolved then the promise is resolved with a value of <code>false</code>. This covers people clicking on the &quot;Cancel&quot; button as well as closing the dialog through other means.</li></ul><p>Finally we return the promise from our deferred object.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="going-from-windowconfirm-to-confirmdialog"></a>Going from <code>window.confirm</code> to <code>confirmDialog</code><a class="hash-link" href="#going-from-windowconfirm-to-confirmdialog" title="Direct link to heading">#</a></h2><p>It&#x27;s very simple to move from using <code>window.confirm</code> to <code>confirmDialog</code>. Take this example:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-js codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token keyword control-flow" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token dom variable" style="color:rgb(191, 199, 213)">window</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">confirm</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Are you sure?&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Do something</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Becomes:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-js codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token function" style="color:rgb(130, 170, 255)">confirmDialog</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token string" style="color:rgb(195, 232, 141)">&quot;Are you sure?&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token method function property-access" style="color:rgb(130, 170, 255)">then</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">function</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token parameter">confirmed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token keyword control-flow" style="font-style:italic">if</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">confirmed</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">        </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Do something</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>There&#x27;s no more to it than that.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="and-finally-a-demo"></a>And finally a demo...<a class="hash-link" href="#and-finally-a-demo" title="Direct link to heading">#</a></h2><p>With the JSFiddle below you can create your own custom dialogs and see the result of clicking on either the &quot;OK&quot; or &quot;Cancel&quot; buttons.</p><iframe width="100%" height="500" src="http://jsfiddle.net/johnny_reilly/ARWL5/embedded/result,js,html,css" allowfullscreen="" frameborder="0"></iframe></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/q">Q</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/j-query-ui">jQuery UI</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/promises">promises</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/confirm">confirm</a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_3-lP"><a href="/blog.johnnyreilly.com/2013/11/04/typescript-dont-forget-build-action-for-implicit-referencing">TypeScript: Don&#x27;t forget Build Action for Implicit Referencing...</a></h2><div class="margin-vert--md"><time datetime="2013-11-04T00:00:00.000Z" class="blogPostDate_Ta7i">November 4, 2013  Â· 2 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener"><img src="https://avatars.githubusercontent.com/u/1010525?s=400&amp;u=294033082cfecf8ad1645b4290e362583b33094a&amp;v=4" alt="John Reilly"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener">John Reilly</a></h4><small class="avatar__subtitle"></small></div></div></header><section class="markdown"><p>As part of the <a href="https://typescript.codeplex.com/wikipage?title=Known%20breaking%20changes%20between%200.8%20and%200.9&amp;referringTitle=Documentation" target="_blank" rel="noopener noreferrer">known breaking changes between 0.9 and 0.9.1</a> there was this subtle but significant switch:</p><blockquote><p>In Visual Studio, all TypeScript files in a project are considered to be referencing each other</p><p><em>Description:</em> Previously, all TypeScript files in a project had to reference each other explicitly. With 0.9.1, they now implicitly reference all other TypeScript files in the project. For existing projects that fit multiple projects into a single projects, these will now have to be separate projects.</p><p><em>Reason:</em> This greatly simplifies using TypeScript in the project context.</p></blockquote><p>Having been <a href="https://typescript.codeplex.com/workitem/1471" target="_blank" rel="noopener noreferrer">initially resistant</a> to this change I recently decided to give it a try. That is to say I started pulling out the <code>/// &amp;lt;reference</code>&#x27;s from my TypeScript files. However, to my surprise, pulling out these references stopped my TypeScript from compiling and killed my Intellisense. After wrestling with this for a couple of hours I finally <a href="https://typescript.codeplex.com/workitem/1855" target="_blank" rel="noopener noreferrer">filed an issue on the TypeScript CodePlex site</a>. (Because clearly the problem was with TypeScript and not how I was using it, right?)</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="wrong"></a>Wrong!<a class="hash-link" href="#wrong" title="Direct link to heading">#</a></h2><p>When I looked through my typing files (*.d.ts) I found that, pretty much without exception, all had a Build Action of &quot;Content&quot; and not &quot;TypeScriptCompile&quot;. I went through the project and switched the files over to being &quot;TypeScriptCompile&quot;. This resolved the issue and I was then able to pull out the remaining <code>/// &amp;lt;reference</code> comments from the codebase (though I did have to restart Visual Studio to get the Intellisense working).</p><p>Most, if not all, of the typing files had been pulled in from NuGet and are part of the <a href="https://github.com/borisyankov/DefinitelyTyped" target="_blank" rel="noopener noreferrer">DefinitelyTyped</a> project on GitHub. Unfortunately, at present, when TypeScript NuGet packages are added they are added without the &quot;TypeScriptCompile&quot; Build Action. I was going to post an issue there and ask if it&#x27;s possible for NuGet packages to pull in typings files as &quot;TypeScriptCompile&quot; from the off - fortunately a chap called Natan Vivo <a href="https://github.com/borisyankov/DefinitelyTyped/issues/1138" target="_blank" rel="noopener noreferrer">already has</a>.</p><p>So until this issue is resolved it&#x27;s probably a good idea to check that your TypeScript files are set to the correct Build Action in your project. And every time you upgrade your TypeScript NuGet packages double check that you still have the correct Build Action afterwards (and to get Intellisense working in VS 2012 at least you&#x27;ll need to close and re-open the solution as well).</p></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/type-script-compile">TypeScriptCompile</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/build-action">BuildAction</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/definitely-typed">DefinitelyTyped</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/type-script">TypeScript</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/nu-get">NuGet</a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_3-lP"><a href="/blog.johnnyreilly.com/2013/10/30/getting-typescript-compile-on-save-and-continous-integration-to-play-nice">Getting TypeScript Compile-on-Save and Continuous Integration to play nice</a></h2><div class="margin-vert--md"><time datetime="2013-10-30T00:00:00.000Z" class="blogPostDate_Ta7i">October 30, 2013  Â· 5 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener"><img src="https://avatars.githubusercontent.com/u/1010525?s=400&amp;u=294033082cfecf8ad1645b4290e362583b33094a&amp;v=4" alt="John Reilly"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener">John Reilly</a></h4><small class="avatar__subtitle"></small></div></div></header><section class="markdown"><p>Well sort of... Perhaps this post should more accurately called &quot;How to get CI to ignore your TypeScript whilst Visual Studio still compiles it...&quot;</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="once-there-was-web-essentials"></a>Once there was Web Essentials<a class="hash-link" href="#once-there-was-web-essentials" title="Direct link to heading">#</a></h2><p>When I first started using TypeScript, I was using it in combination with Web Essentials. Those were happy days. I saved my TS file and Web Essentials would kick off TypeScript compilation. Ah bliss. But the good times couldn&#x27;t last forever and sure enough when version 3.0 of Web Essentials shipped it <a href="http://madskristensen.net/post/Web-Essentials-2013-Where-is-the-TypeScript-support" target="_blank" rel="noopener noreferrer">pulled support for TypeScript</a>.</p><p>This made me, <a href="https://typescript.codeplex.com/workitem/1616" target="_blank" rel="noopener noreferrer">and others</a>, very sad. Essentially we were given the choice between sticking with an old version of Web Essentials (2.9 - the last release before 3.0) and keeping our Compile-on-Save *<strong>or</strong>* keeping with the latest version of Web Essentials and losing it. And since I understood that newer versions of TypeScript had differences in the compiler flags which slightly broke compatibility with WE 2.9 the latter choice seemed the most sensible...</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="but-there-is-still-compile-on-save-hope"></a>But there is still Compile on Save hope!<a class="hash-link" href="#but-there-is-still-compile-on-save-hope" title="Direct link to heading">#</a></h2><p>The information was that we need not lose our Compile on Save. We just need to follow the instructions <a href="https://typescript.codeplex.com/wikipage?title=Compile-on-Save" target="_blank" rel="noopener noreferrer">here</a>. Or to quote them:</p><blockquote><p>Then additionally add (or replace if you had an older PreBuild action for TypeScript) the following at the end of your project file to include TypeScript compilation in your project.</p><p>...</p><p>For C#-style projects (.csproj):</p><div class="mdxCodeBlock_1zKU">  &lt;PropertyGroup Condition=&quot;&#x27;$(Configuration)&#x27; == &#x27;Debug&#x27;&quot;&gt; &lt;TypeScriptTarget&gt;ES5&lt;/TypeScriptTarget&gt; &lt;TypeScriptIncludeComments&gt;true&lt;/TypeScriptIncludeComments&gt; &lt;TypeScriptSourceMap&gt;true&lt;/TypeScriptSourceMap&gt; &lt;/PropertyGroup&gt; &lt;PropertyGroup Condition=&quot;&#x27;$(Configuration)&#x27; == &#x27;Release&#x27;&quot;&gt; &lt;TypeScriptTarget&gt;ES5&lt;/TypeScriptTarget&gt; &lt;TypeScriptIncludeComments&gt;false&lt;/TypeScriptIncludeComments&gt; &lt;TypeScriptSourceMap&gt;false&lt;/TypeScriptSourceMap&gt; &lt;/PropertyGroup&gt; &lt;Import Project=&quot;$(MSBuildExtensionsPath32)\Microsoft\VisualStudio\v$(VisualStudioVersion)\TypeScript\Microsoft.TypeScript.targets&quot; /&gt;</div></blockquote><p>I followed these instructions (well I had to tweak the <code>Import Project</code> location) and I was in business again. But I when I came to check my code into TFS I came unstuck. The automated build kicked off and then, in short order, kicked me:</p><blockquote><p><code>C:\Builds\1\MyApp\MyApp Continuous Integration\src\MyApp\MyApp.csproj (1520): The imported project &quot;C:\Program Files (x86)\MSBuild\Microsoft\VisualStudio\v11.0\TypeScript\Microsoft.TypeScript.targets&quot; was not found. Confirm that the path in the &lt;import&gt; declaration is correct, and that the file exists on disk. C:\Builds\1\MyApp\MyApp Continuous Integration\src\MyApp\MyApp.csproj (1520): The imported project &quot;C:\Program Files (x86)\MSBuild\Microsoft\VisualStudio\v11.0\TypeScript\Microsoft.TypeScript.targets&quot; was not found. Confirm that the path in the &lt;import&gt; declaration is correct, and that the file exists on disk. &lt;/import&gt;&lt;/import&gt;</code></p></blockquote><p>That&#x27;s right, TypeScript wasn&#x27;t installed on the build server. And since TypeScript was now part of the build process my builds were now failing. Ouch.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="so-what-now"></a>So what now?<a class="hash-link" href="#so-what-now" title="Direct link to heading">#</a></h2><p>I did a little digging and found <a href="https://typescript.codeplex.com/workitem/1518" target="_blank" rel="noopener noreferrer">this issue report on the TypeScript CodePlex site</a>. To quote the issue, it seemed there were 2 possible solutions to get continuous integration and typescript playing nice:</p><ol><li>Install TypeScript on the build server</li><li>Copy the required files for Microsoft.TypeScript.targets to a different source-controlled folder and change the path references in the csproj file to this folder.</li></ol><p>#1 wasn&#x27;t an option for us - we couldn&#x27;t install on the build server. And covering both #1 and #2, I wasn&#x27;t particularly inclined to kick off builds on the build server since I was wary of <a href="https://typescript.codeplex.com/workitem/1432" target="_blank" rel="noopener noreferrer">reported problems with memory leaks</a> etc with the TS compiler. I may feel differently later when TS is no longer in Alpha and has stabilised but it didn&#x27;t seem like the right time.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="a-solution"></a>A solution<a class="hash-link" href="#a-solution" title="Direct link to heading">#</a></h2><p>So, to sum up, what I wanted was to be able to compile TypeScript in Visual Studio on my machine, and indeed in VS on the machine of anyone else working on the project. But I *<strong>didn&#x27;t</strong>* want TypeScript compilation to be part of the build process on the server.</p><p>The solution in the end was pretty simple - I replaced the <code>.csproj</code> changes with the code below:</p><div class="mdxCodeBlock_1zKU">  &lt;PropertyGroup Condition=&quot;&#x27;$(Configuration)&#x27; == &#x27;Debug&#x27;&quot;&gt; &lt;TypeScriptTarget&gt;ES5&lt;/TypeScriptTarget&gt; &lt;TypeScriptRemoveComments&gt;false&lt;/TypeScriptRemoveComments&gt; &lt;TypeScriptSourceMap&gt;false&lt;/TypeScriptSourceMap&gt; &lt;TypeScriptModuleKind&gt;AMD&lt;/TypeScriptModuleKind&gt; &lt;TypeScriptNoImplicitAny&gt;true&lt;/TypeScriptNoImplicitAny&gt; &lt;/PropertyGroup&gt; &lt;PropertyGroup Condition=&quot;&#x27;$(Configuration)&#x27; == &#x27;Release&#x27;&quot;&gt; &lt;TypeScriptTarget&gt;ES5&lt;/TypeScriptTarget&gt; &lt;TypeScriptRemoveComments&gt;false&lt;/TypeScriptRemoveComments&gt; &lt;TypeScriptSourceMap&gt;false&lt;/TypeScriptSourceMap&gt; &lt;TypeScriptModuleKind&gt;AMD&lt;/TypeScriptModuleKind&gt; &lt;TypeScriptNoImplicitAny&gt;true&lt;/TypeScriptNoImplicitAny&gt; &lt;/PropertyGroup&gt; &lt;Import Project=&quot;$(VSToolsPath)\TypeScript\Microsoft.TypeScript.targets&quot; Condition=&quot;Exists(&#x27;$(VSToolsPath)\TypeScript\Microsoft.TypeScript.targets&#x27;)&quot; /&gt;</div><p>What this does is enable TypeScript compilation *<strong>only</strong>* if TypeScript is installed. So when I&#x27;m busy developing with Visual Studio on my machine with the plugin installed I can compile TypeScript. But when I check in the TypeScript compilation is *<strong>not</strong>* performed on the build server. This is because TypeScript is not installed on the build server and we are only compiling if it is installed. (Just to completely labour the point.)</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="final-thoughts"></a>Final thoughts<a class="hash-link" href="#final-thoughts" title="Direct link to heading">#</a></h2><p>I do consider this an interim solution. As I mentioned earlier, when TypeScript has stabilised I think I&#x27;d like TS compilation to be part of the build process. Like with any other code I think compiling on check-in to catch bugs early is an excellent idea. But I think I&#x27;ll wait until there&#x27;s some clearer guidance on the topic from the TypeScript team before I take this step.</p></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/tfs">TFS</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/type-script">TypeScript</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/build-server">Build Server</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/continuous-integration">Continuous Integration</a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_3-lP"><a href="/blog.johnnyreilly.com/2013/10/04/migrating-from-jquery.validate.unobtrusive.js-to-jQuery.Validation.Unobtrusive.Native">Migrating from jquery.validate.unobtrusive.js to jQuery.Validation.Unobtrusive.Native</a></h2><div class="margin-vert--md"><time datetime="2013-10-04T00:00:00.000Z" class="blogPostDate_Ta7i">October 4, 2013  Â· 4 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener"><img src="https://avatars.githubusercontent.com/u/1010525?s=400&amp;u=294033082cfecf8ad1645b4290e362583b33094a&amp;v=4" alt="John Reilly"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener">John Reilly</a></h4><small class="avatar__subtitle"></small></div></div></header><section class="markdown"><p>So, you&#x27;re looking at <a href="https://github.com/johnnyreilly/jQuery.Validation.Unobtrusive.Native" target="_blank" rel="noopener noreferrer">jQuery.Validation.Unobtrusive.Native</a>. You&#x27;re thinking to yourself &quot;Yeah, I&#x27;d really like to use the native unobtrusive support in jQuery Validation. But I&#x27;ve already got this app which is using <a href="https://www.nuget.org/packages/jQuery.Validation.Unobtrusive/" target="_blank" rel="noopener noreferrer">jquery.validate.unobtrusive.js</a> - actually how easy is switching over?&quot; Well I&#x27;m here to tell you that it&#x27;s pretty straightforward - here&#x27;s a walkthrough of how it might be done.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="i-need-something-to-migrate"></a>I need something to migrate<a class="hash-link" href="#i-need-something-to-migrate" title="Direct link to heading">#</a></h2><p>So let&#x27;s File &gt; New Project ourselves a new MVC 4 application using the Internet Application template. I&#x27;ve picked this template as I know it ships with account registration / login screens in place which make use of jquery.validate.unobtrusive.js. To demo this just run the project, click the &quot;Log in&quot; link and then click the &quot;Log in&quot; button - you should see something like this:</p><p><img src="http://1.bp.blogspot.com/-7JxyO2uaVow/Uk5373yDbaI/AAAAAAAAAdk/gD8h47ObQcg/s400/BeforeLoginScreen.png"></p><p>What you&#x27;ve just witnessed is jquery.validate.unobtrusive.js doing its thing. Both the <code>UserName</code> and <code>Password</code> properties on the <code>LoginModel</code> are decorated with the <code>Required</code> data annotation which, in the above scenario, causes the validation to be triggered on the client thanks to MVC rendering data attributes in the HTML which jquery.validate.unobtrusive.js picks up on. The question is, how can we take the log in screen above and migrate it across to to using jQuery.Validation.Unobtrusive.Native?</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="hit-me-up-nuget"></a>Hit me up NuGet!<a class="hash-link" href="#hit-me-up-nuget" title="Direct link to heading">#</a></h2><p>Time to dive into NuGet and install jQuery.Validation.Unobtrusive.Native. We&#x27;ll install the MVC 4 version using this command:</p><div class="nuget-badge"><p><code>PM&gt; Install-Package jQuery.Validation.Unobtrusive.Native.MVC4</code></p></div><p>What has this done to my project? Well 2 things</p><ol><li>It&#x27;s upgraded jQuery Validation (<a href="http://jqueryvalidation.org/" target="_blank" rel="noopener noreferrer">jquery.validate.js</a>) from v1.10.0 (the version that is currently part of the MVC 4 template) to v1.11.1 (the latest and greatest jQuery Validation as of the time of writing)</li><li>It&#x27;s added a reference to the jQuery.Validation.Unobtrusive.Native.MVC4 assembly, like so:</li></ol><p><img src="http://3.bp.blogspot.com/-V-21V1Ypo3E/Uk583DTbegI/AAAAAAAAAd0/O0nv7w6kmew/s400/NewReference.png"></p><p>In case you were wondering, doing this hasn&#x27;t broken the existing jquery.validate.unobtrusive.js - if you head back to the Log in screen you&#x27;ll still see the same behaviour as before.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="migrating"></a>Migrating...<a class="hash-link" href="#migrating" title="Direct link to heading">#</a></h2><p>We need to switch our TextBox and Password helpers over to using jQuery.Validation.Unobtrusive.Native, which we achieve by simply passing a second argument of <code>true</code> to <code>useNativeUnobtrusiveAttributes</code>. So we go from this:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cs codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">// ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">@Html.TextBoxFor(m =&gt; m.UserName)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">@Html.PasswordFor(m =&gt; m.Password)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// ...</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>To this:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cs codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">// ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">@Html.TextBoxFor(m =&gt; m.UserName, true)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// ...</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">@Html.PasswordFor(m =&gt; m.Password, true)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">// ...</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>With these minor tweaks in place the natively supported jQuery Validation data attributes will be rendered into the textbox / password elements instead of the jquery.validate.unobtrusive.js ones.</p><p>Next lets do the JavaScript. If you take a look at the bottom of the <code>Login.cshtml</code> view you&#x27;ll see this:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cs codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">@section Scripts {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    @Scripts.Render(&quot;~/bundles/jqueryval&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Which renders the following scripts:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-html codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">script</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">src</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">/Scripts/jquery.unobtrusive-ajax.js</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token script"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">script</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">script</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">src</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">/Scripts/jquery.validate.js</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token script"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">script</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">script</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">src</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">/Scripts/jquery.validate.unobtrusive.js</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token script"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">script</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>In our brave new world we&#x27;re only going to need jquery.validate.js - so let&#x27;s create ourselves a new bundle in <code>BundleConfig.cs</code> which only contains that single file:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-cs codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">bundles.Add(new ScriptBundle(&quot;~/bundles/jqueryvalnative&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    .Include(&quot;~/Scripts/jquery.validate.js&quot;));</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>To finish off our migrated screen we need to do 2 things. First we need to switch over the <code>Login.cshtml</code> view to only render the jquery.validate.js script (in the form of our new bundle). Secondly, the other thing that jquery.validate.unobtrusive.js did was to trigger validation for the current form. So we need to do that ourselves now. So our finished Scripts section looks like this:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-html codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token plain">@section Scripts {</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    @Scripts.Render(&quot;~/bundles/jqueryvalnative&quot;)</span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">script</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token script language-javascript"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token script language-javascript">        </span><span class="token script language-javascript function" style="color:rgb(130, 170, 255)">$</span><span class="token script language-javascript punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token script language-javascript string" style="color:rgb(195, 232, 141)">&quot;form&quot;</span><span class="token script language-javascript punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token script language-javascript punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token script language-javascript method function property-access" style="color:rgb(130, 170, 255)">validate</span><span class="token script language-javascript punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token script language-javascript punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token script language-javascript punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token script language-javascript"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token script language-javascript">    </span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">script</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>Which renders the following script:</p><div class="mdxCodeBlock_1zKU"><div class="codeBlockContent_actS"><div tabindex="0" class="prism-code language-html codeBlock_tuNs thin-scrollbar"><div class="codeBlockLines_3uvA" style="color:#bfc7d5;background-color:#292d3e"><div class="token-line" style="color:#bfc7d5"><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">script</span><span class="token tag" style="color:rgb(255, 85, 114)"> </span><span class="token tag attr-name" style="color:rgb(255, 203, 107)">src</span><span class="token tag attr-value punctuation attr-equals" style="color:rgb(199, 146, 234)">=</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag attr-value" style="color:rgb(255, 85, 114)">/Scripts/jquery.validate.js</span><span class="token tag attr-value punctuation" style="color:rgb(199, 146, 234)">&quot;</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token script"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">script</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token plain"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;</span><span class="token tag" style="color:rgb(255, 85, 114)">script</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span><span class="token script language-javascript"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token script language-javascript">    </span><span class="token script language-javascript function" style="color:rgb(130, 170, 255)">$</span><span class="token script language-javascript punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token script language-javascript string" style="color:rgb(195, 232, 141)">&quot;form&quot;</span><span class="token script language-javascript punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token script language-javascript punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token script language-javascript method function property-access" style="color:rgb(130, 170, 255)">validate</span><span class="token script language-javascript punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token script language-javascript punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token script language-javascript punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token script language-javascript"></span></div><div class="token-line" style="color:#bfc7d5"><span class="token script language-javascript"></span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&lt;/</span><span class="token tag" style="color:rgb(255, 85, 114)">script</span><span class="token tag punctuation" style="color:rgb(199, 146, 234)">&gt;</span></div></div></div><button type="button" aria-label="Copy code to clipboard" class="copyButton_2GIj">Copy</button></div></div><p>And, pretty much, that&#x27;s it. If you run the app now and go to the Log in screen and try to log in without credentials you&#x27;ll get this:</p><p><img src="http://2.bp.blogspot.com/-nD3-3jW1_Yo/Uk7G5sTpsGI/AAAAAAAAAeE/NDNf4jqhJSk/s400/AfterLoginScreen.png"></p><p>Which is functionally exactly the same as previously. The eagle eyed will notice some styling differences but that&#x27;s all it comes down to really; style. And if you were so inclined you could easily style this up as you liked using CSS and the options you can pass to jQuery Validation (in fact a quick rummage through jquery.validate.unobtrusive.js should give you everything you need).</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="rounding-off"></a>Rounding off<a class="hash-link" href="#rounding-off" title="Direct link to heading">#</a></h2><p>Before I sign off I&#x27;d like to illustrate how little we&#x27;ve had to change the code to start using jQuery.Validation.Unobtrusive.Native. Just take a look at this code comparison:</p><p><img src="http://2.bp.blogspot.com/-vnA84f1JXHw/Uk7HoDPGqMI/AAAAAAAAAeM/qZVlRak92_o/s400/WhatsTheDifference.png"></p><p>As you see, it takes very little effort to migrate from one approach to the other. And it&#x27;s *<strong>your</strong>* choice. If you want to have one screen that uses jQuery.Validation.Unobtrusive.Native and one screen that uses jquery.validation.unobtrusive.js then you can! Including jQuery.Validation.Unobtrusive.Native in your project gives you the <strong>option</strong> to use it. It doesn&#x27;t force you to, you can do so as you need to and when you want to. It&#x27;s down to you.</p></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/migrating">migrating</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/jquery-validate-unobtrusive-js">jquery.validate.unobtrusive.js</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/getting-started">getting started</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/j-query-validation-unobtrusive-native">jQuery.Validation.Unobtrusive.Native</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/j-query-validation">jQuery Validation</a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_3-lP"><a href="/blog.johnnyreilly.com/2013/08/17/using-bootstrap-tooltips-to-display">Using Bootstrap Tooltips to display jQuery Validation error messages</a></h2><div class="margin-vert--md"><time datetime="2013-08-17T00:00:00.000Z" class="blogPostDate_Ta7i">August 17, 2013  Â· 2 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener"><img src="https://avatars.githubusercontent.com/u/1010525?s=400&amp;u=294033082cfecf8ad1645b4290e362583b33094a&amp;v=4" alt="John Reilly"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener">John Reilly</a></h4><small class="avatar__subtitle"></small></div></div></header><section class="markdown"><p>I love jQuery Validation. I was recently putting together a screen which had a lot of different bits of validation going on. And the default jQuery Validation approach of displaying the validation messages next to the element being validated wasn&#x27;t working for me. That is to say, because of the amount of elements on the form, the appearance of validation messages was really making a mess of the presentation. So what to do?</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="tooltips-to-the-rescue"></a>Tooltips to the rescue!<a class="hash-link" href="#tooltips-to-the-rescue" title="Direct link to heading">#</a></h2><p>I was chatting to <a href="https://plus.google.com/u/0/116859810359377785616/posts" target="_blank" rel="noopener noreferrer">Marc Talary</a> about this and he had the bright idea of using tooltips to display the error messages. Tooltips would allow the existing presentation of the form to remain as is whilst still displaying the messages to the users. Brilliant idea!</p><p>After a certain amount of fiddling I came up with a fairly solid mechanism for getting jQuery Validation to display error messages as tooltips which I&#x27;ll share here. It&#x27;s worth saying that for the application that Marc and I were working on we already had <a href="http://jqueryui.com/" target="_blank" rel="noopener noreferrer">jQuery UI</a> in place and so we decided to use the <a href="http://jqueryui.com/tooltip/" target="_blank" rel="noopener noreferrer">jQuery UI tooltip</a>. This example will use the <a href="http://getbootstrap.com/javascript/#tooltips" target="_blank" rel="noopener noreferrer">Bootstrap tooltip</a> instead. As much as anything else this demonstrates that you could swap out the tooltip mechanism here with any of your choosing.</p><iframe src="http://htmlpreview.github.io/?https://gist.github.com/johnnyreilly/5867188/raw/2543a12fbd5c0aaad1da6793b7a7437492be3baf/DemoTooltip.html" width="100%" height="350"></iframe><p>Beautiful isn&#x27;t it? Now look at the source:</p><script src="https://gist.github.com/johnnyreilly/5867188.js?file=DemoTooltip.html"></script><p>All the magic is in the JavaScript, specifically the <code>showErrors</code> function that&#x27;s passed as an option to jQuery Validation. Enjoy!</p></section><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/tooltip">Tooltip</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/bootstrap">Bootstrap</a><a class="margin-horiz--sm" href="/blog.johnnyreilly.com/tags/j-query-validation">jQuery Validation</a></div></footer></article><article class="margin-bottom--xl"><header><h2 class="margin-bottom--sm blogPostTitle_3-lP"><a href="/blog.johnnyreilly.com/2013/08/08/announcing-jquery-validation">Announcing jQuery Validation Unobtrusive Native...</a></h2><div class="margin-vert--md"><time datetime="2013-08-08T00:00:00.000Z" class="blogPostDate_Ta7i">August 8, 2013  Â· 3 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener"><img src="https://avatars.githubusercontent.com/u/1010525?s=400&amp;u=294033082cfecf8ad1645b4290e362583b33094a&amp;v=4" alt="John Reilly"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener">John Reilly</a></h4><small class="avatar__subtitle"></small></div></div></header><section class="markdown"><p>I&#x27;ve been busy working on an open source project called <strong><a href="http://github.com/johnnyreilly/jQuery.Validation.Unobtrusive.Native" target="_blank" rel="noopener noreferrer">jQuery Validation Unobtrusive Native</a></strong>. <a href="http://johnnyreilly.github.io/jQuery.Validation.Unobtrusive.Native/" target="_blank" rel="noopener noreferrer">To see it in action take a look here</a>.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="a-little-background"></a>A Little Background<a class="hash-link" href="#a-little-background" title="Direct link to heading">#</a></h2><p>I noticed a little while ago that jQuery Validation was now providing native support for validation driven by HTML 5 data attributes. As you may be aware, Microsoft shipped <a href="http://bradwilson.typepad.com/blog/2010/10/mvc3-unobtrusive-validation.html" target="_blank" rel="noopener noreferrer">jquery.validate.unobtrusive.js</a> back with MVC 3. (<a href="http://icanmakethiswork.blogspot.com/2012/08/jquery-unobtrusive-validation.html" target="_blank" rel="noopener noreferrer">I have written about it before.</a>) It provided a way to apply data model validations to the client side using a combination of jQuery Validation and HTML 5 data attributes.</p><p>The principal of this was and is fantastic. But since that time the jQuery Validation project has implemented its own support for driving validation unobtrusively (shipping with <a href="http://jquery.bassistance.de/validate/changelog.txt" target="_blank" rel="noopener noreferrer">jQuery Validation 1.11.0</a>). I&#x27;ve been looking at a way to directly use the native support instead of jquery.validate.unobtrusive.js.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="so-what-is-jquery-validation-unobtrusive-native"></a>So... What is jQuery Validation Unobtrusive Native?<a class="hash-link" href="#so-what-is-jquery-validation-unobtrusive-native" title="Direct link to heading">#</a></h2><p>jQuery Validation Unobtrusive Native is a collection of ASP.Net MVC HTML helper extensions. These make use of jQuery Validation&#x27;s native support for validation driven by HTML 5 data attributes. The advantages of the native support over jquery.validate.unobtrusive.js are:</p><ul><li>Dynamically created form elements are parsed automatically. jquery.validate.unobtrusive.js does not support this whilst jQuery Validation does. <a href="http://johnnyreilly.github.io/jQuery.Validation.Unobtrusive.Native/AdvancedDemo/Knockout.html" target="_blank" rel="noopener noreferrer">Take a look at a demo using Knockout.</a></li><li>jquery.validate.unobtrusive.js restricts how you use jQuery Validation. If you want to use showErrors or something similar then you may find that you need to go native (or at least you may find that significantly easier than working with the jquery.validate.unobtrusive.js defaults)... </li><li>Send less code to your browser, make your browser to do less work and even get a (marginal) performance benefit .</li></ul><p>This project intends to be a bridge between MVC&#x27;s inbuilt support for driving validation from data attributes and jQuery Validation&#x27;s native support for the same. This is achieved by hooking into the MVC data attribute creation mechanism and using it to generate the data attributes natively supported by jQuery Validation.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="future-plans"></a>Future Plans<a class="hash-link" href="#future-plans" title="Direct link to heading">#</a></h2><p>So far the basic set of the HtmlHelpers and their associated unobtrusive mappings have been implemented. If any have been missed then let me know. As time goes by I intend to:</p><ul><li>fill in any missing gaps there may be</li><li>maintain MVC 3, 4 (and when the time comes 5+) versions of this on Nuget</li><li>not all data annotations generate client data attributes - if it makes sense I may look to implement some of these where it seems sensible. (eg the <a href="http://msdn.microsoft.com/en-us/library/system.componentmodel.dataannotations.minlengthattribute.aspx" target="_blank" rel="noopener noreferrer">MinLengthAttribute</a> annotation could be mapped to <a href="http://jqueryvalidation.org/minlength-method/" target="_blank" rel="noopener noreferrer">minlength</a> validation...)</li><li>get the unit test coverage to a good level and finally (and perhaps most importantly)</li><li>create some really useful <a href="http://johnnyreilly.github.io/jQuery.Validation.Unobtrusive.Native/Demo.html" target="_blank" rel="noopener noreferrer">demos and documentation</a>.</li></ul><p>Help is appreciated so feel free to pitch in! You can find the project on GitHub <a href="http://github.com/johnnyreilly/jQuery.Validation.Unobtrusive.Native" target="_blank" rel="noopener noreferrer">here</a>...</p></section></article><nav class="pagination-nav" aria-label="Blog list page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog.johnnyreilly.com/page/16"><div class="pagination-nav__label">Â« Newer Entries</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog.johnnyreilly.com/page/18"><div class="pagination-nav__label">Older Entries Â»</div></a></div></nav></main></div></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 John Reilly. Built with Docusaurus.</div></div></div></footer></div>
<script src="/blog.johnnyreilly.com/styles.b80bbee1.js"></script>
<script src="/blog.johnnyreilly.com/runtime~main.94d0c56d.js"></script>
<script src="/blog.johnnyreilly.com/main.08f1a502.js"></script>
<script src="/blog.johnnyreilly.com/1.b4966bec.js"></script>
<script src="/blog.johnnyreilly.com/2.7d3f6764.js"></script>
<script src="/blog.johnnyreilly.com/a6aa9e1f.88297f1e.js"></script>
<script src="/blog.johnnyreilly.com/c3b5bd8c.4d75ffb7.js"></script>
<script src="/blog.johnnyreilly.com/91f96256.e23882b2.js"></script>
<script src="/blog.johnnyreilly.com/5a727dac.ed4e0df0.js"></script>
<script src="/blog.johnnyreilly.com/00d73702.ddf62eef.js"></script>
<script src="/blog.johnnyreilly.com/f6213bbd.3e96180f.js"></script>
<script src="/blog.johnnyreilly.com/867e7696.198c6174.js"></script>
<script src="/blog.johnnyreilly.com/8f5729b9.e9aa869a.js"></script>
<script src="/blog.johnnyreilly.com/9957bc3e.0e0e78fa.js"></script>
<script src="/blog.johnnyreilly.com/6496ed56.54be6eea.js"></script>
<script src="/blog.johnnyreilly.com/d6e44df4.a898d0e3.js"></script>
<script src="/blog.johnnyreilly.com/ebd64336.241d0737.js"></script>
<script src="/blog.johnnyreilly.com/e3e5222a.9bb0b6b7.js"></script>
</body>
</html>