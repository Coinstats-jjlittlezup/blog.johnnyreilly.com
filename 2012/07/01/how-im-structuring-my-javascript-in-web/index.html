<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.73">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="I CAN MAKE THIS WORK Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="I CAN MAKE THIS WORK Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-51754530-2","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="icon" href="/img/favicon/profile.jpg">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="rgb(37, 194, 160)">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#000">
<link rel="apple-touch-icon" href="/img/favicon/apple-touch-icon.png"><title data-react-helmet="true">I CAN MAKE THIS WORK</title><meta data-react-helmet="true" name="description" content="I have occasionally done some server-side JavaScript with Rhino and Node.js but this is the exception rather than the rule. Like most folk at the moment, almost all the JavaScript I write is in a web context."><meta data-react-helmet="true" property="og:description" content="I have occasionally done some server-side JavaScript with Rhino and Node.js but this is the exception rather than the rule. Like most folk at the moment, almost all the JavaScript I write is in a web context."><meta data-react-helmet="true" property="og:url" content="https://blog.johnnyreilly.com/2012/07/01/how-im-structuring-my-javascript-in-web"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><meta data-react-helmet="true" property="og:title" content="I CAN MAKE THIS WORK"><meta data-react-helmet="true" property="og:image" content="https://blog.johnnyreilly.com/img/profile.png"><meta data-react-helmet="true" name="twitter:image" content="https://blog.johnnyreilly.com/img/profile.png"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://blog.johnnyreilly.com/2012/07/01/how-im-structuring-my-javascript-in-web"><link data-react-helmet="true" rel="alternate" href="https://blog.johnnyreilly.com/2012/07/01/how-im-structuring-my-javascript-in-web" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://blog.johnnyreilly.com/2012/07/01/how-im-structuring-my-javascript-in-web" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.105de97d.css">
<link rel="preload" href="/assets/js/styles.a4ce88d2.js" as="script">
<link rel="preload" href="/assets/js/runtime~main.b634e2bd.js" as="script">
<link rel="preload" href="/assets/js/main.b119f4b6.js" as="script">
<link rel="preload" href="/assets/js/1.8b668980.js" as="script">
<link rel="preload" href="/assets/js/2.544547e0.js" as="script">
<link rel="preload" href="/assets/js/ccc49370.ee3792fd.js" as="script">
<link rel="preload" href="/assets/js/c3b5bd8c.4d1bf496.js" as="script">
<link rel="preload" href="/assets/js/8890ac7a.b5cb1200.js" as="script">
<link rel="preload" href="/assets/js/fe3d2add.78ab73dc.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#main" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle" type="button" tabindex="0"><svg aria-label="Menu" width="30" height="30" viewBox="0 0 30 30" role="img" focusable="false"><title>Menu</title><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">I CAN MAKE THIS WORK</strong></a><a class="navbar__item navbar__link" href="/about">About</a><a class="navbar__item navbar__link" href="/blog-archive">Blog Archive</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/johnnyreilly" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub</a><a href="https://twitter.com/johnny_reilly" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Twitter</a><div class="react-toggle displayOnlyInLargeViewport_GrZ2 react-toggle--disabled" role="button" tabindex="-1"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/"><img src="/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><strong class="navbar__title">I CAN MAKE THIS WORK</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"><li class="menu__list-item"><a class="menu__link" href="/about">About</a></li><li class="menu__list-item"><a class="menu__link" href="/blog-archive">Blog Archive</a></li><li class="menu__list-item"><a href="https://github.com/johnnyreilly" target="_blank" rel="noopener noreferrer" class="menu__link">GitHub</a></li><li class="menu__list-item"><a href="https://twitter.com/johnny_reilly" target="_blank" rel="noopener noreferrer" class="menu__link">Twitter</a></li></ul></div></div></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><div class="col col--3"><div class="sidebar_2ahu thin-scrollbar"><h3 class="sidebarItemTitle_2hhb">Recent posts</h3><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/2021/04/20/ts-loader-goes-webpack-5">ts-loader goes webpack 5</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/2021/04/10/hello-world-bicep">Hello World Bicep</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/2021/03/23/bicep-meet-azure-pipelines-2">Bicep meet Azure Pipelines 2</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/2021/03/20/bicep-meet-azure-pipelines">Bicep meet Azure Pipelines</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/2021/03/17/rss-update-we-moved-to-docusaurus">RSS update; we moved to Docusaurus</a></li></ul></div></div><main class="col col--7"><article><header><h1 class="margin-bottom--sm blogPostTitle_GeHD">Optimally Serving Up JavaScript</h1><div class="margin-vert--md"><time datetime="2012-07-01T00:00:00.000Z" class="blogPostDate_fNvV">July 1, 2012 Â· 7 min read</time></div><div class="avatar margin-vert--md"><a href="https://github.com/johnnyreilly" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://blog.johnnyreilly.com/img/profile.jpg" alt="John Reilly"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/johnnyreilly" target="_blank" rel="noopener noreferrer">John Reilly</a></h4><small class="avatar__subtitle"></small></div></div></header><div class="markdown"><p>I have occasionally done some server-side JavaScript with Rhino and Node.js but this is the exception rather than the rule. Like most folk at the moment, almost all the JavaScript I write is in a web context.</p><p> Over time I&#x27;ve come to adopt a roughly standard approach to how I structure my JavaScript; both the JavaScript itself and how it is placed / rendered in the an HTML document. I wanted to write about the approach I&#x27;m using. Partly just to document the approach but also because I often find writing about something crystalises my feelings on the subject in one way or another. I think that most of what I&#x27;m doing is sensible and rational but maybe as I write about this I&#x27;ll come to some firmer conclusions about my direction of travel.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="what-are-you-up-to"></a>What are you up to?<a class="hash-link" href="#what-are-you-up-to" title="Direct link to heading">#</a></h2><p>Before I get started it&#x27;s probably worth mentioning the sort of web development I&#x27;m generally called to do (as this has obviously influenced my decisions).</p><p>Most of my work tends to be on web applications used internally within a company. That is to say, web applications accessible on a Company intranet. Consequently, the user base for my applications tends to be smaller than the Amazons and Googles of this world. It almost invariably sits on the ASP.NET stack in some way. Either classic WebForms or MVC.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="render-first-js-second"></a>&quot;Render first. JS second.&quot;<a class="hash-link" href="#render-first-js-second" title="Direct link to heading">#</a></h2><p>I took 2 things away from <a href="http://www.stevesouders.com/blog/2010/09/30/render-first-js-second/" target="_blank" rel="noopener noreferrer">Steve Souder&#x27;s article</a>:</p><ol><li>Async script loading is better than synchronous script loading</li><li>Get your screen rendered and *<strong>then</strong>* execute your JavaScript</li></ol><p>I&#x27;m not doing any async script loading as yet; although I am thinking of giving it a try at some point. In terms of choosing a loader I&#x27;ll probably give RequireJS first crack of the whip (purely as it looks like most people are tending it&#x27;s direction and that can&#x27;t be without reason).</p><p>However - it seems that the concept of async script loading is kind of conflict with one of the other tenets of web wisdom: script bundling. Script bundling, if you&#x27;re not already aware, is the idea that you should combine all your scripts into a single file and then just serve that. This prevents multiple HTTP requests as each script loads in. Async script loading is obviously okay with multiple HTTP requests, presumably because of the asynchronous non-blocking pattern of loading. So. 2 different ideas. And there&#x27;s further movement on this front right now as <a href="http://www.hanselman.com/blog/VisualStudio2012RCIsReleasedTheBigWebRollup.aspx" target="_blank" rel="noopener noreferrer">Microsoft are baking in script bundling to .NET 4.5</a>.</p><p>Rather than divide myself between these 2 horses I have at the moment tried to follow the &quot;JS second&quot; part of this advice in my own (perhaps slightly old fashioned) way...</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="i-want-to-serve-you"></a>I want to serve you...<a class="hash-link" href="#i-want-to-serve-you" title="Direct link to heading">#</a></h2><p>I have been making sure that scripts are the last thing served to the screen by using a customised version of <a href="http://frugalcoder.us/post/2009/06/29/Handling-Scripts-in-ASPNet-MVC.aspx" target="_blank" rel="noopener noreferrer">Michael J. Ryan&#x27;s HtmlHelper</a>. This lovely helper allows you to add script references as required from a number of different sources (layout page, view, partial view etc - even the controller if you so desired). It&#x27;s simple to control the ordering of scripts by allowing you to set a priority for each script which determines the render order.</p><p>Then as a final step before rendering the <code>&amp;lt;/body&amp;gt;</code> tag the scripts can be rendered in one block. By this point the web page is rendered visually and a marginal amount of blocking is, in my view, acceptable.</p><p>If anyone is curious - the class below is my own version of Michael&#x27;s helper. My contribution is the go faster stripes relating to the caching suffix and the ability to specify dependancies using script references rather than using numeric priority mechanism):</p><script src="https://gist.github.com/3019159.js?file=ScriptExtensions.cs"></script><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="minification---i-want-to-serve-you-less"></a>Minification - I want to serve you less...<a class="hash-link" href="#minification---i-want-to-serve-you-less" title="Direct link to heading">#</a></h2><p>Another tweak I made to the script helper meant that when compiling either the debug or production (minified) versions of common JS files will be included if available. This means in a production environment the users get minified JS files so faster loading. And in a development environment we get the full JS files which make debugging more straightforward.</p><p>What I haven&#x27;t started doing is minifying my own JS files as yet. I know I&#x27;m being somewhat inconsistent here by sometimes serving minified files and sometimes not. I&#x27;m not proud. Part of my rationale for this that since most of my users use my apps on a daily basis they will for the most part be using cached JS files. Obviously there&#x27;ll be slightly slower load times the first time they go to a page but nothing that significant I hope.</p><p>I have thought of starting to do my own minification as a build step but have held off for now. Again this is something being baked into .NET 4.5; another reason why I have held off doing this a different way for now.</p><p>Update</p><p>It now looks like this Microsofts optimisations have become <a href="http://nuget.org/packages/Microsoft.AspNet.Web.Optimization" target="_blank" rel="noopener noreferrer">this Nuget package</a>. It&#x27;s early days (well it was released on 15th August 2012 and I&#x27;m writing this on the 16th) but I think this looks not to be tied to MVC 4 or .NET 4.5 in which case I could use it in my current MVC 3 projects. I hope so...</p><p>By the way there&#x27;s a <a href="http://www.pluralsight.com/training/Courses/TableOfContents/mvc4#mvc4-m3-optimization" target="_blank" rel="noopener noreferrer">nice rundown of how to use this by K. Scott Allen of Pluralsight</a>. It&#x27;s fantastic. Recommended.</p><p>Update 2</p><p>Having done a little asking around I now understand that this *<strong>can</strong>* be used with MVC 3 / .NET 4.0. Excellent!</p><p>One rather nice alternative script serving mechanism I&#x27;ve seen (but not yet used) is Andrew Davey&#x27;s <a href="http://getcassette.net" target="_blank" rel="noopener noreferrer">Cassette</a> which I mean to take for a test drive soon. This looks fantastic (and is available as a <a href="http://nuget.org/packages/Cassette" target="_blank" rel="noopener noreferrer">Nuget package</a> - 10 points!).</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="cdns-they-want-to-serve-you"></a>CDNs (they want to serve you)<a class="hash-link" href="#cdns-they-want-to-serve-you" title="Direct link to heading">#</a></h2><p>I&#x27;ve never professionally made use of CDNs at all. There are <a href="http://encosia.com/3-reasons-why-you-should-let-google-host-jquery-for-you/" target="_blank" rel="noopener noreferrer">clearly good reasons why you should</a> but most of those good reasons relate most to public facing web apps.</p><p>As I&#x27;ve said, the applications I tend to work on sit behind firewalls and it&#x27;s not always guaranteed what my users can see from the grand old world of web beyond. (Indeed what they see can change on hour by hour basis sometimes...) Combined with that, because my apps are only accessible by a select few I don&#x27;t face the pressure to reduce load on the server that public web apps can face.</p><p>So while CDN&#x27;s are clearly a good thing. I don&#x27;t use them at present. And that&#x27;s unlikely to change in the short term.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="tldr"></a>TL:DR<a class="hash-link" href="#tldr" title="Direct link to heading">#</a></h2><ol><li>I don&#x27;t use CDNs - they&#x27;re clearly useful but they don&#x27;t suit my particular needs</li><li>I serve each JavaScript file individually just before the body tag. I don&#x27;t bundle.</li><li>I don&#x27;t minify my own scripts (though clearly it wouldn&#x27;t be hard) but I do serve the minified versions of 3rd party libraries (eg jQuery) in a Production environment.</li><li>I don&#x27;t use async script loaders at present. I may in future; we shall see.</li></ol><p>I expect some of the above may change (well, possibly not point #1) but this general approach is working well for me at present.</p><p>I haven&#x27;t touched at all on how I&#x27;m structuring my JavaScript code itself. Perhaps next time.</p></div><footer class="row margin-vert--lg"><div class="col"><strong>Tags:</strong><a class="margin-horiz--sm" href="/tags/asp-net-mvc">asp.net mvc</a><a class="margin-horiz--sm" href="/tags/html-helper">html helper</a><a class="margin-horiz--sm" href="/tags/javascript">javascript</a><a class="margin-horiz--sm" href="/tags/cassette">cassette</a></div></footer></article><div><a href="https://github.com/johnnyreilly/blog.johnnyreilly.com/edit/main/blog-website/blog/blog/2012-07-01-how-im-structuring-my-javascript-in-web.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-label="Edit page"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="margin-vert--xl"><nav class="pagination-nav" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/2012/07/16/rendering-partial-view-to-string"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Â« Rendering Partial View to a String</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/2012/06/04/reasons-to-be-cheerful-why-now-is-good"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Reasons to be Cheerful (why now is a good time to be a dev) Â»</div></a></div></nav></div></main><div class="col col--2"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#what-are-you-up-to" class="table-of-contents__link">What are you up to?</a></li><li><a href="#render-first-js-second" class="table-of-contents__link">&quot;Render first. JS second.&quot;</a></li><li><a href="#i-want-to-serve-you" class="table-of-contents__link">I want to serve you...</a></li><li><a href="#minification---i-want-to-serve-you-less" class="table-of-contents__link">Minification - I want to serve you less...</a></li><li><a href="#cdns-they-want-to-serve-you" class="table-of-contents__link">CDNs (they want to serve you)</a></li><li><a href="#tldr" class="table-of-contents__link">TL:DR</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><ul class="footer__items"><li class="footer__item"><a href="https://www.buymeacoffee.com/qUBm0Wh" target="_blank"><img src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png" alt="Buy Me A Coffee" style="height: 60px !important;width: 217px !important;"></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 John Reilly. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/styles.a4ce88d2.js"></script>
<script src="/assets/js/runtime~main.b634e2bd.js"></script>
<script src="/assets/js/main.b119f4b6.js"></script>
<script src="/assets/js/1.8b668980.js"></script>
<script src="/assets/js/2.544547e0.js"></script>
<script src="/assets/js/ccc49370.ee3792fd.js"></script>
<script src="/assets/js/c3b5bd8c.4d1bf496.js"></script>
<script src="/assets/js/8890ac7a.b5cb1200.js"></script>
<script src="/assets/js/fe3d2add.78ab73dc.js"></script>
</body>
</html>