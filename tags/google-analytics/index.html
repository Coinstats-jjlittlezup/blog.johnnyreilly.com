<!doctype html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<link rel="alternate" type="application/rss+xml" href="/rss.xml" title="I CAN MAKE THIS WORK Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/atom.xml" title="I CAN MAKE THIS WORK Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-51754530-2","auto"),ga("set","anonymizeIp",!0),ga("send","pageview")</script>
<script async src="https://www.google-analytics.com/analytics.js"></script>
<link rel="icon" href="/img/favicon/profile.jpg">
<link rel="manifest" href="/manifest.json">
<meta name="theme-color" content="rgb(37, 194, 160)">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="#000">
<link rel="apple-touch-icon" href="/img/favicon/apple-touch-icon.png"><title data-react-helmet="true">One post tagged with &quot;google analytics&quot; | I CAN MAKE THIS WORK</title><meta data-react-helmet="true" property="og:title" content="One post tagged with &quot;google analytics&quot; | I CAN MAKE THIS WORK"><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" property="og:url" content="https://blog.johnnyreilly.com/tags/google-analytics"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="blog_tags_posts"><meta data-react-helmet="true" property="og:image" content="https://blog.johnnyreilly.com/img/profile.png"><meta data-react-helmet="true" name="twitter:image" content="https://blog.johnnyreilly.com/img/profile.png"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://blog.johnnyreilly.com/tags/google-analytics"><link data-react-helmet="true" rel="alternate" href="https://blog.johnnyreilly.com/tags/google-analytics" hreflang="en"><link data-react-helmet="true" rel="alternate" href="https://blog.johnnyreilly.com/tags/google-analytics" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.c5af4104.css">
<link rel="preload" href="/assets/js/runtime~main.24e2ccd4.js" as="script">
<link rel="preload" href="/assets/js/main.dd030dfd.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">I CAN MAKE THIS WORK</b></a><a class="navbar__item navbar__link" href="/about">About</a><a class="navbar__item navbar__link" href="/blog-archive">Blog Archive</a></div><div class="navbar__items navbar__items--right"><a href="https://github.com/johnnyreilly" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><a href="https://twitter.com/johnny_reilly" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_71bT">ðŸŒž</span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-tags-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_2ahu thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_2hhb margin-bottom--md">Recent posts</div><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/2021/08/15/bicep-azure-static-web-apps-azure-devops">Publish Azure Static Web Apps with Bicep and Azure DevOps</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/2021/08/14/typescript-4-4-more-readable-code">TypeScript 4.4 and more readable code</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/2021/08/01/typescript-abstract-classes-and-constructors">TypeScript, abstract classes, and constructors</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/2021/07/14/directory-build-props-c-sharp-9-for-all">Directory.Build.props: C# 9 for all your projects</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/2021/07/11/webpack-esbuild-why-not-both">webpack? esbuild? Why not both?</a></li></ul></nav></aside><main class="col col--7"><header class="margin-bottom--xl"><h1>One post tagged with &quot;google analytics&quot;</h1><a href="/tags">View All Tags</a></header><article class="margin-bottom--xl"><header><h2 class="blogPostTitle_GeHD"><a href="/2019/03/22/google-analytics-api-and-aspnet-core">Google Analytics API and ASP.Net Core</a></h2><div class="blogPostData_291c margin-vert--md"><time datetime="2019-03-22T00:00:00.000Z">March 22, 2019</time> Â· 2 min read</div><div class="avatar margin-vert--md"><a href="https://github.com/johnnyreilly" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://blog.johnnyreilly.com/img/profile.jpg" alt="John Reilly"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://github.com/johnnyreilly" target="_blank" rel="noopener noreferrer">John Reilly</a></div><small class="avatar__subtitle"></small></div></div></header><div class="markdown"><p>I recently had need to be able to access the API for Google Analytics from ASP.Net Core. Getting this up and running turned out to be surprisingly tough because of an absence of good examples. So here it is; an example of how you can access a simple page access stat using <a href="https://www.nuget.org/packages/Google.Apis.AnalyticsReporting.v4/" target="_blank" rel="noopener noreferrer">the API</a>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly cs"><pre tabindex="0" class="prism-code language-cs codeBlock_23N8 thin-scrollbar" style="color:#bfc7d5;background-color:#292d3e"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#bfc7d5"><span class="token plain">async Task&lt;SomeKindOfDataStructure[]&gt; GetUsageFromGoogleAnalytics(DateTime startAtThisDate, DateTime endAtThisDate)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">{</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // Create the DateRange object. Here we want data from last week.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    var dateRange = new DateRange</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        StartDate = startAtThisDate.ToString(&quot;yyyy-MM-dd&quot;),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        EndDate = endAtThisDate.ToString(&quot;yyyy-MM-dd&quot;)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    };</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // Create the Metrics and dimensions object.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // var metrics = new List&lt;Metric&gt; { new Metric { Expression = &quot;ga:sessions&quot;, Alias = &quot;Sessions&quot; } };</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // var dimensions = new List&lt;Dimension&gt; { new Dimension { Name = &quot;ga:pageTitle&quot; } };</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    var metrics = new List&lt;Metric&gt; { new Metric { Expression = &quot;ga:uniquePageviews&quot; } };</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    var dimensions = new List&lt;Dimension&gt; { </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        new Dimension { Name = &quot;ga:date&quot; },</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        new Dimension { Name = &quot;ga:dimension1&quot; } </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    };</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // Get required View Id from configuration</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    var viewId = $&quot;ga:{&quot;[VIEWID]&quot;}&quot;;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // Create the Request object.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    var reportRequest = new ReportRequest</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        DateRanges = new List&lt;DateRange&gt; { dateRange },</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Metrics = metrics,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Dimensions = dimensions,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        FiltersExpression = &quot;ga:pagePath==/index.html&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ViewId = viewId</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    };</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    var getReportsRequest = new GetReportsRequest {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ReportRequests = new List&lt;ReportRequest&gt; { reportRequest }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    };</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    //Invoke Google Analytics API call and get report</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    var analyticsService = GetAnalyticsReportingServiceInstance();</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    var response = await (analyticsService.Reports.BatchGet(getReportsRequest)).ExecuteAsync();</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    var logins = response.Reports[0].Data.Rows.Select(row =&gt; new SomeKindOfDataStructure {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Date = new DateTime(</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            year: Convert.ToInt32(row.Dimensions[0].Substring(0, 4)), </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            month: Convert.ToInt32(row.Dimensions[0].Substring(4, 2)), </span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            day: Convert.ToInt32(row.Dimensions[0].Substring(6, 2))),</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        NumberOfLogins = Convert.ToInt32(row.Metrics[0].Values[0])</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    })</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    .OrderByDescending(login =&gt; login.Date)</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    .ToArray();</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return logins;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">/// &lt;summary&gt;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">/// Intializes and returns Analytics Reporting Service Instance</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">/// &lt;/summary&gt;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">AnalyticsReportingService GetAnalyticsReportingServiceInstance() {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    var googleAuthFlow = new GoogleAuthorizationCodeFlow(new GoogleAuthorizationCodeFlow.Initializer {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ClientSecrets = new ClientSecrets {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            ClientId = &quot;[CLIENTID]&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">            ClientSecret = &quot;[CLIENTSECRET]&quot;</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        }</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    });</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    var responseToken = new TokenResponse {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        AccessToken = &quot;[ANALYTICSTOKEN]&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        RefreshToken = &quot;[REFRESHTOKEN]&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        Scope = AnalyticsReportingService.Scope.AnalyticsReadonly, //Read-only access to Google Analytics,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        TokenType = &quot;Bearer&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    };</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    var credential = new UserCredential(googleAuthFlow, &quot;&quot;, responseToken);</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    // Create the  Analytics service.</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    return new AnalyticsReportingService(new BaseClientService.Initializer {</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        HttpClientInitializer = credential,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        ApplicationName = &quot;my-super-applicatio&quot;,</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    });</span></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_Ue-o clean-btn">Copy</button></div></div><p>You can see above that you need various credentials to be able to use the API. You can acquire these by logging into GA. Enjoy!</p></div><footer class="row docusaurus-mt-lg"><div class="col"><b>Tags:</b><a class="margin-horiz--sm" href="/tags/asp-net-core">asp net core</a><a class="margin-horiz--sm" href="/tags/google-analytics">google analytics</a></div><div class="col text--right"><a aria-label="Read more about Google Analytics API and ASP.Net Core" href="/2019/03/22/google-analytics-api-and-aspnet-core"><b>Read More</b></a></div></footer></article></main></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Support me</div><ul class="footer__items"><li class="footer__item"><a href="https://www.buymeacoffee.com/qUBm0Wh" target="_blank"><img src="https://cdn.buymeacoffee.com/buttons/v2/default-yellow.png" alt="Buy Me A Coffee" style="height: 60px !important;width: 217px !important;"></a></li><li class="footer__item"><div style="display: flex; align-items: center;"><iframe src="https://github.com/sponsors/johnnyreilly/button" title="Sponsor johnnyreilly" height="35" width="116" style="border: 0;"></iframe><div>&nbsp;on GitHub</div></div></li></ul></div><div class="col footer__col"><div class="footer__title">Feeds</div><ul class="footer__items"><li class="footer__item"><a href="https://blog.johnnyreilly.com/rss.xml" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>RSS<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://blog.johnnyreilly.com/atom.xml" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Atom<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 John Reilly. Built with Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.24e2ccd4.js"></script>
<script src="/assets/js/main.dd030dfd.js"></script>
</body>
</html>