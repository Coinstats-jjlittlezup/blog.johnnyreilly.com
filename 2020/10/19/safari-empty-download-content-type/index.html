<!doctype html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-alpha.70">
<link rel="alternate" type="application/rss+xml" href="/blog.johnnyreilly.com/rss.xml" title="I CAN MAKE THIS WORK Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog.johnnyreilly.com/atom.xml" title="I CAN MAKE THIS WORK Blog Atom Feed"><title data-react-helmet="true">The Mysterious Case of Safari and the Empty Download | I CAN MAKE THIS WORK</title><meta data-react-helmet="true" property="og:title" content="The Mysterious Case of Safari and the Empty Download | I CAN MAKE THIS WORK"><meta data-react-helmet="true" name="description" content="TL;DR 0. Without this, Safari can attempt to trigger an empty download. Don&#x27;t argue; just go with it; some browsers are strange."><meta data-react-helmet="true" property="og:description" content="TL;DR 0. Without this, Safari can attempt to trigger an empty download. Don&#x27;t argue; just go with it; some browsers are strange."><meta data-react-helmet="true" name="twitter:card" content="summary_large_image"><meta data-react-helmet="true" name="docusaurus_locale" content="en"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><link data-react-helmet="true" rel="shortcut icon" href="/blog.johnnyreilly.com/img/favicon.ico"><link rel="stylesheet" href="/blog.johnnyreilly.com/styles.a755cef0.css">
<link rel="preload" href="/blog.johnnyreilly.com/styles.e251ffc4.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/runtime~main.17090397.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/main.76845b2c.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/1.32932134.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/2.7bb643e8.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/ccc49370.1c32a13b.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/c3b5bd8c.b09f7905.js" as="script">
<link rel="preload" href="/blog.johnnyreilly.com/7124a642.f79f96fb.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<nav aria-label="Skip navigation links"><button type="button" tabindex="0" class="skipToContent_11B0">Skip to main content</button></nav><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><a class="navbar__brand" href="/blog.johnnyreilly.com/"><img src="/blog.johnnyreilly.com/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/blog.johnnyreilly.com/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">I CAN MAKE THIS WORK</strong></a></div><div class="navbar__items navbar__items--right"><div class="react-toggle react-toggle--disabled displayOnlyInLargeViewport_2N3Q"><div class="react-toggle-track"><div class="react-toggle-track-check"><span class="toggle_3NWk">ðŸŒœ</span></div><div class="react-toggle-track-x"><span class="toggle_3NWk">ðŸŒž</span></div></div><div class="react-toggle-thumb"></div><input type="checkbox" disabled="" aria-label="Dark mode toggle" class="react-toggle-screenreader-only"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div><div class="navbar-sidebar"><div class="navbar-sidebar__brand"><a class="navbar__brand" href="/blog.johnnyreilly.com/"><img src="/blog.johnnyreilly.com/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_YANc themedImage--light_3CMI navbar__logo"><img src="/blog.johnnyreilly.com/img/profile.jpg" alt="I CAN MAKE THIS WORK" class="themedImage_YANc themedImage--dark_3ARp navbar__logo"><strong class="navbar__title">I CAN MAKE THIS WORK</strong></a></div><div class="navbar-sidebar__items"><div class="menu"><ul class="menu__list"></ul></div></div></div></nav><div class="main-wrapper blog-wrapper"><div class="container margin-vert--lg"><div class="row"><div class="col col--2"><div class="sidebar_SWld thin-scrollbar"><h3 class="sidebarItemTitle_Km2m">Recent posts</h3><ul class="sidebarItemList_3UpA"><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog.johnnyreilly.com/2021/03/06/generate-typescript-and-csharp-clients-with-nswag">Generate TypeScript and CSharp clients with NSwag based on an API</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog.johnnyreilly.com/2021/02/27/goodbye-client-affinity-hello-data-protection-with-azure">Goodbye Client Affinity, Hello Data Protection with Azure</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog.johnnyreilly.com/2021/02/16/easy-auth-tokens-survive-releases-on-linux-azure-app-service">Making Easy Auth tokens survive releases on Linux Azure App Service</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog.johnnyreilly.com/2021/02/11/azure-app-service-health-checks-and-zero-downtime-deployments">Azure App Service, Health checks and zero downtime deployments</a></li><li class="sidebarItem_2T0D"><a class="sidebarItemLink_v5H9" href="/blog.johnnyreilly.com/2021/02/08/arm-templates-security-role-assignments">ARM templates, security, role assignments and magic GUIDs</a></li></ul></div></div><main class="col col--8"><article><header><h1 class="margin-bottom--sm blogPostTitle_3-lP">The Mysterious Case of Safari and the Empty Download</h1><div class="margin-vert--md"><time datetime="2020-10-19T00:00:00.000Z" class="blogPostDate_Ta7i">October 19, 2020  Â· 3 min read</time></div><div class="avatar margin-vert--md"><a class="avatar__photo-link avatar__photo" href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener"><img src="https://avatars.githubusercontent.com/u/1010525?s=400&amp;u=294033082cfecf8ad1645b4290e362583b33094a&amp;v=4" alt="John Reilly"></a><div class="avatar__intro"><h4 class="avatar__name"><a href="https://github.com/johnnyreilly" target="_blank" rel="noreferrer noopener">John Reilly</a></h4><small class="avatar__subtitle"></small></div></div></header><section class="markdown"><p><strong>TL;DR:</strong> Safari wants a <code>Content-Type</code> header in responses. Even if the response is <code>Content-Length: 0</code>. Without this, Safari can attempt to trigger an empty download. Don&#x27;t argue; just go with it; some browsers are strange.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_prK2" id="the-longer-version"></a>The longer version<a class="hash-link" href="#the-longer-version" title="Direct link to heading">#</a></h2><p>Every now and then a mystery presents itself. A puzzle which just doesn&#x27;t make sense and yet stubbornly continues to exist. I happened upon one of these the other day and to say it was frustrating does it no justice at all.</p><p>It all came back to the default iOS and Mac browser; Safari. When our users log into our application, they are redirected to a shared login provider which, upon successful authentication, hands over a cookie containing auth details and redirects back to our application. A middleware in our app reads what it needs from the cookie and then creates a cookie of its own which is to be used throughout the session. As soon as the cookie is set, the page refreshes and the app boots up in an authenticated state.</p><p>That&#x27;s the background. This mechanism had long been working fine with Chrome (which the majority of our users browse with), Edge, Firefox and Internet Explorer. But we started to get reports from Safari users that, once they&#x27;d supplied their credentials, they&#x27;d not be authenticated and redirected back to our application. Instead they&#x27;d be prompted to download an empty document and the redirect would not take place.</p><p>As a team we could not fathom why this should be the case; it just didn&#x27;t make sense. There followed hours of experimentation before <a href="https://twitter.com/hennie_spies" target="_blank" rel="noopener noreferrer">Hennie</a> noticed something. It was at the point when the redirect back to our app from the login provider took place. Specifically the initial response that came back which contained our custom cookie and a <code>Refresh: 0</code> header to trigger a refresh in the browser. There was no content in the response, save for headers. It was <code>Content-Length: 0</code> all the way.</p><p>Hennie noticed that there was no <code>Content-Type</code> set and wondered if that was significant. It didn&#x27;t seem like it would be a necessary header given there was no content. But Safari reckons not with logic. As an experiment we tried setting the response header to <code>Content-Type: text/html</code>. It worked! No mystery download, no failed redirect (which it turned out was actually a successful redirect which wasn&#x27;t being surfaced in Safari&#x27;s network request tab).</p><p>It appears that always providing a <code>Content-Type</code> header in your responses is wise if only for the case of Safari. In fact, it&#x27;s generally unlikely that this won&#x27;t be set anyway, but it can happen as we have experienced. Hopefully we&#x27;ve suffered so you don&#x27;t have to.</p></section></article><div><a href="https://github.com/johnnyreilly/blog.johnnyreilly.com/edit/main/blog-website/blog/blog/2020-10-19-safari-empty-download-content-type.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="1.2em" width="1.2em" preserveAspectRatio="xMidYMid meet" role="img" viewBox="0 0 40 40" class="iconEdit_2LL7"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="margin-vert--xl"><nav class="pagination-nav" aria-label="Blog post page navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/blog.johnnyreilly.com/2020/10/31/azure-devops-node-api-missing-episodes"><div class="pagination-nav__sublabel">Newer Post</div><div class="pagination-nav__label">Â« Azure DevOps Node API: The missing episodes</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog.johnnyreilly.com/2020/10/02/autofac-6-integration-tests-and-generic-hosting"><div class="pagination-nav__sublabel">Older Post</div><div class="pagination-nav__label">Autofac 6, integration tests and .NET generic hosting Â»</div></a></div></nav></div></main><div class="col col--2"><div class="tableOfContents_2xL- thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#the-longer-version" class="table-of-contents__link">The longer version</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="footer__bottom text--center"><div class="footer__copyright">Copyright Â© 2021 John Reilly. Built with Docusaurus.</div></div></div></footer></div>
<script src="/blog.johnnyreilly.com/styles.e251ffc4.js"></script>
<script src="/blog.johnnyreilly.com/runtime~main.17090397.js"></script>
<script src="/blog.johnnyreilly.com/main.76845b2c.js"></script>
<script src="/blog.johnnyreilly.com/1.32932134.js"></script>
<script src="/blog.johnnyreilly.com/2.7bb643e8.js"></script>
<script src="/blog.johnnyreilly.com/ccc49370.1c32a13b.js"></script>
<script src="/blog.johnnyreilly.com/c3b5bd8c.b09f7905.js"></script>
<script src="/blog.johnnyreilly.com/7124a642.f79f96fb.js"></script>
</body>
</html>